# üìû –ü–û–õ–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –°–ò–°–¢–ï–ú–ï ASTERISK

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-10-01  
**–í–µ—Ä—Å–∏—è**: 2.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –∞—Ç–∞–∫

---

## üéØ –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´

### –ß—Ç–æ —ç—Ç–æ –∑–∞ —Å–∏—Å—Ç–µ–º–∞?

–≠—Ç–æ **–≥–æ–ª–æ—Å–æ–≤–æ–π AI-–±–æ—Ç** –Ω–∞ –±–∞–∑–µ Asterisk, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏ –Ω–∞ –Ω–æ–º–µ—Ä **79581114700** (Novofon)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **AI-–∞–≥–µ–Ω—Ç–∞** –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ä–µ—á—å —á–µ—Ä–µ–∑ **Yandex SpeechKit ASR**
- ‚úÖ –°–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å —á–µ—Ä–µ–∑ **Yandex SpeechKit TTS**
- ‚úÖ –ó–∞—â–∏—â–µ–Ω –æ—Ç **SIP-–∞—Ç–∞–∫** –∏ –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –†–µ–∞–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫‚îÇ
‚îÇ  (–ö–ª–∏–µ–Ω—Ç)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü—Ä–æ–≤–∞–π–¥–µ—Ä      ‚îÇ
‚îÇ  Novofon        ‚îÇ
‚îÇ  (SIP trunk)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           –í–ê–® –°–ï–†–í–ï–†                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  ASTERISK (PBX)                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   PJSIP     ‚îÇ ‚Üí  ‚îÇ   Dialplan   ‚îÇ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (SIP Stack) ‚îÇ    ‚îÇ  (Routing)   ‚îÇ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚Üì        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                      ‚îÇ  Stasis App  ‚îÇ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                      ‚îÇ (asterisk-bot)‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                 ‚îÇ            ‚îÇ
‚îÇ                                 ‚Üì            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  PYTHON BOT                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ AI Agent ‚îÇ  ‚îÇ Yandex  ‚îÇ  ‚îÇ ARI ‚îÇ ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  (RAG)   ‚îÇ  ‚îÇASR/TTS  ‚îÇ  ‚îÇ API ‚îÇ ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
    –û—Ç–≤–µ—Ç –±–æ—Ç—É
```

---

## üìú –ò–°–¢–û–†–ò–Ø: –ß–¢–û –ë–´–õ–û –ò –ß–¢–û –ò–°–ü–†–ê–í–ò–õ–ò

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ #1: –ê—Ç–∞–∫–∞ –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ (–°–µ–Ω—Ç—è–±—Ä—å 2025)

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- –î–µ—à–µ–≤–∞—è AI-–º–æ–¥–µ–ª—å –≤ Cursor –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∞ Asterisk
- –ù–∞—á–∞–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑–≤–æ–Ω–∫–∏ —Å **–ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤**: 7005, 2600, 84957285000, default
- –°–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—á–∞–ª–∞ –Ω–∞ –≤—Å–µ –∑–≤–æ–Ω–∫–∏, –≤–∫–ª—é—á–∞—è –º—É—Å–æ—Ä–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–í–∫–ª—é—á–µ–Ω `anonymous` endpoint** –≤ PJSIP ‚Üí Asterisk –ø—Ä–∏–Ω–∏–º–∞–ª –∑–≤–æ–Ω–∫–∏ –æ—Ç –õ–Æ–ë–û–ì–û IP –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
2. **–ü—Ä–∞–≤–∏–ª–æ `_X.` —Å Answer()** –≤ dialplan ‚Üí –õ—é–±–æ–π –Ω–æ–º–µ—Ä –æ—Ç–≤–µ—á–∞–ª—Å—è –∏ —à–µ–ª –≤ –±–æ—Ç–∞
3. **ARI –æ—Ç–∫—Ä—ã—Ç –Ω–∞ `0.0.0.0:8088`** ‚Üí API –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ (–û–∫—Ç—è–±—Ä—å 2025):**
1. ‚úÖ **–£–¥–∞–ª–∏–ª–∏ `anonymous` endpoint** - —Ç–µ–ø–µ—Ä—å –∑–≤–æ–Ω–∫–∏ —Ç–æ–ª—å–∫–æ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏–ª–∏ PJSIP identify** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ IP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Novofon
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏–ª–∏ dialplan** - —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∏–¥—É—Ç –≤ –±–æ—Ç–∞, –æ—Å—Ç–∞–ª—å–Ω–æ–µ Hangup() –ë–ï–ó Answer()
4. ‚úÖ **–ó–∞–∫—Ä—ã–ª–∏ ARI –Ω–∞ localhost** - –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
5. ‚úÖ **–£–±—Ä–∞–ª–∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ CallerID** - —Ç–µ–ø–µ—Ä—å –õ–Æ–ë–û–ô –º–æ–∂–µ—Ç –∑–≤–æ–Ω–∏—Ç—å –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –±–æ–ª—å—à–µ –ù–ï –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–≤–æ–Ω–∏—Ç—å —Å –ª—é–±—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
- ‚úÖ SIP-—Å–∫–∞–Ω–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üîß –¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–û–ö–¢–Ø–ë–†–¨ 2025)

### 1. PJSIP Configuration (`/etc/asterisk/pjsip.conf`)

#### Transport (UDP)
```ini
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=31.207.75.71
external_signaling_address=31.207.75.71
```

**–ß—Ç–æ —ç—Ç–æ:**
- –°–ª—É—à–∞–µ—Ç SIP –Ω–∞ –ø–æ—Ä—Ç—É **5060 UDP**
- –í–Ω–µ—à–Ω–∏–π IP: `31.207.75.71` (IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)

---

#### Voximplant Endpoint (–¥–ª—è –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)
```ini
[voxi_in]
type=auth
auth_type=userpass
username=voxi_in
password=8ldWQAaqRs/MPcTV+gxoq+bSP0z4aaq/

[voxi_in]
type=aor
max_contacts=1

[voxi_in]
type=endpoint
context=from-voximplant
disallow=all
allow=alaw,ulaw
aors=voxi_in
auth=voxi_in
dtmf_mode=rfc4733
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
direct_media=no
language=ru
```

**–ß—Ç–æ —ç—Ç–æ:**
- Endpoint –¥–ª—è Voximplant (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤)
- –¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

---

#### Novofon Outbound Trunk (–∏—Å—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏)
```ini
[novofon-trunk]
type=endpoint
transport=transport-udp
context=novofon-outbound
disallow=all
allow=alaw,ulaw,g722
outbound_auth=novofon-auth
aors=novofon-aor
dtmf_mode=rfc4733
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
direct_media=no

[novofon-auth]
type=auth
auth_type=userpass
username=asterisk01
password=dummy

[novofon-aor]
type=aor
contact=sip:sip.novofon.ru
```

**–ß—Ç–æ —ç—Ç–æ:**
- –î–ª—è **–∏—Å—Ö–æ–¥—è—â–∏—Ö** –∑–≤–æ–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ Novofon
- –°–µ–π—á–∞—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–±–æ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–≤–æ–Ω–∫–∏)

---

#### ‚≠ê Novofon Incoming (–ì–õ–ê–í–ù–´–ô - –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤)
```ini
[novofon-incoming]
type=endpoint
transport=transport-udp
context=from-novofon
disallow=all
allow=alaw,ulaw,g722
dtmf_mode=rfc4733
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
direct_media=no
timers=yes
timers_sess_expires=360

[novofon-identify]
type=identify
endpoint=novofon-incoming
match=37.139.38.224
match=37.139.38.56

[novofon-identify-2]
type=identify
endpoint=novofon-incoming
match=37.139.38.56/32
```

**‚≠ê –≠–¢–û –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï! ‚≠ê**

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. **`novofon-incoming`** - endpoint –¥–ª—è –í–°–ï–• –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ –æ—Ç Novofon
2. **`novofon-identify`** - —Ñ–∏–ª—å—Ç—Ä –ø–æ IP-–∞–¥—Ä–µ—Å–∞–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
   - `37.139.38.224` - —Å—Ç–∞—Ä—ã–π IP Novofon (sip.novofon.ru)
   - `37.139.38.56` - –Ω–æ–≤—ã–π IP Novofon (pbx.novofon.com)
3. **`context=from-novofon`** - –≤—Å–µ –∑–≤–æ–Ω–∫–∏ –∏–¥—É—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç `from-novofon` (—Å–º. dialplan)

**–ö–∞–∫ —ç—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç:**
- ‚ùå –ï—Å–ª–∏ –∑–≤–æ–Ω–æ–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å IP `185.243.5.195` (—Å–∫–∞–Ω–µ—Ä) ‚Üí **–ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç** —Å identify ‚Üí Asterisk –æ—Ç–∫–ª–æ–Ω—è–µ—Ç
- ‚úÖ –ï—Å–ª–∏ –∑–≤–æ–Ω–æ–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å IP `37.139.38.56` (Novofon) ‚Üí **—Å–æ–≤–ø–∞–¥–∞–µ—Ç** —Å identify ‚Üí Asterisk –ø—Ä–∏–Ω–∏–º–∞–µ—Ç

---

### 2. Dialplan Configuration (`/etc/asterisk/extensions.conf`)

```ini
[general]
static=yes
writeprotect=no

[from-novofon]
; ‚≠ê –û–°–ù–û–í–ù–û–ô –ù–û–ú–ï–† - –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
exten => 79581114700,1,NoOp(Main number to AI Handler)
exten => 79581114700,n,Answer()
exten => 79581114700,n,Set(CHANNEL(language)=ru)
exten => 79581114700,n,Stasis(asterisk-bot)
exten => 79581114700,n,Hangup()

; –ê–ª–∏–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ (–±–µ–∑ 7)
exten => 9581114700,1,Goto(79581114700,1)

; –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä
exten => 04912,1,NoOp(Internal number to AI Handler)
exten => 04912,n,Answer()
exten => 04912,n,Set(CHANNEL(language)=ru)
exten => 04912,n,Stasis(asterisk-bot)
exten => 04912,n,Hangup()

; –¢–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä
exten => 0011,1,NoOp(Test number to AI Handler)
exten => 0011,n,Answer()
exten => 0011,n,Set(CHANNEL(language)=ru)
exten => 0011,n,Stasis(asterisk-bot)
exten => 0011,n,Hangup()

; –ê–ª–∏–∞—Å –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞
exten => 11,1,Goto(0011,1)

; ‚≠ê –ó–ê–©–ò–¢–ê: –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
exten => _X.,1,NoOp(–ë–õ–û–ö–ò–†–û–í–ö–ê –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ DID: ${EXTEN} –æ—Ç ${CALLERID(num)})
exten => _X.,n,Hangup()

[from-voximplant]
; –î–ª—è Voximplant (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
exten => _X.,1,NoOp(Voximplant call to AI Handler: ${EXTEN})
exten => _X.,n,Answer()
exten => _X.,n,Set(CHANNEL(language)=ru)
exten => _X.,n,Stasis(asterisk-bot)
exten => _X.,n,Wait(60)
exten => _X.,n,Hangup()

[novofon-outbound]
; –î–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
exten => 8888,1,Dial(PJSIP/8888@novofon-trunk,30)
exten => 8888,n,Hangup()

exten => test,1,Dial(PJSIP/8888@novofon-trunk,30)
exten => test,n,Hangup()

[playback-context]
; –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–æ–≤
exten => play,1,NoOp(Fallback playback: ${PLAYBACK_FILE})
exten => play,n,Playback(${PLAYBACK_FILE})
exten => play,n,Return()
```

**‚≠ê –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ 79581114700:**
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä Novofon –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç INVITE —Å DID (–Ω–∞–±—Ä–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä) = `79581114700`
   - Asterisk –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è ‚Üí —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `novofon-identify` ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç
   - –ò—â–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ `from-novofon` –¥–ª—è extension `79581114700`
   - –ù–∞—Ö–æ–¥–∏—Ç ‚Üí Answer() ‚Üí Stasis(asterisk-bot) ‚Üí –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ Python –±–æ—Ç

2. **–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ –º—É—Å–æ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä (7005):**
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ù–ï –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–∞–∫–æ–π –∑–≤–æ–Ω–æ–∫ (—ç—Ç–æ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ —á–µ—Ä–µ–∑ anonymous)
   - –ù–æ –µ—Å–ª–∏ –±—ã –æ—Ç–ø—Ä–∞–≤–∏–ª ‚Üí –∏—â–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è `7005`
   - –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ `_X.` (–ª—é–±–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω)
   - `NoOp(–ë–õ–û–ö–ò–†–û–í–ö–ê...)` ‚Üí `Hangup()` **–ë–ï–ó Answer()** ‚Üí –∑–≤–æ–Ω–æ–∫ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è "–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–º"

3. **–ó–≤–æ–Ω–æ–∫ —Å –ª—é–±–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞:**
   - –ö–ª–∏–µ–Ω—Ç –∑–≤–æ–Ω–∏—Ç –Ω–∞ 79581114700 ‚Üí –∑–≤–æ–Ω–æ–∫ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ Novofon ‚Üí Novofon –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç INVITE –Ω–∞ –≤–∞—à Asterisk
   - CallerID (–Ω–æ–º–µ—Ä –∑–≤–æ–Ω—è—â–µ–≥–æ) –º–æ–∂–µ—Ç –±—ã—Ç—å –õ–Æ–ë–û–ô
   - –í–∞–∂–µ–Ω —Ç–æ–ª—å–∫–æ **–Ω–∞–±—Ä–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä** (DID) = 79581114700
   - –ó–≤–æ–Ω–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚úÖ

---

### 3. ARI Configuration (`/etc/asterisk/ari.conf`)

```ini
[general]
enabled = yes
pretty = yes

[asterisk]
type = user
read_only = no
password = asterisk123
```

**–ß—Ç–æ —ç—Ç–æ:**
- **ARI (Asterisk REST Interface)** - HTTP API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏
- Python –±–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ARI –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–≤–æ–Ω–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ

---

### 4. HTTP Configuration (`/etc/asterisk/http.conf`)

```ini
[general]
enabled = yes
bindaddr = 127.0.0.1
bindport = 8088
```

**‚≠ê –í–ê–ñ–ù–û:**
- **`bindaddr = 127.0.0.1`** - ARI –¥–æ—Å—Ç—É–ø–µ–Ω **–¢–û–õ–¨–ö–û —Å localhost**
- Python –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ ‚Üí –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è ‚úÖ
- –•–∞–∫–µ—Ä—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ‚Üí –ù–ï –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è ‚ùå

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
sudo asterisk -rx "http show status"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Server Enabled and Bound to 127.0.0.1:8088
```

---

## üõ°Ô∏è –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –ó–ê–©–ò–¢–ê

### –£—Ä–æ–≤–µ–Ω—å 1: PJSIP Identify (–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ IP)

```
–ó–≤–æ–Ω–æ–∫ ‚Üí Asterisk –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
         ‚Üì
    –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å identify?
         ‚Üì
    –î–ê ‚Üí –ü—Ä–∏–Ω–∏–º–∞–µ—Ç
         ‚Üì
    –ù–ï–¢ ‚Üí –û—Ç–∫–ª–æ–Ω—è–µ—Ç ("No matching endpoint found")
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- IP `37.139.38.56` (Novofon) ‚Üí ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
- IP `185.243.5.195` (—Å–∫–∞–Ω–µ—Ä) ‚Üí ‚ùå –û—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

**–õ–æ–≥–∏ –ø—Ä–∏ –∞—Ç–∞–∫–µ:**
```
Request 'REGISTER' from '"9007" <sip:9007@31.207.75.71>' 
failed for '185.243.5.195:5350' 
- No matching endpoint found
```

---

### –£—Ä–æ–≤–µ–Ω—å 2: Dialplan (–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ DID)

```
–ó–≤–æ–Ω–æ–∫ –ø—Ä–æ—à–µ–ª PJSIP ‚Üí Dialplan –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–±—Ä–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä (DID)
         ‚Üì
    DID = 79581114700?
         ‚Üì
    –î–ê ‚Üí Answer() ‚Üí –í –±–æ—Ç–∞
         ‚Üì
    –ù–ï–¢ ‚Üí Hangup() –ë–ï–ó Answer()
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- DID `79581114700` ‚Üí ‚úÖ –í –±–æ—Ç–∞
- DID `7005` ‚Üí ‚ùå Hangup() (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)

---

### –£—Ä–æ–≤–µ–Ω—å 3: ARI –Ω–∞ localhost

```
–ó–∞–ø—Ä–æ—Å –∫ ARI ‚Üí Asterisk –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∫—É–¥–∞ –∑–∞–ø—Ä–æ—Å
         ‚Üì
    –° localhost (127.0.0.1)?
         ‚Üì
    –î–ê ‚Üí –†–∞–∑—Ä–µ—à–∞–µ—Ç
         ‚Üì
    –ù–ï–¢ ‚Üí –û—Ç–∫–ª–æ–Ω—è–µ—Ç
```

---

## üîç –ö–û–ú–ê–ù–î–´ –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Asterisk

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status asterisk

# –í–µ—Ä—Å–∏—è Asterisk
sudo asterisk -rx "core show version"

# –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∏ –Ω–∞–≥—Ä—É–∑–∫–∞
sudo asterisk -rx "core show uptime"
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ PJSIP

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ endpoints
sudo asterisk -rx "pjsip show endpoints"

# –ü–æ–∫–∞–∑–∞—Ç—å identify –ø—Ä–∞–≤–∏–ª–∞
sudo asterisk -rx "pjsip show identifies"

# –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π endpoint
sudo asterisk -rx "pjsip show endpoint novofon-incoming"

# –ü–æ–∫–∞–∑–∞—Ç—å transports
sudo asterisk -rx "pjsip show transports"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
```
 Endpoint:  novofon-incoming       Unavailable   0 of inf
   Identify:  novofon-identify/novofon-incoming
        Match: 37.139.38.224/32
        Match: 37.139.38.56/32
```

- ‚úÖ **Unavailable** - –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤)
- ‚úÖ **Identify –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç** - –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Dialplan

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å dialplan
sudo asterisk -rx "dialplan show"

# –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç from-novofon
sudo asterisk -rx "dialplan show from-novofon"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –Ω–æ–º–µ—Ä
sudo asterisk -rx "dialplan show 79581114700@from-novofon"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
```
'79581114700' =>  1. NoOp(Main number to AI Handler)
                  2. Answer()
                  3. Set(CHANNEL(language)=ru)
                  4. Stasis(asterisk-bot)
                  5. Hangup()

'_X.' =>          1. NoOp(–ë–õ–û–ö–ò–†–û–í–ö–ê –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ DID: ${EXTEN} –æ—Ç ${CALLERID(num)})
                  2. Hangup()
```

- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä –∏–¥–µ—Ç –≤ Stasis
- ‚úÖ `_X.` –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–µ–∑ Answer()

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
sudo asterisk -rx "core show channels"

# –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–æ–Ω–∫–æ–≤
sudo asterisk -rx "core show calls"

# –ü–æ–∫–∞–∑–∞—Ç—å Stasis –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo asterisk -rx "stasis show apps"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
```
Name                   Debug          Subscriptions
asterisk-bot           No             Channel: 0
                                      Bridge: 0
                                      Endpoint: 0
```

- ‚úÖ **asterisk-bot** –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç - Python –±–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ ARI

```bash
# –°—Ç–∞—Ç—É—Å HTTP/ARI
sudo asterisk -rx "http show status"

# –¢–µ—Å—Ç ARI —Å —Å–µ—Ä–≤–µ—Ä–∞
curl -u asterisk:asterisk123 http://localhost:8088/ari/asterisk/info

# –ü–æ–∫–∞–∑–∞—Ç—å Stasis –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo asterisk -rx "stasis show apps"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
```
Server Enabled and Bound to 127.0.0.1:8088
```

- ‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω –∫ **127.0.0.1** (localhost)

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Python –±–æ—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep stasis_handler_optimized.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –≤ tmux/screen)
# –∏–ª–∏ —Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)
cd /root/Asterisk_bot/asterisk-vox-bot
source venv/bin/activate
python app/backend/asterisk/stasis_handler_optimized.py
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ Asterisk ARI WebSocket
üîî –ù–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫: Channel=..., Caller=...
‚úÖ –ê—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ ARI
```

---

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ Asterisk (–æ–±—â–∏–µ)
sudo tail -f /var/log/asterisk/messages.log

# –õ–æ–≥–∏ PJSIP (–¥–µ—Ç–∞–ª—å–Ω—ã–µ - –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
sudo asterisk -rx "pjsip set logger on"
sudo tail -f /var/log/asterisk/messages.log | grep PJSIP

# –§–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ INVITE –∑–∞–ø—Ä–æ—Å—ã
sudo tail -f /var/log/asterisk/messages.log | grep INVITE

# –§–∏–ª—å—Ç—Ä –∞—Ç–∞–∫–∏ (No matching endpoint)
sudo tail -f /var/log/asterisk/messages.log | grep "No matching endpoint"

# –§–∏–ª—å—Ç—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ dialplan
sudo tail -f /var/log/asterisk/messages.log | grep "–ë–õ–û–ö–ò–†–û–í–ö–ê"
```

---

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–Ω–∞–ª—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
watch -n 5 'sudo asterisk -rx "core show channels"'

# –û–±–Ω–æ–≤–ª—è—Ç—å endpoints –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
watch -n 10 'sudo asterisk -rx "pjsip show endpoints"'

# –°—á–∏—Ç–∞—Ç—å –∞—Ç–∞–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 5 'sudo grep "No matching endpoint" /var/log/asterisk/messages.log | tail -20'
```

---

## üõ†Ô∏è –ö–û–ú–ê–ù–î–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Asterisk (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∑–≤–æ–Ω–∫–∏!)
sudo systemctl restart asterisk

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å PJSIP (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ pjsip.conf)
sudo asterisk -rx "pjsip reload"

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Dialplan (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ extensions.conf)
sudo asterisk -rx "dialplan reload"

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å HTTP/ARI (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ http.conf)
sudo asterisk -rx "module reload http.so"

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–≤–æ–Ω–∫–æ–≤)
sudo asterisk -rx "core reload"
```

---

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –í–∫–ª—é—á–∏—Ç—å PJSIP –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—á–µ–Ω—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ!)
sudo asterisk -rx "pjsip set logger on"

# –í—ã–∫–ª—é—á–∏—Ç—å PJSIP –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
sudo asterisk -rx "pjsip set logger off"

# –£–≤–µ–ª–∏—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –æ—Ç–ª–∞–¥–∫–∏
sudo asterisk -rx "core set verbose 5"
sudo asterisk -rx "core set debug 5"

# –í–µ—Ä–Ω—É—Ç—å –æ–±—ã—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
sudo asterisk -rx "core set verbose 0"
sudo asterisk -rx "core set debug 0"
```

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
sudo asterisk -rx "core show channels"

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª
sudo asterisk -rx "channel request hangup PJSIP/novofon-incoming-00000123"

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –í–°–ï –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
sudo asterisk -rx "core stop gracefully"
```

---

## üö® –¢–ò–ü–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ó–≤–æ–Ω–∫–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ("–ê–±–æ–Ω–µ–Ω—Ç –∑–∞–Ω—è—Ç")

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–≤–æ–Ω–æ–∫ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç, "busy signal"
- –í –ª–æ–≥–∞—Ö Python –±–æ—Ç–∞ –Ω–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoints
sudo asterisk -rx "pjsip show endpoints"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å identify
sudo asterisk -rx "pjsip show identifies"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dialplan
sudo asterisk -rx "dialplan show from-novofon"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –±–æ—Ç
ps aux | grep stasis_handler
```

**–†–µ—à–µ–Ω–∏—è:**

1. **–ï—Å–ª–∏ identify –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /etc/asterisk/pjsip.conf
   sudo grep -A 5 "novofon-identify" /etc/asterisk/pjsip.conf
   
   # –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
   # –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
   sudo asterisk -rx "pjsip reload"
   ```

2. **–ï—Å–ª–∏ Python –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   cd /root/Asterisk_bot/asterisk-vox-bot
   source venv/bin/activate
   python app/backend/asterisk/stasis_handler_optimized.py
   ```

3. **–ï—Å–ª–∏ dialplan –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /etc/asterisk/extensions.conf
   sudo nano /etc/asterisk/extensions.conf
   
   # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å dialplan
   sudo asterisk -rx "dialplan reload"
   ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Python –±–æ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ARI

**–°–∏–º–ø—Ç–æ–º—ã:**
- Python –±–æ—Ç –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ARI
- –í –ª–æ–≥–∞—Ö: Connection refused –∏–ª–∏ Timeout

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP/ARI —Å—Ç–∞—Ç—É—Å
sudo asterisk -rx "http show status"

# 2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é
curl -u asterisk:asterisk123 http://localhost:8088/ari/asterisk/info

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª –±–æ—Ç–∞
cat /root/Asterisk_bot/asterisk-vox-bot/.env | grep ARI
```

**–†–µ—à–µ–Ω–∏—è:**

1. **–ï—Å–ª–∏ HTTP –Ω–µ –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /etc/asterisk/http.conf
   sudo nano /etc/asterisk/http.conf
   
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   # [general]
   # enabled = yes
   # bindaddr = 127.0.0.1
   # bindport = 8088
   
   # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
   sudo asterisk -rx "module reload http.so"
   ```

2. **–ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /etc/asterisk/ari.conf
   sudo cat /etc/asterisk/ari.conf
   
   # –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å .env —Ñ–∞–π–ª–æ–º –±–æ—Ç–∞
   # ARI_USERNAME=asterisk
   # ARI_PASSWORD=asterisk123
   ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∏–ª–∏ –Ω–µ —Å–ª—ã—à–µ–Ω –∑–≤—É–∫

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–≤–æ–Ω–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –±–æ—Ç –º–æ–ª—á–∏—Ç
- –í –ª–æ–≥–∞—Ö: "ARI playback –Ω–µ —É–¥–∞–ª—Å—è"

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
ls -la /var/lib/asterisk/sounds/

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Python –±–æ—Ç–∞
# –ò—â–∏—Ç–µ "‚úÖ ARI playback" –∏–ª–∏ "‚ùå ARI playback –Ω–µ —É–¥–∞–ª—Å—è"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ playback
sudo asterisk -rx "core show channels"
```

**–†–µ—à–µ–Ω–∏—è:**

1. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏:**
   ```bash
   sudo chown -R asterisk:asterisk /var/lib/asterisk/sounds/
   sudo chmod -R 755 /var/lib/asterisk/sounds/
   ```

2. **–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Yandex TTS
   cat /root/Asterisk_bot/asterisk-vox-bot/.env | grep YANDEX
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—É Yandex SpeechKit
   ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ê—Ç–∞–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è (–º—É—Å–æ—Ä–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö Python –±–æ—Ç–∞ –≤–∏–¥–Ω—ã –∑–≤–æ–Ω–∫–∏ —Å –Ω–æ–º–µ—Ä–æ–≤ —Ç–∏–ø–∞ 7005, 2600
- –ó–≤–æ–Ω–∫–∏ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö IP –ø—Ä–æ—Ö–æ–¥—è—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å identify –ø—Ä–∞–≤–∏–ª–∞
sudo asterisk -rx "pjsip show identifies"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ç –ª–∏ anonymous endpoint
sudo asterisk -rx "pjsip show endpoint anonymous"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dialplan –ø—Ä–∞–≤–∏–ª–æ _X.
sudo asterisk -rx "dialplan show from-novofon" | grep "_X."
```

**–†–µ—à–µ–Ω–∏—è:**

1. **–ï—Å–ª–∏ anonymous endpoint –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
   ```bash
   # –£–¥–∞–ª–∏—Ç—å –∏–∑ /etc/asterisk/pjsip.conf
   sudo nano /etc/asterisk/pjsip.conf
   # –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å [anonymous]
   
   # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
   sudo asterisk -rx "pjsip reload"
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
   sudo asterisk -rx "pjsip show endpoint anonymous"
   # –î–æ–ª–∂–Ω–æ: Unable to find object anonymous
   ```

2. **–ï—Å–ª–∏ _X. –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–≤–æ–Ω–∫–∏:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ _X. –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç Answer()
   sudo asterisk -rx "dialplan show from-novofon" | grep -A 3 "_X."
   
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   # '_X.' => 1. NoOp(–ë–õ–û–ö–ò–†–û–í–ö–ê...)
   #          2. Hangup()
   # –ë–ï–ó Answer()!
   ```

---

## üìä –†–ï–ì–£–õ–Ø–†–ù–û–ï –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
sudo asterisk -rx "pjsip show endpoints"
sudo asterisk -rx "stasis show apps"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ç–∞–∫
sudo grep "No matching endpoint" /var/log/asterisk/messages.log | wc -l

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
sudo tail -100 /var/log/asterisk/messages.log | grep ERROR
```

---

### –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt update && sudo apt upgrade

# 2. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo mkdir -p /root/backup-asterisk/$(date +%Y-%m)
sudo tar -czf /root/backup-asterisk/$(date +%Y-%m)/asterisk-$(date +%F).tgz /etc/asterisk

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
sudo grep -i "attack\|hack\|unauthorized" /var/log/asterisk/messages.log

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è)
sudo asterisk -rx "pjsip show identifies"
```

---

## üìû –°–ü–†–ê–í–û–ß–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏

| –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `/etc/asterisk/pjsip.conf` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PJSIP (endpoints, identify) |
| `/etc/asterisk/extensions.conf` | Dialplan (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤) |
| `/etc/asterisk/ari.conf` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ARI |
| `/etc/asterisk/http.conf` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTP/ARI —Å–µ—Ä–≤–µ—Ä–∞ |
| `/var/log/asterisk/messages.log` | –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ Asterisk |
| `/var/log/asterisk/full` | –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã) |
| `/var/lib/asterisk/sounds/` | –ó–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã (TTS) |
| `/var/spool/asterisk/recording/` | –ó–∞–ø–∏—Å–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ (ASR) |
| `/root/Asterisk_bot/asterisk-vox-bot/` | Python –±–æ—Ç |

---

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**Novofon:**
- –°–∞–π—Ç: https://novofon.com/
- –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä: **79581114700**
- SIP-—Å–µ—Ä–≤–µ—Ä—ã:
  - `sip.novofon.ru` (37.139.38.224)
  - `pbx.novofon.com` (37.139.38.56)

---

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Asterisk Documentation**: https://docs.asterisk.org/
- **PJSIP Configuration**: https://wiki.asterisk.org/wiki/display/AST/Configuring+res_pjsip
- **ARI Documentation**: https://docs.asterisk.org/Asterisk_REST_Interface/
- **Yandex SpeechKit**: https://cloud.yandex.ru/docs/speechkit/

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ë–´–°–¢–†–û–ô –ü–†–û–í–ï–†–ö–ò

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã:

```bash
# 1. Asterisk –∑–∞–ø—É—â–µ–Ω?
sudo systemctl status asterisk
# ‚úÖ –î–æ–ª–∂–Ω–æ: active (running)

# 2. Endpoints –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã?
sudo asterisk -rx "pjsip show endpoints" | grep novofon-incoming
# ‚úÖ –î–æ–ª–∂–Ω–æ: novofon-incoming   Unavailable   0 of inf

# 3. Identify –ø—Ä–∞–≤–∏–ª–∞ –µ—Å—Ç—å?
sudo asterisk -rx "pjsip show identifies"
# ‚úÖ –î–æ–ª–∂–Ω–æ: Match: 37.139.38.224/32 –∏ 37.139.38.56/32

# 4. Anonymous endpoint —É–¥–∞–ª–µ–Ω?
sudo asterisk -rx "pjsip show endpoint anonymous"
# ‚úÖ –î–æ–ª–∂–Ω–æ: Unable to find object anonymous

# 5. Dialplan –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?
sudo asterisk -rx "dialplan show 79581114700@from-novofon"
# ‚úÖ –î–æ–ª–∂–Ω–æ: –ø–æ–∫–∞–∑–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç —Å Stasis(asterisk-bot)

# 6. ARI –Ω–∞ localhost?
sudo asterisk -rx "http show status"
# ‚úÖ –î–æ–ª–∂–Ω–æ: Bound to 127.0.0.1:8088

# 7. Python –±–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω?
sudo asterisk -rx "stasis show apps"
# ‚úÖ –î–æ–ª–∂–Ω–æ: asterisk-bot

# 8. –ê—Ç–∞–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è?
sudo tail -20 /var/log/asterisk/messages.log | grep "No matching endpoint"
# ‚úÖ –î–æ–ª–∂–Ω–æ: –≤–∏–¥–µ—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç —Å–∫–∞–Ω–µ—Ä–æ–≤
```

–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã ‚úÖ - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 01.10.2025  
**–ê–≤—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: AI Cursor Assistant  
**–í–µ—Ä—Å–∏—è Asterisk**: 20.6.0
