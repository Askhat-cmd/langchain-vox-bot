# Инструкция по админ‑панели (понятно и коротко)

## 1. Логи и диалоги
- Таблица — все звонки. Клик по строке открывает модалку с деталями и полным диалогом.
- Метка источника ответа бота: `[general]` или `[tech]` — видна в таблице и под фразами бота в модалке.
- Быстрые фильтры: Сегодня/Вчера/Неделя. Можно задать даты вручную.
- Сортировка по клику на заголовки (ID/Номер/Начало/Длительность/Статус).

## 2. Базы знаний
- «База знаний (general)» — показывает `knowledge_base.md`.
- «База знаний (tech)» — показывает `knowledge_base_2.md`.
- «Обновить БЗ (general)» и «Обновить БЗ (tech)»: выберите `.md` — сервер:
  1) дублирует заголовки (повышает качество поиска),
  2) делает бэкап в `kb_backups/`,
  3) пересобирает общую Chroma с метками `kb=general/tech`,
  4) перезагружает агента.

## 3. Промпты
- «Упр. промптами» — редактирование:
  - `greeting` — приветствие,
  - `contextualize_q_system_prompt` — контекстуализация,
  - `qa_system_prompt` — основной системный промпт.
- Сохранение обновляет файл `prompts.json` и «горячо» перезагружает агента.

## 4. Настройки поиска и модели
- «Настройки поиска» — единое окно параметров:
  - `k` — сколько документов извлекать из БЗ (по умолчанию 3–4). Больше — точнее, но медленнее.
  - `Порог уверенности` — если макс. релевантность ниже, бот пробует вторую БЗ и выбирает лучшую.
  - `Основная модель` — `LLM_MODEL_PRIMARY` (например, `gpt-4o-mini`).
  - `Запасная модель` — `LLM_MODEL_FALLBACK` (опционально). Если основная даст ошибку — бот попробует эту.
  - `Температура` — 0..1. Чем ниже — строже и детерминированнее ответы; 0.2 — базовый компромисс.
- Кнопка «Сохранить» меняет `.env` и перезагружает агента без остановки сервиса.

## 5. Экспорт и очистка
- «Экспорт CSV» — выгрузка логов.
- «Очистить логи» — удаляет все записи (нужен API‑ключ).

## 6. Доступ и безопасность
- Для защищённых операций используется заголовок `X-API-Key`.
- Ключ задаётся в `.env` как `API_SECRET_KEY`. Введите его один раз в модалке — он сохранится в сессии браузера.

## Частые вопросы
- Нет новых звонков в таблице:
  - проверьте, что бэкенд отвечает по `GET /`;
  - посмотрите логи `logs/app.log` и статус сервиса (`systemd`).
- После обновления БЗ ответы не меняются:
  - дождитесь завершения пересоздания эмбеддингов (в логах будет «Эмбеддинги успешно пересозданы», «Агент успешно перезагружен»).
- 401 при сохранении промптов/настроек:
  - введите корректный API‑ключ в модалке, убедитесь в значении `API_SECRET_KEY` в `.env`.
