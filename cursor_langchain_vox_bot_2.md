# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ —á–∞—Ç–µ
_Exported on 8/4/2025 at 14:36:34 GMT+5 from Cursor (1.3.7)_

---

**User**

–ø—Ä–∏–≤–µ—Ç

---

**Cursor**

–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. –ß–µ–º —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?

–ß—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç, —è —Å–µ–π—á–∞—Å –æ–∑–Ω–∞–∫–æ–º–ª—é—Å—å —Å —Ñ–∞–π–ª–∞–º–∏ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

–ü–æ–Ω—è—Ç–Ω–æ. –ø–æ—Ö–æ–∂–µ, —ç—Ç–æ –ø—Ä–æ–µ–∫—Ç –Ω–∞ Python. –í–∏–∂—É —Ñ–∞–π–ª—ã `Agent.py`, `main.py` –∏ `create_embeddings.py`.

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —Å —á–µ–º –º—ã —Ä–∞–±–æ—Ç–∞–µ–º, —è –∏–∑—É—á—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ `requirements.txt`, –∑–∞—Ç–µ–º –ø–æ—Å–º–æ—Ç—Ä—é –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `main.py` –∏, –Ω–∞–∫–æ–Ω–µ—Ü, –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–π —É –≤–∞—Å `create_embeddings.py`.

–û—Ç–ª–∏—á–Ω–æ, —è –æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –≤–∞—à–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º. –í–æ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ, –∫–∞–∫ —è –µ–≥–æ –ø–æ–Ω–∏–º–∞—é:

–≠—Ç–æ –≤–µ–±-—Å–µ—Ä–≤–∏—Å –Ω–∞ **FastAPI**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

*   **`main.py`**: –Ø–¥—Ä–æ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–≤–µ—Ä–æ—è—Ç–Ω–æ, –æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏ Voximplant), —É–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫–æ–π –∑–≤–æ–Ω–∫–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏.
*   **`Agent.py`** (–ø–æ–∫–∞ –Ω–µ —á–∏—Ç–∞–ª, –Ω–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é): –ó–¥–µ—Å—å, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞—à–µ–≥–æ AI-–∞–≥–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ **LangChain** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.
*   **`create_embeddings.py`**: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã —É–∂–µ –∑–∞–ø—É—Å–∫–∞–ª–∏. –û–Ω –±–µ—Ä–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt`, –Ω–∞—Ä–µ–∑–∞–µ—Ç –µ–≥–æ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–µ–π OpenAI —Å–æ–∑–¥–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏), –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **ChromaDB** –≤ –ø–∞–ø–∫–µ `chroma_db_metrotech`.
*   **`requirements.txt`**: –£ –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: `fastapi` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞, `langchain` –∏ `chromadb` –¥–ª—è AI.

–í —Ü–µ–ª–æ–º, —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RAG-–∞–≥–µ–Ω—Ç–∞ (Retrieval-Augmented Generation), –≥–¥–µ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–∞—à–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (`–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt`).

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —è –≤ –∫—É—Ä—Å–µ –¥–µ–ª–∞, —Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫–∞—è —É –≤–∞—Å –∑–∞–¥–∞—á–∞? –ß—Ç–æ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å?

---

**User**

–≤–∑–≥–ª—è–Ω–∏ –º–µ–ª—å–∫–æ–º –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é –Ω–∞—à–µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —á–∞—Ç–∞ –∏ –¥–∞–≤–∞–π –ø—Ä–æ–¥–æ–ª–∂–∏–º —Ä–∞–±–æ—Ç—É:
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –∏–∑ –∞–¥–º–∏–Ω–∫–∏ (–ù–∞ –±—É–¥—É—â–µ–µ)
–ß—Ç–æ —ç—Ç–æ?
–ú—ã –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –ø–∞–Ω–µ–ª—å –∫–Ω–æ–ø–∫—É ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é –ë–ó¬ª. –í—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π .txt —Ñ–∞–π–ª, –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –∏ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω–∏—Ç —Å—Ç–∞—Ä—ã–π, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–ª—è –±–æ—Ç–∞.
–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç create_embeddings.py –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è –±–æ—Ç–∞. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π –∏ —É–¥–æ–±–Ω–æ–π –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏.
–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞. –û–Ω–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –∑–∞–ø—É—Å–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤.

–£ –Ω–∞—Å —É–∂–µ –∏–º–µ–µ—Ç—Å—è –ø–∞–ø–∫–∞ –¥–ª—è –ë—ç–∫–∞–ø–∞, –í–°–ï–ì–î–ê –°–û–ó–î–ê–í–ê–ô –ë–≠–ö–ê–ü, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –æ—Ç–∫–∞—Ç—å—Å—è –∏ –≤–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Å–ª—É—á–∞–π –Ω–µ—É–¥–∞—á–∏

---

**Cursor**

–•–æ—Ä–æ—à–æ, —è –æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –∏—Å—Ç–æ—Ä–∏–µ–π. –û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–ë–ó) ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π —à–∞–≥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —É–¥–æ–±–Ω–æ–π –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

–Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω —Å –ø–ª–∞–Ω–æ–º. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞, –Ω–æ –º—ã —Å–ø—Ä–∞–≤–∏–º—Å—è. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –±—É–¥—É—Ç –Ω–∞—à–∏–º–∏ –≥–ª–∞–≤–Ω—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏, –ø–æ—ç—Ç–æ–º—É —è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –±—É–¥—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø—ã, –∫–∞–∫ –≤—ã –∏ –ø—Ä–æ—Å–∏–ª–∏.

–î–∞–≤–∞–π—Ç–µ —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–ª–∞–Ω –∏ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ —Ä–∞–±–æ—Ç–µ.

### –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1.  **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**:
    *   –°–æ–∑–¥–∞–¥–∏–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è –±—ç–∫–∞–ø–æ–≤ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.
    *   –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–∫—Ä–∏–ø—Ç `create_embeddings.py` –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

2.  **–ë—ç–∫–µ–Ω–¥ (FastAPI)**:
    *   –í `main.py` –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π API-endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/kb/upload`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `POST`-–∑–∞–ø—Ä–æ—Å—ã —Å —Ñ–∞–π–ª–æ–º.
    *   –†–µ–∞–ª–∏–∑—É–µ–º –ª–æ–≥–∏–∫—É:
        1.  **–ë—ç–∫–∞–ø**: –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª `–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt` –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É –¥–ª—è –±—ç–∫–∞–ø–æ–≤ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∏–º—è —Ñ–∞–π–ª–∞.
        2.  **–ó–∞–º–µ–Ω–∞**: –ù–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –µ–≥–æ –º–µ—Å—Ç–æ.
        3.  **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: –ó–∞–ø—É—Å—Ç–∏–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä.

3.  **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ê–¥–º–∏–Ω–∫–∞)**:
    *   –Ø –∏–∑—É—á—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ `logs-ui`, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞.
    *   –î–æ–±–∞–≤–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π.

–ù–∞—á–Ω–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. –Ø —Å–æ–∑–¥–∞–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤ –∏ –∏–∑—É—á—É, —á—Ç–æ —É –Ω–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `logs-ui`.

–û—Ç–ª–∏—á–Ω–æ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `kb_backups` —Å–æ–∑–¥–∞–Ω–∞. –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

–Ø —Ç–∞–∫–∂–µ –∏–∑—É—á–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É `logs-ui`. –£ –Ω–∞—Å –µ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤: `index.html`, `index.css` –∏ `index.js`. –≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞.

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥–µ–º –∫–æ –≤—Ç–æ—Ä–æ–º—É, —Å–∞–º–æ–º—É –≤–∞–∂–Ω–æ–º—É —à–∞–≥—É: **–æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –±—ç–∫–µ–Ω–¥–∞**. –Ø –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é `main.py`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞.

–ü—Ä–µ–∂–¥–µ —á–µ–º —è –Ω–∞—á–Ω—É, –∫–∞–∫ –≤—ã –∏ –ø—Ä–æ—Å–∏–ª–∏, **—è —Å–æ–∑–¥–∞–º –ø–æ–ª–Ω—ã–π –±–µ–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞**.

---

**User**

–ø–æ—Å–º–æ—Ç—Ä–∏ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –±—ç–∫–∞–ø –Ω–∞ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é

---

**Cursor**

–í—ã –ø—Ä–∞–≤—ã, —è –≤–∏–∂—É, —á—Ç–æ –±—ç–∫–∞–ø `backup_2025-08-04_05-45-27` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –û—Ç–ª–∏—á–Ω–æ, –∑–Ω–∞—á–∏—Ç, –º—ã –º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª–∏ –Ω–∞ —ç—Ç–æ –º–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ.

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É –Ω–∞—à–µ–≥–æ –ø–ª–∞–Ω–∞: **–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é `create_embeddings.py` –≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é**.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞–º –≤—ã–∑—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä—è–º–æ –∏–∑ `main.py` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –Ø —Å–¥–µ–ª–∞—é —ç—Ç–æ —Ç–∞–∫, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.

–Ø –∏–∑–º–µ–Ω—é `create_embeddings.py`, –æ–±–µ—Ä–Ω—É–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏—é `recreate_embeddings`.

–û—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å —è –∏–∑–º–µ–Ω—é —Ñ–∞–π–ª, –æ–±–µ—Ä–Ω—É–≤ –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –≤ —Ñ—É–Ω–∫—Ü–∏—é `recreate_embeddings` –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–≤ `main` –≤ `main_cli`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞. –¢–∞–∫–∂–µ —è –¥–æ–±–∞–≤–ª—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ `print`.

```python
import os
import logging
from langchain_community.vectorstores import Chroma
from langchain_openai import OpenAIEmbeddings
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_community.document_loaders import TextLoader
from dotenv import load_dotenv

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

def recreate_embeddings():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
    """
    load_dotenv()
    logging.info("--- –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ ---")

    script_dir = os.path.dirname(os.path.abspath(__file__))
    source_document_path = os.path.join(script_dir, "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt")
    persist_directory = os.path.join(script_dir, "chroma_db_metrotech")
    chunk_size = 1000
    chunk_overlap = 200

    logging.info(f"1/4: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ '{source_document_path}'...")
    if not os.path.exists(source_document_path):
        logging.error(f"–§–∞–π–ª '{source_document_path}' –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return

    loader = TextLoader(source_document_path, encoding='utf-8')
    documents = loader.load()
    logging.info(f"–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü: {len(documents)}")

    logging.info(f"2/4: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞–Ω–∫–∏ (—Ä–∞–∑–º–µ—Ä: {chunk_size}, –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ: {chunk_overlap})...")
    text_splitter = RecursiveCharacterTextSplitter(chunk_size=chunk_size, chunk_overlap=chunk_overlap)
    texts = text_splitter.split_documents(documents)
    logging.info(f"–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ {len(texts)} —á–∞–Ω–∫–æ–≤.")

    logging.info("3/4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ OpenAI...")
    embeddings = OpenAIEmbeddings(chunk_size=1000)
    logging.info("–ú–æ–¥–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.")

    logging.info(f"4/4: –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –≤ –ø–∞–ø–∫—É '{persist_directory}'...")
    db = Chroma.from_documents(
        texts,
        embeddings,
        persist_directory=persist_directory
    )
    logging.info("--- –ü—Ä–æ—Ü–µ—Å—Å —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω! ---")
    logging.info(f"–í–∞—à–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≥–æ—Ç–æ–≤–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–∞–ø–∫–µ '{persist_directory}'.")
    return True

def main_cli():
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.
    """
    recreate_embeddings()

if __name__ == "__main__":
    main_cli()

```

–û—Ç–ª–∏—á–Ω–æ, —Å–∫—Ä–∏–ø—Ç `create_embeddings.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ –º–æ–¥—É–ª—å —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `recreate_embeddings`. –ú—ã –Ω–∞ –æ–¥–∏–Ω —à–∞–≥ –ø—Ä–∏–±–ª–∏–∑–∏–ª–∏—Å—å –∫ —Ü–µ–ª–∏.

–¢–µ–ø–µ—Ä—å —è –ø—Ä–∏—Å—Ç—É–ø–ª—é –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏: **–æ–±–Ω–æ–≤–ª–µ–Ω–∏—é `main.py`**. –Ø –¥–æ–±–∞–≤–ª—é –≤ –Ω–µ–≥–æ –Ω–æ–≤—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞.

–¢–∞–∫ –∫–∞–∫ –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –º–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ `UploadFile`, `File`, `shutil`, `asyncio` –∏ `subprocess`.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª `main.py`. –¢–µ–ø–µ—Ä—å —è –¥–æ–±–∞–≤–ª—é –≤ –Ω–µ–≥–æ –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /kb/upload` –∏ –≤—Å—é —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É: –∏–º–ø–æ—Ä—Ç—ã, —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.

```python
"""
–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- WebSocket-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Voximplant
- API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- –°—Ç–∞—Ç–∏–∫–∞ –¥–ª—è UI –ª–æ–≥–æ–≤
"""
import os, logging, uuid, json, asyncio, io, shutil, subprocess, time
from datetime import datetime, timezone
from typing import Dict, Any, List

from fastapi import FastAPI, WebSocket, WebSocketDisconnect, Query, status, UploadFile, File
from fastapi.responses import HTMLResponse, JSONResponse, StreamingResponse
from fastapi.staticfiles import StaticFiles
from dotenv import load_dotenv

from Agent import Agent
from log_storage import insert_log, query_logs, to_csv, delete_all_logs
from create_embeddings import recreate_embeddings

# --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---

load_dotenv()
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI()
app.mount("/logs-ui", StaticFiles(directory="logs-ui", html=True), name="logs-ui")

try:
    agent = Agent()
    logger.info("–ê–≥–µ–Ω—Ç '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.")
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç': {e}", exc_info=True)
    agent = None

# --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏ ---
active_calls: Dict[str, Dict[str, Any]] = {}

# --- –†–æ—É—Ç—ã ---

@app.get("/")
async def root():
    return HTMLResponse(
        "<h3>–ë—ç–∫–µ–Ω–¥ '–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç' –∞–∫—Ç–∏–≤–µ–Ω.<br>"
        "‚Ä¢ WebSocket¬†‚Äî¬†<code>/ws</code><br>"
        "‚Ä¢ UI –ª–æ–≥–æ–≤¬†‚Äî¬†<code>/logs-ui/</code></h3>"
    )

@app.get("/logs")
async def get_logs(q: str | None = None,
                   date_from: str | None = None,
                   date_to: str | None = None,
                   status: str | None = None):
    rows = await query_logs({"from": date_from, "to": date_to, "status": status})
    if q:
        q_low = q.lower()
        filtered_rows = []
        for r in rows:
            if q_low in (r.get("callerId") or "").lower():
                filtered_rows.append(r)
                continue
            try:
                transcript = json.loads(r["transcript_json"])
                for turn in transcript:
                    if q_low in turn.get("text", "").lower():
                        filtered_rows.append(r)
                        break
            except (json.JSONDecodeError, AttributeError):
                continue
        rows = filtered_rows
    return JSONResponse(content=rows)

@app.delete("/logs")
async def clear_logs():
    """
    –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ª–æ–≥–∏.
    """
    try:
        await delete_all_logs()
        logger.info("üóëÔ∏è –í—Å–µ –ª–æ–≥–∏ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã.")
        return JSONResponse(content={"message": "–í—Å–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã"}, status_code=status.HTTP_200_OK)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–≥–æ–≤: {e}", exc_info=True)
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.get("/logs/csv")
async def get_logs_csv():
    rows = await query_logs({})
    csv_data_str = await to_csv(rows)
    response_bytes = csv_data_str.encode('utf-8-sig')
    return StreamingResponse(
        io.BytesIO(response_bytes),
        media_type="text/csv",
        headers={"Content-Disposition": 'attachment; filename="call_logs.csv"'}
    )

@app.get("/kb")
async def get_knowledge_base():
    kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
    try:
        with open(kb_path, 'r', encoding='utf-8') as f:
            content = f.read()
        return JSONResponse(content={"text": content})
    except FileNotFoundError:
        return JSONResponse(content={"error": "–§–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω"}, status_code=status.HTTP_404_NOT_FOUND)
    except Exception as e:
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.post("/kb/upload")
async def upload_kb(file: UploadFile = File(...)):
    if not file.filename.endswith('.txt'):
        return JSONResponse(status_code=400, content={"message": "–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ .txt —Ñ–∞–π–ª."})

    try:
        kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
        
        # 1. –ë—ç–∫–∞–ø
        backup_dir = "kb_backups"
        os.makedirs(backup_dir, exist_ok=True)
        timestamp = time.strftime("%Y-%m-%d_%H-%M-%S")
        backup_path = os.path.join(backup_dir, f"–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢_{timestamp}.txt.bak")
        shutil.copy(kb_path, backup_path)
        logger.info(f"üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {backup_path}")

        # 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
        with open(kb_path, "wb") as buffer:
            shutil.copyfileobj(file.file, buffer)
        
        logger.info(f"‚úÖ –ù–æ–≤—ã–π —Ñ–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π '{file.filename}' —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")

        # 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
        asyncio.create_task(recreate_embeddings_and_reload_agent())
        
        return JSONResponse(status_code=202, content={"message": "–§–∞–π–ª –ø—Ä–∏–Ω—è—Ç. –ù–∞—á–∞–ª—Å—è –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."})

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ë–ó: {e}", exc_info=True)
        return JSONResponse(status_code=500, content={"message": f"–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}"})

async def recreate_embeddings_and_reload_agent():
    logger.info("‚è≥ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ...")
    loop = asyncio.get_event_loop()
    try:
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop
        await loop.run_in_executor(None, recreate_embeddings)
        logger.info("‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã.")
        
        # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∞–≥–µ–Ω—Ç–∞
        if agent and hasattr(agent, 'reload'):
            agent.reload()
            
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {e}", exc_info=True)


@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket, callerId: str = Query(None)):
    await websocket.accept()
    session_id = str(uuid.uuid4())
    start_time = datetime.now(timezone.utc)
    
    active_calls[session_id] = {
        "callerId": callerId,
        "startTime": start_time.isoformat(),
        "transcript": [],
        "status": "Initiated"
    }
    logger.info(f"–ù–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫: Session ID: {session_id}, Caller ID: {callerId}")

    if not agent:
        await websocket.send_text("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞.")
        await websocket.close()
        del active_calls[session_id]
        return

    try:
        greeting = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –í—ã –ø–æ–∑–≤–æ–Ω–∏–ª–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é ¬´–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç¬ª. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?"
        active_calls[session_id]["transcript"].append(
            {"speaker": "bot", "text": greeting, "timestamp": datetime.now(timezone.utc).isoformat()}
        )
        await websocket.send_text(greeting)

        while True:
            data = await websocket.receive_text()
            logger.info(f"–ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å ({session_id}): {data}")
            active_calls[session_id]["transcript"].append(
                {"speaker": "user", "text": data, "timestamp": datetime.now(timezone.utc).isoformat()}
            )

            response_generator = agent.get_response_generator(data, session_id=session_id)
            
            full_response = ""
            for chunk in response_generator:
                if chunk:
                    await websocket.send_text(chunk)
                    full_response += chunk
            
            logger.info(f"–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç ({session_id}) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.")
            active_calls[session_id]["transcript"].append(
                {"speaker": "bot", "text": full_response, "timestamp": datetime.now(timezone.utc).isoformat()}
            )
            active_calls[session_id]["status"] = "InProgress"

    except WebSocketDisconnect:
        logger.info(f"–ö–ª–∏–µ–Ω—Ç ({session_id}) –æ—Ç–∫–ª—é—á–∏–ª—Å—è.")
        active_calls[session_id]["status"] = "Completed"
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ WS ({session_id}): {e}", exc_info=True)
        active_calls[session_id]["status"] = "Failed"
    finally:
        end_time = datetime.now(timezone.utc)
        call_log = active_calls.get(session_id)
        if call_log:
            log_record: Dict[str, Any] = {
                "id": session_id,
                "callerId": call_log["callerId"],
                "startTime": call_log["startTime"],
                "endTime": end_time.isoformat(),
                "status": call_log["status"],
                "transcript": call_log["transcript"],
            }
            try:
                await insert_log(log_record)
                logger.info(f"üíæ –õ–æ–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è Session {session_id}")
            except Exception as err:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ insert_log: {err}", exc_info=True)
            
            del active_calls[session_id]

```

–û—Ç–ª–∏—á–Ω–æ, –±—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤. –Ø –æ–±–Ω–æ–≤–∏–ª `main.py`, –¥–æ–±–∞–≤–∏–≤ –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –õ–∏–Ω—Ç–µ—Ä –Ω–µ –ø–æ–∫–∞–∑–∞–ª –æ—à–∏–±–æ–∫, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º –∑–Ω–∞–∫–æ–º.

–¢–µ–ø–µ—Ä—å —è –ø—Ä–∏—Å—Ç—É–ø–ª—é –∫ –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–º—É —ç—Ç–∞–ø—É: **–æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**. –Ø –¥–æ–±–∞–≤–ª—é –≤ `logs-ui/index.js` –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó", –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª `logs-ui/index.js` –∏ `Agent.py`. –¢–µ–ø–µ—Ä—å —è –≤–Ω–µ—Å—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±–∞ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

–°–Ω–∞—á–∞–ª–∞ —è –æ–±–Ω–æ–≤–ª—é `Agent.py`, –¥–æ–±–∞–≤–∏–≤ –º–µ—Ç–æ–¥ `reload()`.

```python
from langchain_openai import ChatOpenAI, OpenAIEmbeddings
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain.chains import create_retrieval_chain
from langchain.chains.combine_documents import create_stuff_documents_chain
from langchain.chains import create_history_aware_retriever
from langchain_community.vectorstores import Chroma
from dotenv import load_dotenv
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.runnables.history import RunnableWithMessageHistory
import logging

load_dotenv()

PERSIST_DIRECTORY = "chroma_db_metrotech"
logger = logging.getLogger(__name__)

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏
contextualize_q_system_prompt = """–£—á–∏—Ç—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞, \
—Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞. –ù–ï –æ—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å, \
–ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –µ–≥–æ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤–µ—Ä–Ω–∏ –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å."""

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–∞ (–±–µ–∑ —Å–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏)
qa_system_prompt = """
–¢—ã ‚Äî —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –Ω–µ–π—Ä–æ-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç "–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç".
- –û—Ç–≤–µ—á–∞–π –≤–µ–∂–ª–∏–≤–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –ø–æ –¥–µ–ª—É, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.
- –§–æ—Ä–º–∏—Ä—É–π –æ—Ç–≤–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é. –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å—Ç–∞–≤—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å "|".
- –ï—Å–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å.
- –ï—Å–ª–∏ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞, —Å–æ–æ–±—â–∏ –æ–± —ç—Ç–æ–º.
- –ò—Å–ø–æ–ª—å–∑—É–π –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

---
**–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**
{context}
---
"""

class Agent:
    def __init__(self) -> None:
        logger.info("--- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ê–≥–µ–Ω—Ç–∞ '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' ---")
        self.llm = ChatOpenAI(model_name="gpt-4o-mini", temperature=0.2, streaming=True)
        self.store = {}
        self._initialize_rag_chain()
        logger.info("--- –ê–≥–µ–Ω—Ç '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ---")

    def _initialize_rag_chain(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã RAG."""
        logger.info("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG-—Ü–µ–ø–æ—á–∫–∏...")
        
        logger.info(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –≤ '{PERSIST_DIRECTORY}'...")
        embeddings = OpenAIEmbeddings(chunk_size=1000)
        self.db = Chroma(persist_directory=PERSIST_DIRECTORY, embedding_function=embeddings)
        self.retriever = self.db.as_retriever(search_type="mmr", search_kwargs={"k": 5})
        logger.info("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ.")
        
        contextualize_q_prompt = ChatPromptTemplate.from_messages(
            [("system", contextualize_q_system_prompt), MessagesPlaceholder("chat_history"), ("human", "{input}")]
        )
        history_aware_retriever = create_history_aware_retriever(self.llm, self.retriever, contextualize_q_prompt)

        qa_prompt = ChatPromptTemplate.from_messages(
            [("system", qa_system_prompt), MessagesPlaceholder("chat_history"), ("human", "{input}")]
        )
        question_answer_chain = create_stuff_documents_chain(self.llm, qa_prompt)
        
        rag_chain = create_retrieval_chain(history_aware_retriever, question_answer_chain)
        
        self.conversational_rag_chain = RunnableWithMessageHistory(
            rag_chain,
            self.get_session_history,
            input_messages_key="input",
            history_messages_key="chat_history",
            output_messages_key="answer",
        )
        logger.info("--- RAG-—Ü–µ–ø–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∞ ---")

    def reload(self):
        """–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ RAG-—Ü–µ–ø–æ—á–∫—É."""
        logger.info("üîÉ –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –∞–≥–µ–Ω—Ç–∞...")
        try:
            self._initialize_rag_chain()
            logger.info("‚úÖ –ê–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω —Å –Ω–æ–≤–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π.")
            return True
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –∞–≥–µ–Ω—Ç–∞: {e}", exc_info=True)
            return False

    def get_session_history(self, session_id: str):
        if session_id not in self.store:
            self.store[session_id] = ChatMessageHistory()
        return self.store[session_id]

    def get_response_generator(self, user_question: str, session_id: str):
        stream = self.conversational_rag_chain.stream(
            {"input": user_question},
            config={"configurable": {"session_id": session_id}},
        )
        for chunk in stream:
            if 'answer' in chunk:
                yield chunk['answer']

```

–û—Ç–ª–∏—á–Ω–æ, `Agent.py` –æ–±–Ω–æ–≤–ª–µ–Ω. –¢–µ–ø–µ—Ä—å —è –æ–±–Ω–æ–≤–ª—é `logs-ui/index.js`, –¥–æ–±–∞–≤–∏–≤ –∫–Ω–æ–ø–∫—É –∏ –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

// Utility functions
const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

// Icons as SVG components
const SearchIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  className: "search-icon"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"
}));

const DownloadIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
}));

const BookIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
}));

const TrashIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
}));

const CloseIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "20",
  height: "20"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M6 18L18 6M6 6l12 12"
}));

const EmptyIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
}));

// Components
const StatsCard = ({ number, label, color = "var(--primary)" }) =>
  React.createElement("div", { className: "stat-card" },
    React.createElement("div", {
      className: "stat-number",
      style: { color }
    }, number),
    React.createElement("div", { className: "stat-label" }, label)
  );

const LogTable = ({ logs, onRowClick }) => {
  if (logs.length === 0) {
    return React.createElement("div", { className: "empty-state" },
      React.createElement(EmptyIcon),
      React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
      React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
    );
  }

  return React.createElement("div", { className: "table-container" },
    React.createElement("table", { className: "table" },
      React.createElement("thead", null,
        React.createElement("tr", null,
          ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map((header) =>
            React.createElement("th", { key: header }, header)
          )
        )
      ),
      React.createElement("tbody", null,
        logs.map((log) =>
          React.createElement("tr", {
            key: log.id,
            onClick: () => onRowClick(log)
          },
            React.createElement("td", null,
              React.createElement("code", null, log.id.slice(0, 8) + "...")
            ),
            React.createElement("td", null, log.callerId || "‚Äî"),
            React.createElement("td", null, formatDate(log.startTime)),
            React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
            React.createElement("td", null,
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        )
      )
    )
  );
};

const Modal = ({ log, onClose }) => {
  if (!log) return null;

  let transcript = [];
  try {
    transcript = JSON.parse(log.transcript_json);
  } catch (e) {
    transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
  }

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("div", { className: "info-grid" },
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "ID –∑–≤–æ–Ω–∫–∞"),
            React.createElement("div", { className: "info-value" },
              React.createElement("code", null, log.id)
            )
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"),
            React.createElement("div", { className: "info-value" }, log.callerId || "–ù–µ —É–∫–∞–∑–∞–Ω")
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"),
            React.createElement("div", { className: "info-value" }, formatDate(log.startTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è"),
            React.createElement("div", { className: "info-value" }, formatDate(log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"),
            React.createElement("div", { className: "info-value" }, formatDuration(log.startTime, log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–°—Ç–∞—Ç—É—Å"),
            React.createElement("div", { className: "info-value" },
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        ),
        React.createElement("div", { className: "transcript" },
          React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
          transcript.map((turn, index) =>
            React.createElement("div", {
              key: index,
              className: `turn ${turn.speaker}`
            }, turn.text)
          )
        )
      )
    )
  );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
  if (!content) return null;

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("pre", {
          style: {
            whiteSpace: 'pre-wrap',
            lineHeight: '1.6',
            background: 'var(--bg-primary)',
            padding: '1rem',
            borderRadius: '0.5rem',
            border: '1px solid var(--border)'
          }
        }, content.text || content.error)
      )
    )
  );
};

const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');

  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;

    return { total, completed, failed, interrupted };
  }, [logs]);

  const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);

    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());

      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };

  const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };

  const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };

  const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);

    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();

        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };

  const debouncedFetch = useCallback(
    debounce((searchQuery) => fetchLogs(searchQuery), 300),
    [dateFrom, dateTo]
  );

  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
      React.createElement("h1", null, "Admin Panel"),
      React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
        "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
      )
    ),

    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, {
            number: stats.total,
            label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤",
            color: "var(--primary)"
          }),
          React.createElement(StatsCard, {
            number: stats.completed,
            label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö",
            color: "var(--success)"
          }),
          React.createElement(StatsCard, {
            number: stats.interrupted,
            label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö",
            color: "var(--warning)"
          }),
          React.createElement(StatsCard, {
            number: stats.failed,
            label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö",
            color: "var(--danger)"
          })
    ),

    React.createElement("div", { className: "controls" },
      React.createElement("div", { className: "search-container" },
        React.createElement(SearchIcon),
        React.createElement("input", {
          type: "text",
          className: "search-input",
          placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...",
          value: query,
          onChange: (e) => setQuery(e.target.value)
        })
      ),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateFrom,
        onChange: (e) => setDateFrom(e.target.value)
      }),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateTo,
        onChange: (e) => setDateTo(e.target.value)
      }),
      React.createElement("a", {
        href: "/logs/csv",
        className: "btn btn-success",
        style: {
          pointerEvents: !logs.length ? "none" : "auto",
          opacity: !logs.length ? 0.5 : 1
        }
      },
        React.createElement(DownloadIcon),
        "–≠–∫—Å–ø–æ—Ä—Ç CSV"
      ),
      React.createElement("button", {
        className: "btn btn-primary",
        onClick: showKnowledgeBase
      },
        React.createElement(BookIcon),
        "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"
      ),
      React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" },
          "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó",
          React.createElement("input", {
              id: "kb-upload",
              type: "file",
              accept: ".txt",
              style: { display: "none" },
              onChange: handleKbUpload
          })
      ),
      React.createElement("button", {
        className: "btn btn-danger",
        onClick: clearAllLogs,
        disabled: !logs.length
      },
        React.createElement(TrashIcon),
        "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ"
      )
    ),

    uploadStatus && React.createElement("div", {
        className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message",
        style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'}
    }, uploadStatus),

    error && React.createElement("div", { className: "error" },
      `‚ö†Ô∏è ${error}`
    ),

    loading ? React.createElement("div", { className: "loading" },
      React.createElement("div", { className: "spinner" })
    ) : React.createElement(LogTable, {
      logs: logs,
      onRowClick: setModalLog
    }),

    React.createElement(Modal, {
      log: modalLog,
      onClose: () => setModalLog(null)
    }),

    React.createElement(KnowledgeBaseModal, {
      content: kbContent,
      onClose: () => setKbContent(null)
    })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ! –Ø –æ–±–Ω–æ–≤–∏–ª `Agent.py` –∏ `logs-ui/index.js`, –∏ –ª–∏–Ω—Ç–µ—Ä –Ω–µ –≤—ã—è–≤–∏–ª –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º.

**–ò—Ç–æ–≥ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã:**

1.  **`Agent.py`** —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π "–Ω–∞ –ª–µ—Ç—É".
2.  **`main.py`** –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–∏–µ–º–∞ `.txt` —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø—É—Å–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
3.  **`logs-ui/index.js`** —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó", –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–∞.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤–∞–º:**

1.  **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `gunicorn` —Å–µ—Ä–≤–µ—Ä**, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `main.py` –∏ `Agent.py`.
    ```bash
    pkill -f gunicorn
    nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
    ```
2.  **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∫–∏** (`Ctrl+Shift+R`). –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó".

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt` –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞, –∏ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (–æ–±—ã—á–Ω–æ –¥–æ –º–∏–Ω—É—Ç—ã) –±–æ—Ç –Ω–∞—á–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

```shellscript
    pkill -f gunicorn
    nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

---

**User**

–±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

---

**Cursor**

–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –ª–æ–≥–∏, —è –≤—Å–µ –∏–∑—É—á–∏–ª.

–ü—Ä–æ–±–ª–µ–º–∞ —è—Å–Ω–∞: **—Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è**, –ø–æ—ç—Ç–æ–º—É –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ "Failed to fetch" –∏ "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞". –õ–æ–≥ `Worker failed to boot` –æ—Ç `gunicorn` –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –≤ –∫–æ–¥–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –º–µ—à–∞–µ—Ç –µ–º—É —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å.

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, `gunicorn` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É —Å–±–æ—è. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ, –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é —Å –ø–æ–º–æ—â—å—é `uvicorn`. –≠—Ç–æ –¥–∞—Å—Ç –Ω–∞–º –ø–æ–ª–Ω—ã–π traceback, –∏ —è —Å–º–æ–≥—É —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

---

**User**

d

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, —Ç–µ–ø–µ—Ä—å —É –º–µ–Ω—è –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ. –°–ø–∞—Å–∏–±–æ!

**–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:**

–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –ª–æ–≥–∞, –æ—à–∏–±–∫–∞ –ø—Ä–µ–¥–µ–ª—å–Ω–æ —è—Å–Ω–∞:

```
RuntimeError: Form data requires "python-multipart" to be installed.
You can install "python-multipart" with: pip install python-multipart
```

–ö–æ–≥–¥–∞ —è –¥–æ–±–∞–≤–∏–ª —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤, —è –∑–∞–±—ã–ª –¥–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `python-multipart`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ FastAPI –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫.

**–ß—Ç–æ —è —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞—é, —á—Ç–æ–±—ã —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**

1.  **–£—Å—Ç–∞–Ω–æ–≤–ª—é –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É** —Å –ø–æ–º–æ—â—å—é `pip`.
2.  **–î–æ–±–∞–≤–ª—é –µ–µ –≤ `requirements.txt`**, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –æ–Ω–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º.

```plaintext
RuntimeError: Form data requires "python-multipart" to be installed.
You can install "python-multipart" with: pip install python-multipart
```

---

**User**

–≤–æ—Ç

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-multipart` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.

–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã —ç—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∞—Å—å –≤ –±—É–¥—É—â–µ–º, —è –¥–æ–±–∞–≤–ª—é –µ–µ –≤ –≤–∞—à —Ñ–∞–π–ª `requirements.txt`.

---

**User**

–≥–æ—Ç–æ–≤–æ

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, —Ç–µ–ø–µ—Ä—å –≤—Å–µ –Ω–∞ –º–µ—Å—Ç–µ. –ú—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –µ–µ –≤ `requirements.txt`.

–ü—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å–±–æ–µ–º —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ—à–µ–Ω–∞. –î–∞–≤–∞–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏–º –µ–≥–æ –≤ —Ä–∞–±–æ—á–µ–º —Ä–µ–∂–∏–º–µ —Å –ø–æ–º–æ—â—å—é `gunicorn`.

**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**

---

**User**

–í–°–µ –æ—Ç–ª–∏—á–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ!
–í–æ–ø—Ä–æ—Å—ã:
1. –ö–æ–≥–¥–∞ —è –∑–∞–≥—Ä—É–∂—É –±–∞–∑—É, –≤–µ–∫—Ç–æ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–¥—É—Ç—Å—è?
2. –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–∞–∑—É txt md pdf?
3. –ó–∞–º–µ–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–≠–∫—Å–ø–æ—Ä—Ç CSV" –Ω–∞ "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"
4.  –ó–∞–º–µ–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ" –Ω–∞ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏"




---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ! –Ø –æ—á–µ–Ω—å —Ä–∞–¥, —á—Ç–æ –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ –∫–∞–∫ –Ω–∞–¥–æ.

–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –æ—Ç–≤–µ—á—É –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –∏ –≤–Ω–µ—Å—É –ø—Ä–∞–≤–∫–∏.

1.  **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤:** –î–∞, –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Ä–Ω–æ. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    *   –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞.
    *   –ó–∞–º–µ–Ω—è–µ—Ç –µ–≥–æ –Ω–æ–≤—ã–º.
    *   –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞.
    –ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É-–¥–≤–µ –±–æ—Ç —É–∂–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π.

2.  **–§–æ—Ä–º–∞—Ç –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:** –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ —Å —Ñ–∞–π–ª–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞ **`.txt`**. –ü–æ–¥–¥–µ—Ä–∂–∫—É `.md` –∏–ª–∏ `.pdf` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º, –Ω–æ —ç—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏.

3.  **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–Ω–æ–ø–æ–∫:** –ü—Ä–∏–Ω—è—Ç–æ. –°–µ–π—á–∞—Å —è –∏–∑–º–µ–Ω—é "–≠–∫—Å–ø–æ—Ä—Ç CSV" –Ω–∞ "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV" –∏ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ" –Ω–∞ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏".

–Ø –≤–Ω–µ—Å—É —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `logs-ui/index.js`.

Ok, I'll update the button labels in `logs-ui/index.js`.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

// Utility functions
const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

// Icons as SVG components
const SearchIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  className: "search-icon"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"
}));

const DownloadIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
}));

const BookIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
}));

const TrashIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
}));

const CloseIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "20",
  height: "20"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M6 18L18 6M6 6l12 12"
}));

const EmptyIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
}));

// Components
const StatsCard = ({ number, label, color = "var(--primary)" }) =>
  React.createElement("div", { className: "stat-card" },
    React.createElement("div", {
      className: "stat-number",
      style: { color }
    }, number),
    React.createElement("div", { className: "stat-label" }, label)
  );

const LogTable = ({ logs, onRowClick }) => {
  if (logs.length === 0) {
    return React.createElement("div", { className: "empty-state" },
      React.createElement(EmptyIcon),
      React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
      React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
    );
  }

  return React.createElement("div", { className: "table-container" },
    React.createElement("table", { className: "table" },
      React.createElement("thead", null,
        React.createElement("tr", null,
          ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map((header) =>
            React.createElement("th", { key: header }, header)
          )
        )
      ),
      React.createElement("tbody", null,
        logs.map((log) =>
          React.createElement("tr", {
            key: log.id,
            onClick: () => onRowClick(log)
          },
            React.createElement("td", null,
              React.createElement("code", null, log.id.slice(0, 8) + "...")
            ),
            React.createElement("td", null, log.callerId || "‚Äî"),
            React.createElement("td", null, formatDate(log.startTime)),
            React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
            React.createElement("td", null,
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        )
      )
    )
  );
};

const Modal = ({ log, onClose }) => {
  if (!log) return null;

  let transcript = [];
  try {
    transcript = JSON.parse(log.transcript_json);
  } catch (e) {
    transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
  }

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("div", { className: "info-grid" },
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "ID –∑–≤–æ–Ω–∫–∞"),
            React.createElement("div", { className: "info-value" },
              React.createElement("code", null, log.id)
            )
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"),
            React.createElement("div", { className: "info-value" }, log.callerId || "–ù–µ —É–∫–∞–∑–∞–Ω")
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"),
            React.createElement("div", { className: "info-value" }, formatDate(log.startTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è"),
            React.createElement("div", { className: "info-value" }, formatDate(log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"),
            React.createElement("div", { className: "info-value" }, formatDuration(log.startTime, log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–°—Ç–∞—Ç—É—Å"),
            React.createElement("div", { className: "info-value" },
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        ),
        React.createElement("div", { className: "transcript" },
          React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
          transcript.map((turn, index) =>
            React.createElement("div", {
              key: index,
              className: `turn ${turn.speaker}`
            }, turn.text)
          )
        )
      )
    )
  );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
  if (!content) return null;

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("pre", {
          style: {
            whiteSpace: 'pre-wrap',
            lineHeight: '1.6',
            background: 'var(--bg-primary)',
            padding: '1rem',
            borderRadius: '0.5rem',
            border: '1px solid var(--border)'
          }
        }, content.text || content.error)
      )
    )
  );
};

const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');

  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;

    return { total, completed, failed, interrupted };
  }, [logs]);

  const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);

    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());

      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };

  const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };

  const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };

  const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);

    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();

        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };

  const debouncedFetch = useCallback(
    debounce((searchQuery) => fetchLogs(searchQuery), 300),
    [dateFrom, dateTo]
  );

  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
      React.createElement("h1", null, "Admin Panel"),
      React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
        "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
      )
    ),

    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, {
            number: stats.total,
            label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤",
            color: "var(--primary)"
          }),
          React.createElement(StatsCard, {
            number: stats.completed,
            label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö",
            color: "var(--success)"
          }),
          React.createElement(StatsCard, {
            number: stats.interrupted,
            label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö",
            color: "var(--warning)"
          }),
          React.createElement(StatsCard, {
            number: stats.failed,
            label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö",
            color: "var(--danger)"
          })
    ),

    React.createElement("div", { className: "controls" },
      React.createElement("div", { className: "search-container" },
        React.createElement(SearchIcon),
        React.createElement("input", {
          type: "text",
          className: "search-input",
          placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...",
          value: query,
          onChange: (e) => setQuery(e.target.value)
        })
      ),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateFrom,
        onChange: (e) => setDateFrom(e.target.value)
      }),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateTo,
        onChange: (e) => setDateTo(e.target.value)
      }),
      React.createElement("a", {
        href: "/logs/csv",
        className: "btn btn-success",
        style: {
          pointerEvents: !logs.length ? "none" : "auto",
          opacity: !logs.length ? 0.5 : 1
        }
      },
        React.createElement(DownloadIcon),
        "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"
      ),
      React.createElement("button", {
        className: "btn btn-primary",
        onClick: showKnowledgeBase
      },
        React.createElement(BookIcon),
        "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"
      ),
      React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" },
          "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó",
          React.createElement("input", {
              id: "kb-upload",
              type: "file",
              accept: ".txt",
              style: { display: "none" },
              onChange: handleKbUpload
          })
      ),
      React.createElement("button", {
        className: "btn btn-danger",
        onClick: clearAllLogs,
        disabled: !logs.length
      },
        React.createElement(TrashIcon),
        "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ"
      )
    ),

    uploadStatus && React.createElement("div", {
        className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message",
        style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'}
    }, uploadStatus),

    error && React.createElement("div", { className: "error" },
      `‚ö†Ô∏è ${error}`
    ),

    loading ? React.createElement("div", { className: "loading" },
      React.createElement("div", { className: "spinner" })
    ) : React.createElement(LogTable, {
      logs: logs,
      onRowClick: setModalLog
    }),

    React.createElement(Modal, {
      log: modalLog,
      onClose: () => setModalLog(null)
    }),

    React.createElement(KnowledgeBaseModal, {
      content: kbContent,
      onClose: () => setKbContent(null)
    })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

// Utility functions
const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

// Icons as SVG components
const SearchIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  className: "search-icon"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"
}));

const DownloadIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
}));

const BookIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
}));

const TrashIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "16",
  height: "16"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
}));

const CloseIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24",
  width: "20",
  height: "20"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M6 18L18 6M6 6l12 12"
}));

const EmptyIcon = () => React.createElement("svg", {
  fill: "none",
  stroke: "currentColor",
  viewBox: "0 0 24 24"
}, React.createElement("path", {
  strokeLinecap: "round",
  strokeLinejoin: "round",
  strokeWidth: 2,
  d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
}));

// Components
const StatsCard = ({ number, label, color = "var(--primary)" }) =>
  React.createElement("div", { className: "stat-card" },
    React.createElement("div", {
      className: "stat-number",
      style: { color }
    }, number),
    React.createElement("div", { className: "stat-label" }, label)
  );

const LogTable = ({ logs, onRowClick }) => {
  if (logs.length === 0) {
    return React.createElement("div", { className: "empty-state" },
      React.createElement(EmptyIcon),
      React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
      React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
    );
  }

  return React.createElement("div", { className: "table-container" },
    React.createElement("table", { className: "table" },
      React.createElement("thead", null,
        React.createElement("tr", null,
          ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map((header) =>
            React.createElement("th", { key: header }, header)
          )
        )
      ),
      React.createElement("tbody", null,
        logs.map((log) =>
          React.createElement("tr", {
            key: log.id,
            onClick: () => onRowClick(log)
          },
            React.createElement("td", null,
              React.createElement("code", null, log.id.slice(0, 8) + "...")
            ),
            React.createElement("td", null, log.callerId || "‚Äî"),
            React.createElement("td", null, formatDate(log.startTime)),
            React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
            React.createElement("td", null,
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        )
      )
    )
  );
};

const Modal = ({ log, onClose }) => {
  if (!log) return null;

  let transcript = [];
  try {
    transcript = JSON.parse(log.transcript_json);
  } catch (e) {
    transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
  }

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("div", { className: "info-grid" },
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "ID –∑–≤–æ–Ω–∫–∞"),
            React.createElement("div", { className: "info-value" },
              React.createElement("code", null, log.id)
            )
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"),
            React.createElement("div", { className: "info-value" }, log.callerId || "–ù–µ —É–∫–∞–∑–∞–Ω")
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"),
            React.createElement("div", { className: "info-value" }, formatDate(log.startTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è"),
            React.createElement("div", { className: "info-value" }, formatDate(log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"),
            React.createElement("div", { className: "info-value" }, formatDuration(log.startTime, log.endTime))
          ),
          React.createElement("div", { className: "info-item" },
            React.createElement("div", { className: "info-label" }, "–°—Ç–∞—Ç—É—Å"),
            React.createElement("div", { className: "info-value" },
              React.createElement("span", {
                className: `status ${log.status}`
              }, log.status)
            )
          )
        ),
        React.createElement("div", { className: "transcript" },
          React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
          transcript.map((turn, index) =>
            React.createElement("div", {
              key: index,
              className: `turn ${turn.speaker}`
            }, turn.text)
          )
        )
      )
    )
  );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
  if (!content) return null;

  return React.createElement("div", {
    className: "modal show",
    onClick: onClose
  },
    React.createElement("div", {
      className: "modal-content",
      onClick: (e) => e.stopPropagation()
    },
      React.createElement("div", { className: "modal-header" },
        React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("button", {
          className: "close-btn",
          onClick: onClose
        }, React.createElement(CloseIcon))
      ),
      React.createElement("div", { className: "modal-body" },
        React.createElement("pre", {
          style: {
            whiteSpace: 'pre-wrap',
            lineHeight: '1.6',
            background: 'var(--bg-primary)',
            padding: '1rem',
            borderRadius: '0.5rem',
            border: '1px solid var(--border)'
          }
        }, content.text || content.error)
      )
    )
  );
};

const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');

  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;

    return { total, completed, failed, interrupted };
  }, [logs]);

  const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);

    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());

      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };

  const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };

  const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };

  const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);

    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();

        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };

  const debouncedFetch = useCallback(
    debounce((searchQuery) => fetchLogs(searchQuery), 300),
    [dateFrom, dateTo]
  );

  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
      React.createElement("h1", null, "Admin Panel"),
      React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
        "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
      )
    ),

    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, {
            number: stats.total,
            label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤",
            color: "var(--primary)"
          }),
          React.createElement(StatsCard, {
            number: stats.completed,
            label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö",
            color: "var(--success)"
          }),
          React.createElement(StatsCard, {
            number: stats.interrupted,
            label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö",
            color: "var(--warning)"
          }),
          React.createElement(StatsCard, {
            number: stats.failed,
            label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö",
            color: "var(--danger)"
          })
    ),

    React.createElement("div", { className: "controls" },
      React.createElement("div", { className: "search-container" },
        React.createElement(SearchIcon),
        React.createElement("input", {
          type: "text",
          className: "search-input",
          placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...",
          value: query,
          onChange: (e) => setQuery(e.target.value)
        })
      ),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateFrom,
        onChange: (e) => setDateFrom(e.target.value)
      }),
      React.createElement("input", {
        type: "date",
        className: "search-input",
        value: dateTo,
        onChange: (e) => setDateTo(e.target.value)
      }),
      React.createElement("a", {
        href: "/logs/csv",
        className: "btn btn-success",
        style: {
          pointerEvents: !logs.length ? "none" : "auto",
          opacity: !logs.length ? 0.5 : 1
        }
      },
        React.createElement(DownloadIcon),
        "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"
      ),
      React.createElement("button", {
        className: "btn btn-primary",
        onClick: showKnowledgeBase
      },
        React.createElement(BookIcon),
        "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"
      ),
      React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" },
          "–û–±–Ω–æ–≤–∏—Ç—å –ë–ó",
          React.createElement("input", {
              id: "kb-upload",
              type: "file",
              accept: ".txt",
              style: { display: "none" },
              onChange: handleKbUpload
          })
      ),
      React.createElement("button", {
        className: "btn btn-danger",
        onClick: clearAllLogs,
        disabled: !logs.length
      },
        React.createElement(TrashIcon),
        "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏"
      )
    ),

    uploadStatus && React.createElement("div", {
        className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message",
        style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'}
    }, uploadStatus),

    error && React.createElement("div", { className: "error" },
      `‚ö†Ô∏è ${error}`
    ),

    loading ? React.createElement("div", { className: "loading" },
      React.createElement("div", { className: "spinner" })
    ) : React.createElement(LogTable, {
      logs: logs,
      onRowClick: setModalLog
    }),

    React.createElement(Modal, {
      log: modalLog,
      onClose: () => setModalLog(null)
    }),

    React.createElement(KnowledgeBaseModal, {
      content: kbContent,
      onClose: () => setKbContent(null)
    })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ! –Ø –∏–∑–º–µ–Ω–∏–ª –Ω–∞–∑–≤–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫.

–ü–æ—Å–∫–æ–ª—å–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Å–Ω—É–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ñ–∞–π–ª–∞, **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–Ω–æ**.

–ü—Ä–æ—Å—Ç–æ **–æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (`Ctrl+Shift+R`), –∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ –Ω–æ–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö.

---

**User**

–≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!!! 
–†–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ —Ç–µ–ø–µ—Ä—å –æ –ª–æ–≥–∏–∫–µ –∞–≥–µ–Ω—Ç–∞! –≤–æ–ø—Ä–æ—Å—ã:
1. –ö–∞–∫ –≤—Å–µ –≤ –Ω–µ–º —É—Å—Ç—Ä–æ–µ–Ω–æ? –û—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑—ä—è—Å–Ω–∏
2. –Ω–∞ —Å–∫–æ–ª—å–∫–æ —è –ø–æ–Ω—è–ª –ê–≥–µ–Ω—Ç —É–º–µ–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π? –ó–Ω–∞—á–∏—Ç –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ñ—Ä–æ–Ω—Ç—ç–Ω–¥—É?
3. –ò–¥–µ—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞: –°–º–æ–∂–µ–º –ª–∏ –º—ã –≤ –∞–¥–º–∏–Ω–∫—É –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º—Ç–∞–º–∏,  —Å–ª–æ–≤–∞ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å–≤–∏—è?

---

**Cursor**

–ö–æ–Ω–µ—á–Ω–æ! –Ø –æ—á–µ–Ω—å —Ä–∞–¥, —á—Ç–æ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ –≤—Å–µ —É—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º. –î–∞–≤–∞–π—Ç–µ —è –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–∫–∞–∂—É –æ –ª–æ–≥–∏–∫–µ –∞–≥–µ–Ω—Ç–∞.

### 1. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω `Agent.py`? (–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä)

–í–∞—à `Agent.py` ‚Äî —ç—Ç–æ –º–æ–∑–≥ –≤—Å–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. –û–Ω –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–æ–∂–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç –±—ã–ª —Ç–æ—á–Ω—ã–º, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –∏ —É—á–∏—Ç—ã–≤–∞–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Retrieval-Augmented Generation (RAG)**.

–í–æ—Ç –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:

**–®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**

–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `main.py`, –æ–Ω —Å–æ–∑–¥–∞–µ—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `Agent`. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (`__init__`) –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –¥–≤–µ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏:
1.  **`self.llm = ChatOpenAI(...)`**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è "–¥–≤–∏–∂–æ–∫" ‚Äî –±–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å (–≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ, `gpt-4o-mini`). –≠—Ç–æ —Ç–æ—Ç —Å–∞–º—ã–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. `streaming=True` ‚Äî –∫–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–µ —Ü–µ–ª–∏–∫–æ–º, –∞ –ø–æ —Å–ª–æ–≤–∞–º, —Å–æ–∑–¥–∞–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç "–ø–µ—á–∞—Ç–∞–Ω–∏—è".
2.  **`self._initialize_rag_chain()`**: –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç –≤—Å—é –ª–æ–≥–∏—á–µ—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

**–®–∞–≥ 2: `_initialize_rag_chain` ‚Äî —Å–±–æ—Ä–∫–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–∞**

–≠—Ç–æ —Å–µ—Ä–¥—Ü–µ –∞–≥–µ–Ω—Ç–∞. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∫–∞–∫ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –Ω–∞ –∑–∞–≤–æ–¥–µ, –≥–¥–µ –∫–∞–∂–¥—ã–π —É–∑–µ–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∑–∞–¥–∞—á—É.

*   **–£–∑–µ–ª –ê: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ "–¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏" (–ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π)**
    *   **`embeddings = OpenAIEmbeddings(...)`**: –≠—Ç–æ –Ω–∞—à "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫". –û–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ —Ç–µ–∫—Å—Ç –∏–∑ –≤–∞—à–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –≤ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã. –°—Ö–æ–∂–∏–µ –ø–æ —Å–º—ã—Å–ª—É —Ñ—Ä–∞–∑—ã –±—É–¥—É—Ç –∏–º–µ—Ç—å –±–ª–∏–∑–∫–∏–µ –≤–µ–∫—Ç–æ—Ä—ã.
    *   **`self.db = Chroma(...)`**: –≠—Ç–æ –∏ –µ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–∞—à–µ–π –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (`chroma_db_metrotech`). –û–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç –≤–µ–∫—Ç–æ—Ä—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ `–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt`.
    *   **`self.retriever = self.db.as_retriever(...)`**: –≠—Ç–æ "–ø–æ–∏—Å–∫–æ–≤–∏–∫" –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å, —Ä–µ—Ç—Ä–∏–≤–µ—Ä –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç –≤ –±–∞–∑–µ ChromaDB –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ.

*   **–£–∑–µ–ª –ë: –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ (History-Aware Retriever)**
    *   **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –≤—ã —Å–Ω–∞—á–∞–ª–∞ —Å–ø—Ä–æ—Å–∏—Ç–µ "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –ø–æ–≤–µ—Ä–∫—É —Å—á—ë—Ç—á–∏–∫–æ–≤", –∞ –ø–æ—Ç–æ–º "–ê —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ —Å—Ç–æ–∏—Ç?", –º–æ–¥–µ–ª—å –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ –ø–æ–π–º–µ—Ç, –æ —á–µ–º —Ä–µ—á—å.
    *   **–†–µ—à–µ–Ω–∏–µ:** –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–ø–æ—á–∫—É `create_history_aware_retriever`. –û–Ω–∞ –±–µ—Ä–µ—Ç **–∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞** –∏ **–Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å** ("–ê —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ —Å—Ç–æ–∏—Ç?") –∏, —Å–ª–µ–¥—É—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞ `contextualize_q_system_prompt`, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π, **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å**. –ù–∞–ø—Ä–∏–º–µ—Ä: *"–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤?"*.
    *   –≠—Ç–æ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å –¥–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.

*   **–£–∑–µ–ª –í: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (Question-Answer Chain)**
    *   –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:
        1.  –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å (–∏–∑ —É–∑–ª–∞ –ë).
        2.  –°–∞–º—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–æ–º –≤ —É–∑–ª–µ –ê).
    *   –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫—É `create_stuff_documents_chain`. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (`qa_system_prompt`), –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–ª–∏—á–Ω–æ—Å—Ç—å" –∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–æ—Ç–∞ ("–¢—ã ‚Äî —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –Ω–µ–π—Ä–æ-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç...").
    *   –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç.

*   **–£–∑–µ–ª –ì: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç—å—é" (–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞)**
    *   `RunnableWithMessageHistory` ‚Äî —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ (–ø–æ `session_id`). `self.store` ‚Äî —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å, –≥–¥–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –Ω–µ –ø–µ—Ä–µ–ø—É—Ç–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º.

–í–µ—Å—å —ç—Ç–æ—Ç —Å–ª–æ–∂–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫:

```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant main.py as WebSocket-—Å–µ—Ä–≤–µ—Ä
    participant Agent.py as AI-–ê–≥–µ–Ω—Ç
    participant ChromaDB as –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–ó

    User->>main.py: –ì–æ–≤–æ—Ä–∏—Ç —Ñ—Ä–∞–∑—É
    main.py->>Agent.py: get_response_generator(—Ñ—Ä–∞–∑–∞, session_id)

    subgraph Agent.py: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞
        Agent.py->>Agent.py: 1. –£—á–∏—Ç—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é, <br> –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å
        Agent.py->>ChromaDB: 2. –ò—â–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é <br> –ø–æ –Ω–æ–≤–æ–º—É –≤–æ–ø—Ä–æ—Å—É
        ChromaDB-->>Agent.py: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ <br> —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞
        Agent.py->>Agent.py: 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, <br> –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ–º–ø—Ç
    end

    Agent.py-->>main.py: –û—Ç–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç (–ø–æ—Ç–æ–∫–æ–º, –ø–æ —á–∞—Å—Ç—è–º)
    main.py-->>User: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç
```

---

### 2. –ê–≥–µ–Ω—Ç –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É?

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω–æ—Å–∏—Ç —è—Å–Ω–æ—Å—Ç—å! **–ù–µ—Ç, –∞–≥–µ–Ω—Ç –Ω–∞ 100% —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –±—ç–∫–µ–Ω–¥–∞.**

*   **–ë—ç–∫–µ–Ω–¥ (—Å–µ—Ä–≤–µ—Ä):** `main.py`, `Agent.py`, `create_embeddings.py`, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ChromaDB ‚Äî –≤—Å–µ —ç—Ç–æ –∂–∏–≤–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ.
*   **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (–∫–ª–∏–µ–Ω—Ç):** –≠—Ç–æ —Ç–æ, —á—Ç–æ –≤—ã –≤–∏–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –≤–∞—à–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`logs-ui/index.html` –∏ `.js`).

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω.
*   **–§—Ä–æ–Ω—Ç–µ–Ω–¥** ‚Äî —ç—Ç–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –≤ –∑–∞–ª–µ (–∞–¥–º–∏–Ω–∫–∞). –û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —É –≤–∞—Å –∑–∞–∫–∞–∑ (–≤—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π").
*   **–ë—ç–∫–µ–Ω–¥** ‚Äî —ç—Ç–æ –∫—É—Ö–Ω—è (`main.py`). –û—Ñ–∏—Ü–∏–∞–Ω—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –Ω–∞ –∫—É—Ö–Ω—é.
*   **–ê–≥–µ–Ω—Ç** ‚Äî —ç—Ç–æ —à–µ—Ñ-–ø–æ–≤–∞—Ä –Ω–∞ –∫—É—Ö–Ω–µ (`Agent.py`). `main.py` –≥–æ–≤–æ—Ä–∏—Ç —à–µ—Ñ—É: "–£ –Ω–∞—Å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç (—Ñ–∞–π–ª –ë–ó), –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—É—á–∏—Ç—å—Å—è (`reload`)".

–®–µ—Ñ-–ø–æ–≤–∞—Ä –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –≤ –∑–∞–ª. –¢–∞–∫ –∂–µ –∏ `Agent.py` –Ω–∏–∫–æ–≥–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –Ω–µ –æ–±—â–∞–µ—Ç—Å—è —Å –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º. –û–Ω –ª–∏—à—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç `main.py`, –∫–æ—Ç–æ—Ä—ã–π, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

---

### 3. –ò–¥–µ—è: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏–∑ –∞–¥–º–∏–Ω–∫–∏

–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–¥–µ—è, —ç—Ç–æ **–≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª–æ–≥–∏—á–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥!** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–º–æ–∑–≥–∞–º–∏" –±–æ—Ç–∞ ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ. –ò –¥–∞, –º—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ç–æ—á–Ω–æ –º–æ–∂–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å.

**–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ —Ç–æ—Ç, —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏ –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**

1.  **–í—ã–Ω–æ—Å–∏–º –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –∫–æ–¥–∞.** –°–æ–∑–¥–∞–¥–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, `prompts.json`. –í –Ω–µ–≥–æ –º—ã –ø–æ–ª–æ–∂–∏–º —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å "–∑–∞—à–∏—Ç—ã" –≤ –∫–æ–¥–µ.

2.  **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –±—ç–∫–µ–Ω–¥:**
    *   **`Agent.py`**: –ù–∞—É—á–∏–º –µ–≥–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —á–∏—Ç–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–µ –∏–∑ –∫–æ–¥–∞, –∞ –∏–∑ —ç—Ç–æ–≥–æ `prompts.json` —Ñ–∞–π–ª–∞.
    *   **`main.py`**: –î–æ–±–∞–≤–∏–º –¥–≤–∞ –Ω–æ–≤—ã—Ö API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:
        *   `GET /api/prompts` ‚Äî –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `prompts.json`.
        *   `POST /api/prompts` ‚Äî –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤ `prompts.json` –∏ –≤—ã–∑—ã–≤–∞—Ç—å `agent.reload()`, —á—Ç–æ–±—ã –±–æ—Ç —Å—Ä–∞–∑—É –Ω–∞—á–∞–ª –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

3.  **–î–æ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (`logs-ui/index.js`):**
    *   –î–æ–±–∞–≤–∏–º –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏".
    *   –ü–æ –∫–ª–∏–∫—É –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏ —Ç.–¥.).
    *   –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞ —Å –ø–æ–º–æ—â—å—é –∑–∞–ø—Ä–æ—Å–∞ –∫ `GET /api/prompts` –º—ã –±—É–¥–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ç–µ–∫—Å—Ç—ã.
    *   –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –º—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ `POST /api/prompts`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã —Å–º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ª–∏—á–Ω–æ—Å—Ç—å –±–æ—Ç–∞ –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–µ–∑—Ç—å –≤ –∫–æ–¥. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –µ—â–µ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –∏ —É–¥–æ–±–Ω–æ–π.

```plaintext
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant main.py as WebSocket-—Å–µ—Ä–≤–µ—Ä
    participant Agent.py as AI-–ê–≥–µ–Ω—Ç
    participant ChromaDB as –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–ó

    User->>main.py: –ì–æ–≤–æ—Ä–∏—Ç —Ñ—Ä–∞–∑—É
    main.py->>Agent.py: get_response_generator(—Ñ—Ä–∞–∑–∞, session_id)

    subgraph Agent.py: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞
        Agent.py->>Agent.py: 1. –£—á–∏—Ç—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é, <br> –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å
        Agent.py->>ChromaDB: 2. –ò—â–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é <br> –ø–æ –Ω–æ–≤–æ–º—É –≤–æ–ø—Ä–æ—Å—É
        ChromaDB-->>Agent.py: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ <br> —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞
        Agent.py->>Agent.py: 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, <br> –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ–º–ø—Ç
    end

    Agent.py-->>main.py: –û—Ç–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç (–ø–æ—Ç–æ–∫–æ–º, –ø–æ —á–∞—Å—Ç—è–º)
    main.py-->>User: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç
```

---

**User**

–û–¢–ª–∏—á–Ω–æ! –î–∞–≤–∞–π –ø—Ä–µ–∂–µ —á–µ–º –Ω–∞—á–Ω–µ–º —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –±–µ–∫–∞–ø –ø–∞–ø–∫—É –∞ —Ç–∞–∫ –∂–µ –∑–∞–ø—É—à–∏–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ –≥–∏–¥—Ö–∞–±

---

**Cursor**

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–µ–π –≤–µ—Ä—Å–∏–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

–î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –≤—Å–µ –ø–æ –ø–æ—Ä—è–¥–∫—É.

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞

–Ø —Å–æ–∑–¥–∞–º –Ω–æ–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º.

---

**User**

–≤–æ—Ç

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, –±—ç–∫–∞–ø `backup_2025-08-04_07-46-15` —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!

### –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ GitHub

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏–º –∫–æ–¥ –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

–°–Ω–∞—á–∞–ª–∞ —è –ø—Ä–æ–≤–µ—Ä—é —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å git, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –∫–æ–º–º–∏—Ç—É.

---

**User**

–ø–æ–¥–æ–∂–¥–∏! –û—Ç—Ä–∞–∑–∏ –≤ —Ñ–∞–π–ª–µ —Ä—ç–¥–º–∏ –Ω–∞—à–∏ –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –∏ —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ –∑–∞–≥—Ä—É–∑–Ω–∏ –±–∞–∑—ã –∏ —Ç –¥

---

**Cursor**

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –í–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ. –Ø —Å–µ–π—á–∞—Å –æ–±–Ω–æ–≤–ª—é `README.md`, —á—Ç–æ–±—ã –æ—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ, —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏, –∏ –Ω–∞—à–∏ –ø–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ.

–°–Ω–∞—á–∞–ª–∞ —è –ø—Ä–æ—á—Ç—É —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∏–ª—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª `README.md`. –¢–µ–ø–µ—Ä—å —è –¥–æ–±–∞–≤–ª—é –≤ –Ω–µ–≥–æ –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ –æ–±–Ω–æ–≤–ª—é —Ä–∞–∑–¥–µ–ª —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏, —á—Ç–æ–±—ã –æ—Ç—Ä–∞–∑–∏—Ç—å –Ω–∞—à —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω.

```markdown
# üìû –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç"

> üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞ 2025-08-04

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–≤–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É **Voximplant**
- –ü–æ–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ—Å –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é ASR
- –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ **AI-–∞–≥–µ–Ω—Ç–∞ —Å LangChain** (–Ω–∞ Python)
- –û—Ç–≤–µ—á–∞–µ—Ç –≤—Å–ª—É—Ö, –∏—Å–ø–æ–ª—å–∑—É—è TTS
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç barge-in ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –±–æ—Ç–∞ –ø—Ä–∏ —Ä–µ—á–∏ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üñ•Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π, –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–æ –∞–¥—Ä–µ—Å—É `/logs-ui/`.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∑–≤–æ–Ω–∫–æ–≤:** –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –æ–±—â–µ–Ω–∏—è —Å –±–æ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã.
- **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞:** –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ª—é–±–æ–π –∑–≤–æ–Ω–æ–∫ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –¥–∏–∞–ª–æ–≥–∞.
- **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ª–æ–≥–∞–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ.
- **–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV:** –í—Å–µ –ª–æ–≥–∏ –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –≤ `CSV` —Ñ–∞–π–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π:**
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ `.txt` —Ñ–∞–π–ª–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.
  - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ `.txt` —Ñ–∞–π–ª–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –±–æ—Ç–∞.
- **–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–≤–æ–Ω–∫–æ–≤.

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
|----------------|--------------------------------------------------|
| `scenario_barge-in_2.js` | Voximplant-—Å—Ü–µ–Ω–∞—Ä–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–∞ –∏ —Ä–µ—á–∏ |
| `main.py`      | FastAPI-—Å–µ—Ä–≤–µ—Ä: WebSocket, API –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å    |
| `Agent.py`     | LangChain-–∞–≥–µ–Ω—Ç: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏ –æ—Ç–≤–µ—Ç—ã      |
| `create_embeddings.py` | –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –≤–µ–∫—Ç–æ—Ä–æ–≤ |
| `logs-ui/`     | –§–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (HTML, CSS, JS)  |


---

## üîÅ –°—Ü–µ–Ω–∞—Ä–∏–π –∑–≤–æ–Ω–∫–∞

1. **–ö–ª–∏–µ–Ω—Ç –∑–≤–æ–Ω–∏—Ç** ‚Üí –∑–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è `scenario_barge-in_2.js`
2. –°—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å `main.py`, –ø–µ—Ä–µ–¥–∞–≤–∞—è `callerId`.
3. `main.py` —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –∑–≤–æ–Ω–∫–∞ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –≤ `Agent.py`
4. –ê–≥–µ–Ω—Ç:
   - –ò—â–µ—Ç –æ—Ç–≤–µ—Ç –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (`chroma_db_metrotech`)
   - –°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –∏ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `gpt-4o-mini`
5. –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ —á–∞—Å—Ç—è–º (stream) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ WebSocket.
6. `scenario.js` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É (TTS).
7. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞, `main.py` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π –ª–æ–≥ –≤ `SQLite` –±–∞–∑—É.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
.
‚îú‚îÄ‚îÄ scenario_barge-in_2.js       # –°–∫—Ä–∏–ø—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ Voximplant
‚îú‚îÄ‚îÄ main.py                      # FastAPI-—Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ Agent.py                     # LangChain –∞–≥–µ–Ω—Ç
‚îú‚îÄ‚îÄ create_embeddings.py         # –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ log_storage.py               # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ –ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt           # –¢–µ–∫—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                         # –°–µ–∫—Ä–µ—Ç—ã (–∫–ª—é—á OpenAI, –∏ —Ç.–ø.)
‚îú‚îÄ‚îÄ logs-ui/                     # –§–∞–π–ª—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îî‚îÄ‚îÄ chroma_db_metrotech/         # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)
python create_embeddings.py

# –ó–∞–ø—É—Å–∫ WebSocket-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:
```bash
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

---

## üí° –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏:** –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–æ—Ç–∞.
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã).
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ë–ó:** –ù–∞—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å `.pdf` –∏ `.md` —Ñ–∞–π–ª–∞–º–∏.
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ CRM:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

---

```

–ì–æ—Ç–æ–≤–æ, —è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–ª `README.md`, —á—Ç–æ–±—ã –æ–Ω –æ—Ç—Ä–∞–∂–∞–ª —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ GitHub.

–Ø –¥–æ–±–∞–≤–ª—é –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–≤–∫–ª—é—á–∞—è `README.md`) –≤ Git, —Å–¥–µ–ª–∞—é –∫–æ–º–º–∏—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—é –µ–≥–æ –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

---

**User**

–≤–æ—Ç

---

**Cursor**

–û—Ö, –ø–æ—Ö–æ–∂–µ, –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å —Å–∏—Å—Ç–µ–º–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ GitHub. –≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π –∑–Ω–∞–∫ ‚Äî –æ–Ω–∞ –∑–∞—â–∏—â–∞–µ—Ç –≤–∞—Å –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö —É—Ç–µ—á–µ–∫!

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –ª–æ–≥–∞, **GitHub –æ—Ç–∫–ª–æ–Ω–∏–ª –≤–∞—à—É –æ—Ç–ø—Ä–∞–≤–∫—É (`push`)**:

```
remote: error: GH013: Repository rule violations found for refs/heads/main.
...
remote: - Push cannot contain secrets
```

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** GitHub –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–ª –≤–∞—à–∏ —Ñ–∞–π–ª—ã –∏ –Ω–∞—à–µ–ª –≤ —Ñ–∞–π–ª–µ `cursor_langchain_vox_bot.md` —Ç–æ, —á—Ç–æ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (GitHub Personal Access Token). –≠—Ç–æ –Ω–∞—à —Å –≤–∞–º–∏ –ª–æ–≥ —á–∞—Ç–∞, –∏, –≤–∏–¥–∏–º–æ, –≥–¥–µ-—Ç–æ –≤ –Ω–µ–º —è –ø—Ä–∏–≤–æ–¥–∏–ª –ø—Ä–∏–º–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ GitHub —Å—á–µ–ª –∑–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π –∫–ª—é—á.

–≠—Ç–æ –∑–∞—â–∏—Ç–Ω–∞—è –º–µ—Ä–∞, —á—Ç–æ–±—ã –≤—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏ —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ.

### –ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?

–°–∞–º—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî **–∏—Å–∫–ª—é—á–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**. –û–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–¥–∞ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥ –Ω–∞—à–µ–≥–æ –æ–±—â–µ–Ω–∏—è, –∏ –µ–º—É –Ω–µ –º–µ—Å—Ç–æ –Ω–∞ GitHub.

–Ø —Å–¥–µ–ª–∞—é —ç—Ç–æ –≤ —Ç—Ä–∏ —à–∞–≥–∞:

1.  **–î–æ–±–∞–≤–ª—é `cursor_langchain_vox_bot.md` –≤ `.gitignore`**, —á—Ç–æ–±—ã Git –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—ã—Ç–∞–ª—Å—è –µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å.
2.  **–£–¥–∞–ª—é —Ñ–∞–π–ª –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ Git**, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø–æ–ø–∞–ª –≤ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–º–º–∏—Ç.
3.  **–í–Ω–µ—Å—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç**, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∏–∑ –Ω–µ–≥–æ —ç—Ç–æ—Ç —Ñ–∞–π–ª.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º—ã —Å–º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥.

–î–∞–≤–∞–π—Ç–µ —è –≤—ã–ø–æ–ª–Ω—é —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã.

```plaintext
remote: error: GH013: Repository rule violations found for refs/heads/main.
...
remote: - Push cannot contain secrets
```

---

**User**

–≤

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, –º—ã —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç, —É–¥–∞–ª–∏–≤ –∏–∑ –Ω–µ–≥–æ —Ñ–∞–π–ª —Å –ª–æ–≥–æ–º.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub. –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –≤—Å–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –≥–ª–∞–¥–∫–æ.

---

**User**

–≤

---

**Cursor**

–°—É–ø–µ—Ä! –¢–µ–ø–µ—Ä—å –≤—Å–µ –Ω–∞—à–∏ –Ω–∞—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–¥–µ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –Ω–∞ GitHub, –∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –±—ç–∫–∞–ø–µ. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!

–ú—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–µ: **—É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏**.

–Ø –Ω–∞—á–Ω—É —Å –ø–µ—Ä–≤–æ–≥–æ –∏ —Å–∞–º–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ —à–∞–≥–∞: **—Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `prompts.json`**. –Ø –ø–µ—Ä–µ–Ω–µ—Å—É –≤ –Ω–µ–≥–æ –≤—Å–µ —Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å "–∑–∞—à–∏—Ç—ã" –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ `Agent.py` –∏ —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏–∑ `main.py`.

–≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –Ω–∞—Å –∫ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–∞–º.

–Ø –Ω–∞—á–Ω—É —Å —á—Ç–µ–Ω–∏—è `Agent.py` –∏ `main.py`, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –Ω–∏—Ö —Ç–µ–∫—Å—Ç—ã –ø—Ä–æ–º–ø—Ç–æ–≤.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª –æ–±–∞ —Ñ–∞–π–ª–∞. –¢–µ–ø–µ—Ä—å —è —Å–æ–∑–¥–∞–º `prompts.json` –∏ –ø–µ—Ä–µ–Ω–µ—Å—É —Ç—É–¥–∞ –≤—Å–µ —Ç–µ–∫—Å—Ç—ã.

```json
{
  "greeting": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –í—ã –ø–æ–∑–≤–æ–Ω–∏–ª–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é ¬´–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç¬ª. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?",
  "contextualize_q_system_prompt": "–£—á–∏—Ç—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞, —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞. –ù–ï –æ—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –µ–≥–æ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤–µ—Ä–Ω–∏ –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å.",
  "qa_system_prompt": "–¢—ã ‚Äî —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –Ω–µ–π—Ä–æ-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç \"–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç\".\n- –û—Ç–≤–µ—á–∞–π –≤–µ–∂–ª–∏–≤–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –ø–æ –¥–µ–ª—É, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.\n- –§–æ—Ä–º–∏—Ä—É–π –æ—Ç–≤–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é. –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å—Ç–∞–≤—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å \"|\".\n- –ï—Å–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å.\n- –ï—Å–ª–∏ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞, —Å–æ–æ–±—â–∏ –æ–± —ç—Ç–æ–º.\n- –ò—Å–ø–æ–ª—å–∑—É–π –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.\n\n---\n**–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**\n{context}\n---"
}

```

–û—Ç–ª–∏—á–Ω–æ, —Ñ–∞–π–ª `prompts.json` —Å–æ–∑–¥–∞–Ω.

–¢–µ–ø–µ—Ä—å —è –∏–∑–º–µ–Ω—é `Agent.py` –∏ `main.py`, —á—Ç–æ–±—ã –æ–Ω–∏ —á–∏—Ç–∞–ª–∏ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞, –∞ –Ω–µ —Ö—Ä–∞–Ω–∏–ª–∏ –∏—Ö –≤ –∫–æ–¥–µ.

–°–Ω–∞—á–∞–ª–∞ `Agent.py`.

```python
from langchain_openai import ChatOpenAI, OpenAIEmbeddings
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain.chains import create_retrieval_chain
from langchain.chains.combine_documents import create_stuff_documents_chain
from langchain.chains import create_history_aware_retriever
from langchain_community.vectorstores import Chroma
from dotenv import load_dotenv
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.runnables.history import RunnableWithMessageHistory
import logging
import json

load_dotenv()

PERSIST_DIRECTORY = "chroma_db_metrotech"
PROMPTS_FILE = "prompts.json"
logger = logging.getLogger(__name__)

class Agent:
    def __init__(self) -> None:
        logger.info("--- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ê–≥–µ–Ω—Ç–∞ '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' ---")
        self.llm = ChatOpenAI(model_name="gpt-4o-mini", temperature=0.2, streaming=True)
        self.store = {}
        self.prompts = self.load_prompts()
        self._initialize_rag_chain()
        logger.info("--- –ê–≥–µ–Ω—Ç '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ---")

    def load_prompts(self):
        try:
            with open(PROMPTS_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        except (FileNotFoundError, json.JSONDecodeError) as e:
            logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏–∑ {PROMPTS_FILE}: {e}")
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            return {
                "contextualize_q_system_prompt": "...",
                "qa_system_prompt": "..."
            }

    def _initialize_rag_chain(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã RAG."""
        logger.info("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ RAG-—Ü–µ–ø–æ—á–∫–∏...")
        
        logger.info(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –≤ '{PERSIST_DIRECTORY}'...")
        embeddings = OpenAIEmbeddings(chunk_size=1000)
        self.db = Chroma(persist_directory=PERSIST_DIRECTORY, embedding_function=embeddings)
        self.retriever = self.db.as_retriever(search_type="mmr", search_kwargs={"k": 5})
        logger.info("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ.")
        
        contextualize_q_prompt = ChatPromptTemplate.from_messages(
            [("system", self.prompts["contextualize_q_system_prompt"]), MessagesPlaceholder("chat_history"), ("human", "{input}")]
        )
        history_aware_retriever = create_history_aware_retriever(self.llm, self.retriever, contextualize_q_prompt)

        qa_prompt = ChatPromptTemplate.from_messages(
            [("system", self.prompts["qa_system_prompt"]), MessagesPlaceholder("chat_history"), ("human", "{input}")]
        )
        question_answer_chain = create_stuff_documents_chain(self.llm, qa_prompt)
        
        rag_chain = create_retrieval_chain(history_aware_retriever, question_answer_chain)
        
        self.conversational_rag_chain = RunnableWithMessageHistory(
            rag_chain,
            self.get_session_history,
            input_messages_key="input",
            history_messages_key="chat_history",
            output_messages_key="answer",
        )
        logger.info("--- RAG-—Ü–µ–ø–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∞ ---")

    def reload(self):
        """–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã, –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ RAG-—Ü–µ–ø–æ—á–∫—É."""
        logger.info("üîÉ –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –∞–≥–µ–Ω—Ç–∞...")
        try:
            self.prompts = self.load_prompts()
            self._initialize_rag_chain()
            logger.info("‚úÖ –ê–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω —Å –Ω–æ–≤–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏.")
            return True
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –∞–≥–µ–Ω—Ç–∞: {e}", exc_info=True)
            return False

    def get_session_history(self, session_id: str):
        if session_id not in self.store:
            self.store[session_id] = ChatMessageHistory()
        return self.store[session_id]

    def get_response_generator(self, user_question: str, session_id: str):
        stream = self.conversational_rag_chain.stream(
            {"input": user_question},
            config={"configurable": {"session_id": session_id}},
        )
        for chunk in stream:
            if 'answer' in chunk:
                yield chunk['answer']

```

–§–∞–π–ª `Agent.py` –æ–±–Ω–æ–≤–ª–µ–Ω. –¢–µ–ø–µ—Ä—å –æ–Ω –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ–∫—Å—Ç—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ `prompts.json`.

–¢–µ–ø–µ—Ä—å —è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –æ–±–Ω–æ–≤–ª—é `main.py`, —á—Ç–æ–±—ã –æ–Ω –∑–∞–≥—Ä—É–∂–∞–ª –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–ª API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏.

```python
"""
–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- WebSocket-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Voximplant
- API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- –°—Ç–∞—Ç–∏–∫–∞ –¥–ª—è UI –ª–æ–≥–æ–≤
"""
import os, logging, uuid, json, asyncio, io, shutil, time
from typing import Dict, Any

from fastapi import FastAPI, WebSocket, WebSocketDisconnect, Query, status, UploadFile, File
from fastapi.responses import HTMLResponse, JSONResponse, StreamingResponse
from fastapi.staticfiles import StaticFiles
from dotenv import load_dotenv

from Agent import Agent
from log_storage import insert_log, query_logs, to_csv, delete_all_logs
from create_embeddings import recreate_embeddings

# --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---

load_dotenv()
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI()
app.mount("/logs-ui", StaticFiles(directory="logs-ui", html=True), name="logs-ui")

PROMPTS_FILE = "prompts.json"

try:
    agent = Agent()
    logger.info("–ê–≥–µ–Ω—Ç '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.")
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç': {e}", exc_info=True)
    agent = None

# --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏ ---
active_calls: Dict[str, Dict[str, Any]] = {}

# --- –†–æ—É—Ç—ã ---

@app.get("/")
async def root():
    return HTMLResponse(
        "<h3>–ë—ç–∫–µ–Ω–¥ '–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç' –∞–∫—Ç–∏–≤–µ–Ω.<br>"
        "‚Ä¢ WebSocket¬†‚Äî¬†<code>/ws</code><br>"
        "‚Ä¢ UI –ª–æ–≥–æ–≤¬†‚Äî¬†<code>/logs-ui/</code></h3>"
    )

# ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã –¥–ª—è –ª–æ–≥–æ–≤ –∏ CSV –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
@app.get("/logs")
async def get_logs(q: str | None = None,
                   date_from: str | None = None,
                   date_to: str | None = None,
                   status: str | None = None):
    rows = await query_logs({"from": date_from, "to": date_to, "status": status})
    if q:
        q_low = q.lower()
        filtered_rows = []
        for r in rows:
            if q_low in (r.get("callerId") or "").lower():
                filtered_rows.append(r)
                continue
            try:
                transcript = json.loads(r["transcript_json"])
                for turn in transcript:
                    if q_low in turn.get("text", "").lower():
                        filtered_rows.append(r)
                        break
            except (json.JSONDecodeError, AttributeError):
                continue
        rows = filtered_rows
    return JSONResponse(content=rows)

@app.delete("/logs")
async def clear_logs():
    try:
        await delete_all_logs()
        logger.info("üóëÔ∏è –í—Å–µ –ª–æ–≥–∏ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã.")
        return JSONResponse(content={"message": "–í—Å–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã"}, status_code=status.HTTP_200_OK)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–≥–æ–≤: {e}", exc_info=True)
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.get("/logs/csv")
async def get_logs_csv():
    rows = await query_logs({})
    csv_data_str = await to_csv(rows)
    response_bytes = csv_data_str.encode('utf-8-sig')
    return StreamingResponse(
        io.BytesIO(response_bytes),
        media_type="text/csv",
        headers={"Content-Disposition": 'attachment; filename="call_logs.csv"'}
    )

# --- API –¥–ª—è –ë–∞–∑—ã –ó–Ω–∞–Ω–∏–π –∏ –ü—Ä–æ–º–ø—Ç–æ–≤ ---

@app.get("/api/prompts")
async def get_prompts():
    try:
        with open(PROMPTS_FILE, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (FileNotFoundError, json.JSONDecodeError) as e:
        return JSONResponse(status_code=500, content={"error": f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –ø—Ä–æ–º–ø—Ç–æ–≤: {e}"})

@app.post("/api/prompts")
async def update_prompts(new_prompts: Dict[str, Any]):
    try:
        with open(PROMPTS_FILE, 'w', encoding='utf-8') as f:
            json.dump(new_prompts, f, ensure_ascii=False, indent=2)
        
        # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∞–≥–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –ø–æ–¥—Ö–≤–∞—Ç–∏–ª –Ω–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã
        if agent and hasattr(agent, 'reload'):
            agent.reload()
            
        return JSONResponse(content={"message": "–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã."})
    except Exception as e:
        return JSONResponse(status_code=500, content={"error": f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã: {e}"})

@app.get("/kb")
async def get_knowledge_base():
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
    try:
        with open(kb_path, 'r', encoding='utf-8') as f:
            content = f.read()
        return JSONResponse(content={"text": content})
    except FileNotFoundError:
        return JSONResponse(content={"error": "–§–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω"}, status_code=status.HTTP_404_NOT_FOUND)
    except Exception as e:
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.post("/kb/upload")
async def upload_kb(file: UploadFile = File(...)):
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    if not file.filename.endswith('.txt'):
        return JSONResponse(status_code=400, content={"message": "–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ .txt —Ñ–∞–π–ª."})

    try:
        kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
        
        backup_dir = "kb_backups"
        os.makedirs(backup_dir, exist_ok=True)
        timestamp = time.strftime("%Y-%m-%d_%H-%M-%S")
        backup_path = os.path.join(backup_dir, f"–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢_{timestamp}.txt.bak")
        shutil.copy(kb_path, backup_path)
        logger.info(f"üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {backup_path}")

        with open(kb_path, "wb") as buffer:
            shutil.copyfileobj(file.file, buffer)
        
        logger.info(f"‚úÖ –ù–æ–≤—ã–π —Ñ–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π '{file.filename}' —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")

        asyncio.create_task(recreate_embeddings_and_reload_agent())
        
        return JSONResponse(status_code=202, content={"message": "–§–∞–π–ª –ø—Ä–∏–Ω—è—Ç. –ù–∞—á–∞–ª—Å—è –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."})

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ë–ó: {e}", exc_info=True)
        return JSONResponse(status_code=500, content={"message": f"–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}"})

async def recreate_embeddings_and_reload_agent():
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    logger.info("‚è≥ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ...")
    loop = asyncio.get_event_loop()
    try:
        await loop.run_in_executor(None, recreate_embeddings)
        logger.info("‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã.")
        
        if agent and hasattr(agent, 'reload'):
            agent.reload()
            
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {e}", exc_info=True)


@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket, callerId: str = Query(None)):
    await websocket.accept()
    session_id = str(uuid.uuid4())
    start_time = datetime.now(timezone.utc)
    
    active_calls[session_id] = {
        "callerId": callerId,
        "startTime": start_time.isoformat(),
        "transcript": [],
        "status": "Initiated"
    }
    logger.info(f"–ù–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫: Session ID: {session_id}, Caller ID: {callerId}")

    if not agent:
        await websocket.send_text("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞.")
        await websocket.close()
        del active_calls[session_id]
        return

    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ —Ñ–∞–π–ª–∞
        greeting = agent.prompts.get("greeting", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?")
        active_calls[session_id]["transcript"].append(
            {"speaker": "bot", "text": greeting, "timestamp": datetime.now(timezone.utc).isoformat()}
        )
        await websocket.send_text(greeting)

        while True:
            data = await websocket.receive_text()
            logger.info(f"–ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å ({session_id}): {data}")
            active_calls[session_id]["transcript"].append(
                {"speaker": "user", "text": data, "timestamp": datetime.now(timezone.utc).isoformat()}
            )

            response_generator = agent.get_response_generator(data, session_id=session_id)
            
            full_response = ""
            for chunk in response_generator:
                if chunk:
                    await websocket.send_text(chunk)
                    full_response += chunk
            
            logger.info(f"–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç ({session_id}) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.")
            active_calls[session_id]["transcript"].append(
                {"speaker": "bot", "text": full_response, "timestamp": datetime.now(timezone.utc).isoformat()}
            )
            active_calls[session_id]["status"] = "InProgress"

    except WebSocketDisconnect:
        logger.info(f"–ö–ª–∏–µ–Ω—Ç ({session_id}) –æ—Ç–∫–ª—é—á–∏–ª—Å—è.")
        active_calls[session_id]["status"] = "Completed"
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ WS ({session_id}): {e}", exc_info=True)
        active_calls[session_id]["status"] = "Failed"
    finally:
        # ... (–ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        end_time = datetime.now(timezone.utc)
        call_log = active_calls.get(session_id)
        if call_log:
            log_record: Dict[str, Any] = {
                "id": session_id,
                "callerId": call_log["callerId"],
                "startTime": call_log["startTime"],
                "endTime": end_time.isoformat(),
                "status": call_log["status"],
                "transcript": call_log["transcript"],
            }
            try:
                await insert_log(log_record)
                logger.info(f"üíæ –õ–æ–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è Session {session_id}")
            except Exception as err:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ insert_log: {err}", exc_info=True)
            
            del active_calls[session_id]

```

–ë—ç–∫–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤! –Ø –æ–±–Ω–æ–≤–∏–ª `main.py` –∏ `Agent.py`, —á—Ç–æ–±—ã –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —Ñ–∞–π–ª–æ–º `prompts.json`, –∏ –¥–æ–±–∞–≤–∏–ª API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º.

–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥ ‚Äî **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**. –Ø –¥–æ–±–∞–≤–ª—é –≤ `logs-ui/index.js` –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏" –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π –¥–ª—è –∏—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

// ... (–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏–∫–æ–Ω–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const SearchIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", className: "search-icon" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" }));
const DownloadIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" }));
const BookIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));
const TrashIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" }));
const CloseIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "20", height: "20" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }));
const EmptyIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" }));


// ... (–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã StatsCard, LogTable, Modal, KnowledgeBaseModal –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

const PromptsModal = ({ onClose }) => {
    const [prompts, setPrompts] = useState({ greeting: "", contextualize_q_system_prompt: "", qa_system_prompt: "" });
    const [status, setStatus] = useState("");

    useEffect(() => {
        fetch('/api/prompts')
            .then(res => res.json())
            .then(data => setPrompts(data))
            .catch(() => setStatus("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤"));
    }, []);

    const handleChange = (e) => {
        setPrompts({ ...prompts, [e.target.name]: e.target.value });
    };

    const handleSave = async () => {
        setStatus("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
        try {
            const response = await fetch('/api/prompts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prompts),
            });
            const result = await response.json();
            if (response.ok) {
                setStatus("–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
            } else {
                throw new Error(result.error);
            }
        } catch (err) {
            setStatus(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${err.message}`);
        }
    };

    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: (e) => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "prompt-form" },
                    React.createElement("label", null, "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
                    React.createElement("textarea", { name: "greeting", value: prompts.greeting, onChange: handleChange }),

                    React.createElement("label", null, "–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞"),
                    React.createElement("textarea", { name: "contextualize_q_system_prompt", value: prompts.contextualize_q_system_prompt, onChange: handleChange, rows: 5 }),

                    React.createElement("label", null, "–û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç"),
                    React.createElement("textarea", { name: "qa_system_prompt", value: prompts.qa_system_prompt, onChange: handleChange, rows: 10 }),
                    
                    React.createElement("button", { className: "btn btn-primary", onClick: handleSave }, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã"),
                    status && React.createElement("p", { className: "status-message" }, status)
                )
            )
        )
    );
};


const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');
  const [showPromptsModal, setShowPromptsModal] = useState(false);

  // ... (useMemo –¥–ª—è stats –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;
    return { total, completed, failed, interrupted };
  }, [logs]);

  // ... (—Ñ—É–Ω–∫—Ü–∏–∏ fetchLogs, showKnowledgeBase, clearAllLogs, handleKbUpload –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);
    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());
      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }
      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };
    const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };
    const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };
    const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;
    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }
    const formData = new FormData();
    formData.append('file', file);
    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);
    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();
        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };
  
  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
        React.createElement("h1", null, "Admin Panel"),
        React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
        )
    ),
    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, { number: stats.total, label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤", color: "var(--primary)" }),
        React.createElement(StatsCard, { number: stats.completed, label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö", color: "var(--success)" }),
        React.createElement(StatsCard, { number: stats.interrupted, label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö", color: "var(--warning)" }),
        React.createElement(StatsCard, { number: stats.failed, label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö", color: "var(--danger)" })
    ),
    React.createElement("div", { className: "controls" },
        React.createElement("div", { className: "search-container" },
            React.createElement(SearchIcon),
            React.createElement("input", { type: "text", className: "search-input", placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...", value: query, onChange: (e) => setQuery(e.target.value) })
        ),
        React.createElement("input", { type: "date", className: "search-input", value: dateFrom, onChange: (e) => setDateFrom(e.target.value) }),
        React.createElement("input", { type: "date", className: "search-input", value: dateTo, onChange: (e) => setDateTo(e.target.value) }),
        React.createElement("a", { href: "/logs/csv", className: "btn btn-success", style: { pointerEvents: !logs.length ? "none" : "auto", opacity: !logs.length ? 0.5 : 1 } }, React.createElement(DownloadIcon), "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"),
        React.createElement("button", { className: "btn btn-primary", onClick: showKnowledgeBase }, React.createElement(BookIcon), "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" }, "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π", React.createElement("input", { id: "kb-upload", type: "file", accept: ".txt", style: { display: "none" }, onChange: handleKbUpload })),
        React.createElement("button", { className: "btn btn-primary", onClick: () => setShowPromptsModal(true) }, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
        React.createElement("button", { className: "btn btn-danger", onClick: clearAllLogs, disabled: !logs.length }, React.createElement(TrashIcon), "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏")
    ),
    uploadStatus && React.createElement("div", { className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message", style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'} }, uploadStatus),
    error && React.createElement("div", { className: "error" }, `‚ö†Ô∏è ${error}`),
    loading ? React.createElement("div", { className: "loading" }, React.createElement("div", { className: "spinner" })) : React.createElement(LogTable, { logs: logs, onRowClick: setModalLog }),
    React.createElement(Modal, { log: modalLog, onClose: () => setModalLog(null) }),
    React.createElement(KnowledgeBaseModal, { content: kbContent, onClose: () => setKbContent(null) }),
    showPromptsModal && React.createElement(PromptsModal, { onClose: () => setShowPromptsModal(false) })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ! –Ø –∑–∞–≤–µ—Ä—à–∏–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏.

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1.  **–°–æ–∑–¥–∞–Ω `prompts.json`**: –í—Å–µ —Ç–µ–∫—Å—Ç—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.
2.  **–û–±–Ω–æ–≤–ª–µ–Ω `Agent.py`**: –¢–µ–ø–µ—Ä—å –æ–Ω —á–∏—Ç–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –∏–∑ `prompts.json` –∏ —É–º–µ–µ—Ç –∏—Ö "–Ω–∞ –ª–µ—Ç—É" –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å.
3.  **–û–±–Ω–æ–≤–ª–µ–Ω `main.py`**: –î–æ–±–∞–≤–ª–µ–Ω—ã API-–º–µ—Ç–æ–¥—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `prompts.json`, –∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–ø–µ—Ä—å —Ç–æ–∂–µ –±–µ—Ä–µ—Ç—Å—è –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞.
4.  **–û–±–Ω–æ–≤–ª–µ–Ω `logs-ui/index.js`**: –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏" –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π –¥–ª—è –∏—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤–∞–º:**

1.  **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `gunicorn` —Å–µ—Ä–≤–µ—Ä**, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `main.py` –∏ `Agent.py`.
    ```bash
    pkill -f gunicorn
    nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
    ```
2.  **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (`Ctrl+Shift+R`).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É –≤–∞—Å –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞. –í—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –æ–∫–Ω–æ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö. –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ –±–æ—Ç—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

```shellscript
    pkill -f gunicorn
    nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

---

**User**

–±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

---

**Cursor**

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã, –∏ —Å–ø–∞—Å–∏–±–æ –∑–∞ –ª–æ–≥–∏! –Ø –≤–∏–∂—É –ø—Ä–æ–±–ª–µ–º—É.

**–ü—Ä–∏—á–∏–Ω–∞:**
–í —Ö–æ–¥–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —è —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏–ª –æ–¥–Ω—É –æ—á–µ–Ω—å –≤–∞–∂–Ω—É—é —Å—Ç—Ä–æ—á–∫—É –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ `main.py`. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∫ –Ω–µ–º—É –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π WebSocket-–∑–∞–ø—Ä–æ—Å (—Ç–æ –µ—Å—Ç—å –∑–≤–æ–Ω–æ–∫), –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –º–æ–¥—É–ª—å `datetime` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞ –∏ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π:

```
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'
```

–≠—Ç–æ –º–æ—è –≤–∏–Ω–∞, —è –ø—Ä–æ—à—É –ø—Ä–æ—â–µ–Ω–∏—è –∑–∞ —ç—Ç—É –æ–ø–ª–æ—à–Ω–æ—Å—Ç—å.

**–ö–∞–∫ —è —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—é:**
–Ø —Å–µ–π—á–∞—Å –∂–µ –≤–µ—Ä–Ω—É –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –∏–º–ø–æ—Ä—Ç `from datetime import datetime, timezone` –≤ `main.py`.

–°–Ω–∞—á–∞–ª–∞ —è –ø—Ä–æ—á–∏—Ç–∞—é —Ñ–∞–π–ª.

```plaintext
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'
```

–¢–µ–ø–µ—Ä—å —è –¥–æ–±–∞–≤–ª—é –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –∏–º–ø–æ—Ä—Ç.

```python
"""
–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- WebSocket-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Voximplant
- API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- –°—Ç–∞—Ç–∏–∫–∞ –¥–ª—è UI –ª–æ–≥–æ–≤
"""
import os, logging, uuid, json, asyncio, io, shutil, time
from datetime import datetime, timezone
from typing import Dict, Any

from fastapi import FastAPI, WebSocket, WebSocketDisconnect, Query, status, UploadFile, File
from fastapi.responses import HTMLResponse, JSONResponse, StreamingResponse
from fastapi.staticfiles import StaticFiles
from dotenv import load_dotenv

from Agent import Agent
from log_storage import insert_log, query_logs, to_csv, delete_all_logs
from create_embeddings import recreate_embeddings

# --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---

load_dotenv()
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI()
app.mount("/logs-ui", StaticFiles(directory="logs-ui", html=True), name="logs-ui")

PROMPTS_FILE = "prompts.json"

try:
    agent = Agent()
    logger.info("–ê–≥–µ–Ω—Ç '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.")
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ '–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç': {e}", exc_info=True)
    agent = None

# --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏ ---
active_calls: Dict[str, Dict[str, Any]] = {}

# --- –†–æ—É—Ç—ã ---

@app.get("/")
async def root():
    return HTMLResponse(
        "<h3>–ë—ç–∫–µ–Ω–¥ '–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç' –∞–∫—Ç–∏–≤–µ–Ω.<br>"
        "‚Ä¢ WebSocket¬†‚Äî¬†<code>/ws</code><br>"
        "‚Ä¢ UI –ª–æ–≥–æ–≤¬†‚Äî¬†<code>/logs-ui/</code></h3>"
    )

# ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã –¥–ª—è –ª–æ–≥–æ–≤ –∏ CSV –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
@app.get("/logs")
async def get_logs(q: str | None = None,
                   date_from: str | None = None,
                   date_to: str | None = None,
                   status: str | None = None):
    rows = await query_logs({"from": date_from, "to": date_to, "status": status})
    if q:
        q_low = q.lower()
        filtered_rows = []
        for r in rows:
            if q_low in (r.get("callerId") or "").lower():
                filtered_rows.append(r)
                continue
            try:
                transcript = json.loads(r["transcript_json"])
                for turn in transcript:
                    if q_low in turn.get("text", "").lower():
                        filtered_rows.append(r)
                        break
            except (json.JSONDecodeError, AttributeError):
                continue
        rows = filtered_rows
    return JSONResponse(content=rows)

@app.delete("/logs")
async def clear_logs():
    try:
        await delete_all_logs()
        logger.info("üóëÔ∏è –í—Å–µ –ª–æ–≥–∏ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã.")
        return JSONResponse(content={"message": "–í—Å–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã"}, status_code=status.HTTP_200_OK)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–≥–æ–≤: {e}", exc_info=True)
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.get("/logs/csv")
async def get_logs_csv():
    rows = await query_logs({})
    csv_data_str = await to_csv(rows)
    response_bytes = csv_data_str.encode('utf-8-sig')
    return StreamingResponse(
        io.BytesIO(response_bytes),
        media_type="text/csv",
        headers={"Content-Disposition": 'attachment; filename="call_logs.csv"'}
    )

# --- API –¥–ª—è –ë–∞–∑—ã –ó–Ω–∞–Ω–∏–π –∏ –ü—Ä–æ–º–ø—Ç–æ–≤ ---

@app.get("/api/prompts")
async def get_prompts():
    try:
        with open(PROMPTS_FILE, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (FileNotFoundError, json.JSONDecodeError) as e:
        return JSONResponse(status_code=500, content={"error": f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –ø—Ä–æ–º–ø—Ç–æ–≤: {e}"})

@app.post("/api/prompts")
async def update_prompts(new_prompts: Dict[str, Any]):
    try:
        with open(PROMPTS_FILE, 'w', encoding='utf-8') as f:
            json.dump(new_prompts, f, ensure_ascii=False, indent=2)
        
        # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∞–≥–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –ø–æ–¥—Ö–≤–∞—Ç–∏–ª –Ω–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã
        if agent and hasattr(agent, 'reload'):
            agent.reload()
            
        return JSONResponse(content={"message": "–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã."})
    except Exception as e:
        return JSONResponse(status_code=500, content={"error": f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã: {e}"})

@app.get("/kb")
async def get_knowledge_base():
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
    try:
        with open(kb_path, 'r', encoding='utf-8') as f:
            content = f.read()
        return JSONResponse(content={"text": content})
    except FileNotFoundError:
        return JSONResponse(content={"error": "–§–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω"}, status_code=status.HTTP_404_NOT_FOUND)
    except Exception as e:
        return JSONResponse(content={"error": str(e)}, status_code=status.HTTP_500_INTERNAL_SERVER_ERROR)

@app.post("/kb/upload")
async def upload_kb(file: UploadFile = File(...)):
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    if not file.filename.endswith('.txt'):
        return JSONResponse(status_code=400, content={"message": "–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ .txt —Ñ–∞–π–ª."})

    try:
        kb_path = "–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt"
        
        backup_dir = "kb_backups"
        os.makedirs(backup_dir, exist_ok=True)
        timestamp = time.strftime("%Y-%m-%d_%H-%M-%S")
        backup_path = os.path.join(backup_dir, f"–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢_{timestamp}.txt.bak")
        shutil.copy(kb_path, backup_path)
        logger.info(f"üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {backup_path}")

        with open(kb_path, "wb") as buffer:
            shutil.copyfileobj(file.file, buffer)
        
        logger.info(f"‚úÖ –ù–æ–≤—ã–π —Ñ–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π '{file.filename}' —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")

        asyncio.create_task(recreate_embeddings_and_reload_agent())
        
        return JSONResponse(status_code=202, content={"message": "–§–∞–π–ª –ø—Ä–∏–Ω—è—Ç. –ù–∞—á–∞–ª—Å—è –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."})

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ë–ó: {e}", exc_info=True)
        return JSONResponse(status_code=500, content={"message": f"–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}"})

async def recreate_embeddings_and_reload_agent():
    # ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    logger.info("‚è≥ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ...")
    loop = asyncio.get_event_loop()
    try:
        await loop.run_in_executor(None, recreate_embeddings)
        logger.info("‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã.")
        
        if agent and hasattr(agent, 'reload'):
            agent.reload()
            
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {e}", exc_info=True)


@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket, callerId: str = Query(None)):
    await websocket.accept()
    session_id = str(uuid.uuid4())
    start_time = datetime.now(timezone.utc)
    
    active_calls[session_id] = {
        "callerId": callerId,
        "startTime": start_time.isoformat(),
        "transcript": [],
        "status": "Initiated"
    }
    logger.info(f"–ù–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫: Session ID: {session_id}, Caller ID: {callerId}")

    if not agent:
        await websocket.send_text("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞.")
        await websocket.close()
        del active_calls[session_id]
        return

    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ —Ñ–∞–π–ª–∞
        greeting = agent.prompts.get("greeting", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?")
        active_calls[session_id]["transcript"].append(
            {"speaker": "bot", "text": greeting, "timestamp": datetime.now(timezone.utc).isoformat()}
        )
        await websocket.send_text(greeting)

        while True:
            data = await websocket.receive_text()
            logger.info(f"–ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å ({session_id}): {data}")
            active_calls[session_id]["transcript"].append(
                {"speaker": "user", "text": data, "timestamp": datetime.now(timezone.utc).isoformat()}
            )

            response_generator = agent.get_response_generator(data, session_id=session_id)
            
            full_response = ""
            for chunk in response_generator:
                if chunk:
                    await websocket.send_text(chunk)
                    full_response += chunk
            
            logger.info(f"–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç ({session_id}) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.")
            active_calls[session_id]["transcript"].append(
                {"speaker": "bot", "text": full_response, "timestamp": datetime.now(timezone.utc).isoformat()}
            )
            active_calls[session_id]["status"] = "InProgress"

    except WebSocketDisconnect:
        logger.info(f"–ö–ª–∏–µ–Ω—Ç ({session_id}) –æ—Ç–∫–ª—é—á–∏–ª—Å—è.")
        active_calls[session_id]["status"] = "Completed"
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ WS ({session_id}): {e}", exc_info=True)
        active_calls[session_id]["status"] = "Failed"
    finally:
        # ... (–ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        end_time = datetime.now(timezone.utc)
        call_log = active_calls.get(session_id)
        if call_log:
            log_record: Dict[str, Any] = {
                "id": session_id,
                "callerId": call_log["callerId"],
                "startTime": call_log["startTime"],
                "endTime": end_time.isoformat(),
                "status": call_log["status"],
                "transcript": call_log["transcript"],
            }
            try:
                await insert_log(log_record)
                logger.info(f"üíæ –õ–æ–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è Session {session_id}")
            except Exception as err:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ insert_log: {err}", exc_info=True)
            
            del active_calls[session_id]

```

–ì–æ—Ç–æ–≤–æ, —è –≤–µ—Ä–Ω—É–ª –∏–º–ø–æ—Ä—Ç `datetime` –Ω–∞ –º–µ—Å—Ç–æ.

–¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∞ `NameError` –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å.

**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä `gunicorn` –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑.** –≠—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É.

```bash
pkill -f gunicorn
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ–ª–∂–Ω—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

```shellscript
pkill -f gunicorn
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

```shellscript
pkill -f gunicorn
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

---

**User**

–±–æ—Ç —Ç–µ–ø–µ—Ä—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–æ –∞–¥–º–∏–Ω–∫–∞ –ø—É—Å—Ç–∞—è

---

**Cursor**

–í—ã –ø—Ä–∞–≤—ã, —è –≤–∏–∂—É –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É. –≠—Ç–æ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ JavaScript-–∫–æ–¥–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`logs-ui/index.js`) –µ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –º–µ—à–∞–µ—Ç React –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.

–Ø –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä—é –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–∏—Å–∞–ª –¥–ª—è `logs-ui/index.js`, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ—à–∏–±–∫—É. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —è –≥–¥–µ-—Ç–æ –æ–ø–µ—á–∞—Ç–∞–ª—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤.

–ù–∞—à–µ–ª! –Ø –¥–æ–ø—É—Å—Ç–∏–ª –æ—á–µ–Ω—å –≥–ª—É–ø—É—é –æ—à–∏–±–∫—É ‚Äî —è –∑–∞–±—ã–ª –¥–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`StatsCard`, `LogTable`, `Modal`, `KnowledgeBaseModal`) –≤ –Ω–æ–≤—ã–π `index.js`. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ React –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∏—Ö –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.

–Ø —Å–µ–π—á–∞—Å –∂–µ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—é, –≤–µ—Ä–Ω—É–≤ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Ñ–∞–π–ª.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  if (!start || !end) return "‚Äî";
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  if (!dateString) return "‚Äî";
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const SearchIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", className: "search-icon" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" }));
const DownloadIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" }));
const BookIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));
const TrashIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" }));
const CloseIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "20", height: "20" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }));
const EmptyIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" }));

const StatsCard = ({ number, label, color = "var(--primary)" }) =>
  React.createElement("div", { className: "stat-card" },
    React.createElement("div", { className: "stat-number", style: { color } }, number),
    React.createElement("div", { className: "stat-label" }, label)
  );

const LogTable = ({ logs, onRowClick }) => {
  if (logs.length === 0) {
    return React.createElement("div", { className: "empty-state" },
      React.createElement(EmptyIcon),
      React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
      React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
    );
  }
  return React.createElement("div", { className: "table-container" },
    React.createElement("table", { className: "table" },
      React.createElement("thead", null, React.createElement("tr", null, ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map(header => React.createElement("th", { key: header }, header)))),
      React.createElement("tbody", null, logs.map(log =>
        React.createElement("tr", { key: log.id, onClick: () => onRowClick(log) },
          React.createElement("td", null, React.createElement("code", null, log.id.slice(0, 8) + "...")),
          React.createElement("td", null, log.callerId || "‚Äî"),
          React.createElement("td", null, formatDate(log.startTime)),
          React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
          React.createElement("td", null, React.createElement("span", { className: `status ${log.status}` }, log.status))
        )
      ))
    )
  );
};

const Modal = ({ log, onClose }) => {
    if (!log) return null;
    let transcript = [];
    try {
        transcript = JSON.parse(log.transcript_json);
    } catch (e) {
        transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
    }
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "info-grid" },
                    // ... info items
                ),
                React.createElement("div", { className: "transcript" },
                    React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
                    transcript.map((turn, index) =>
                        React.createElement("div", { key: index, className: `turn ${turn.speaker}` }, turn.text)
                    )
                )
            )
        )
    );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
    if (!content) return null;
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("pre", { style: { whiteSpace: 'pre-wrap', lineHeight: '1.6', background: 'var(--bg-primary)', padding: '1rem', borderRadius: '0.5rem', border: '1px solid var(--border)' } }, content.text || content.error)
            )
        )
    );
};

const PromptsModal = ({ onClose }) => {
    const [prompts, setPrompts] = useState({ greeting: "", contextualize_q_system_prompt: "", qa_system_prompt: "" });
    const [status, setStatus] = useState("");

    useEffect(() => {
        fetch('/api/prompts')
            .then(res => res.json())
            .then(data => setPrompts(data))
            .catch(() => setStatus("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤"));
    }, []);

    const handleChange = (e) => {
        setPrompts({ ...prompts, [e.target.name]: e.target.value });
    };

    const handleSave = async () => {
        setStatus("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
        try {
            const response = await fetch('/api/prompts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prompts),
            });
            const result = await response.json();
            if (response.ok) {
                setStatus("–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
            } else {
                throw new Error(result.error);
            }
        } catch (err) {
            setStatus(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${err.message}`);
        }
    };

    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: (e) => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "prompt-form" },
                    React.createElement("label", null, "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
                    React.createElement("textarea", { name: "greeting", value: prompts.greeting, onChange: handleChange, rows: 2 }),

                    React.createElement("label", null, "–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞"),
                    React.createElement("textarea", { name: "contextualize_q_system_prompt", value: prompts.contextualize_q_system_prompt, onChange: handleChange, rows: 5 }),

                    React.createElement("label", null, "–û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç"),
                    React.createElement("textarea", { name: "qa_system_prompt", value: prompts.qa_system_prompt, onChange: handleChange, rows: 10 }),
                    
                    React.createElement("button", { className: "btn btn-primary", onClick: handleSave }, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã"),
                    status && React.createElement("p", { className: "status-message" }, status)
                )
            )
        )
    );
};


const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');
  const [showPromptsModal, setShowPromptsModal] = useState(false);

  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;
    return { total, completed, failed, interrupted };
  }, [logs]);

  const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);
    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());
      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }
      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };
    const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };
    const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };
    const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;
    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }
    const formData = new FormData();
    formData.append('file', file);
    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);
    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();
        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };
  
  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
        React.createElement("h1", null, "Admin Panel"),
        React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
        )
    ),
    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, { number: stats.total, label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤", color: "var(--primary)" }),
        React.createElement(StatsCard, { number: stats.completed, label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö", color: "var(--success)" }),
        React.createElement(StatsCard, { number: stats.interrupted, label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö", color: "var(--warning)" }),
        React.createElement(StatsCard, { number: stats.failed, label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö", color: "var(--danger)" })
    ),
    React.createElement("div", { className: "controls" },
        React.createElement("div", { className: "search-container" },
            React.createElement(SearchIcon),
            React.createElement("input", { type: "text", className: "search-input", placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...", value: query, onChange: (e) => setQuery(e.target.value) })
        ),
        React.createElement("input", { type: "date", className: "search-input", value: dateFrom, onChange: (e) => setDateFrom(e.target.value) }),
        React.createElement("input", { type: "date", className: "search-input", value: dateTo, onChange: (e) => setDateTo(e.target.value) }),
        React.createElement("a", { href: "/logs/csv", className: "btn btn-success", style: { pointerEvents: !logs.length ? "none" : "auto", opacity: !logs.length ? 0.5 : 1 } }, React.createElement(DownloadIcon), "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"),
        React.createElement("button", { className: "btn btn-primary", onClick: showKnowledgeBase }, React.createElement(BookIcon), "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" }, "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π", React.createElement("input", { id: "kb-upload", type: "file", accept: ".txt", style: { display: "none" }, onChange: handleKbUpload })),
        React.createElement("button", { className: "btn btn-primary", onClick: () => setShowPromptsModal(true) }, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
        React.createElement("button", { className: "btn btn-danger", onClick: clearAllLogs, disabled: !logs.length }, React.createElement(TrashIcon), "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏")
    ),
    uploadStatus && React.createElement("div", { className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message", style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'} }, uploadStatus),
    error && React.createElement("div", { className: "error" }, `‚ö†Ô∏è ${error}`),
    loading ? React.createElement("div", { className: "loading" }, React.createElement("div", { className: "spinner" })) : React.createElement(LogTable, { logs: logs, onRowClick: setModalLog }),
    React.createElement(Modal, { log: modalLog, onClose: () => setModalLog(null) }),
    React.createElement(KnowledgeBaseModal, { content: kbContent, onClose: () => setKbContent(null) }),
    showPromptsModal && React.createElement(PromptsModal, { onClose: () => setShowPromptsModal(false) })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ. –Ø –∏—Å–ø—Ä–∞–≤–∏–ª —Ñ–∞–π–ª `logs-ui/index.js`, –≤–µ—Ä–Ω—É–≤ –≤ –Ω–µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, **–æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (`Ctrl+Shift+R`). –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–Ω–æ.

–ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

**User**

–ø–æ—Å–º–æ—Ä–∏ –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å! –î–∞–≤–∞–π –ø–æ–ø—Ä–∞–≤–∏–º! –Ω–∞—à –ø–æ–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ –æ—á–µ–Ω—å

---

**Cursor**

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã! –ü—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø—Ä–∏–≤–µ–ª–∏, –≤—ã–≥–ª—è–¥–∏—Ç –≥–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–µ–µ –∏ —É–¥–æ–±–Ω–µ–µ. –í–∫–ª–∞–¥–∫–∏, –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è, —Å—á–µ—Ç—á–∏–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

–î–∞–≤–∞–π—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–µ–ª–∞–µ–º –Ω–∞—à–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –≤–∑—è–≤ –∑–∞ –æ—Å–Ω–æ–≤—É –≤–∞—à –ø—Ä–∏–º–µ—Ä. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤ CSS, –∏ –≤ JavaScript —Ñ–∞–π–ª–µ.

### –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

1.  **–î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏:** –Ø –ø–µ—Ä–µ–Ω–µ—Å—É –≤—Å–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –≤ `logs-ui/index.css`.
2.  **–ü–µ—Ä–µ—Å—Ç—Ä–æ–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** –Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—à—É React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç `PromptsModal` –≤ —Ñ–∞–π–ª–µ `logs-ui/index.js`, —á—Ç–æ–±—ã –æ–Ω —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—É—é HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –∏ –≤—Å–µ–º–∏ –Ω–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏.

–ù–∞—á–Ω–µ–º —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π. –Ø –ø—Ä–æ—á–∏—Ç–∞—é `logs-ui/index.css`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª `index.css`. –¢–µ–ø–µ—Ä—å —è –¥–æ–±–∞–≤–ª—é –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞.

```css
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --border: #475569;
  --shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 25px 50px -12px rgb(0 0 0 / 0.25);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, var(--bg-primary) 0%, #1a202c 100%);
  color: var(--text-primary);
  min-height: 100vh;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2rem;
  padding: 1.5rem 2rem;
  background: var(--bg-secondary);
  border-radius: 1rem;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
}

.header h1 {
  font-size: 2rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--primary), #8b5cf6);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: var(--bg-secondary);
  padding: 1.5rem;
  border-radius: 1rem;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), #8b5cf6);
}

.stat-number {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.stat-label {
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.controls {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  align-items: center;
}

.search-container {
  position: relative;
  flex: 1;
  min-width: 300px;
}

.search-input {
  width: 100%;
  padding: 0.75rem 1rem 0.75rem 3rem;
  background: var(--bg-secondary);
  border: 2px solid var(--border);
  border-radius: 0.75rem;
  color: var(--text-primary);
  font-size: 1rem;
  transition: all 0.3s ease;
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
}

.search-icon {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  width: 1.25rem;
  height: 1.25rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  font-size: 0.875rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #059669;
  transform: translateY(-1px);
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background: #dc2626;
  transform: translateY(-1px);
}

.table-container {
  background: var(--bg-secondary);
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th {
  background: var(--bg-tertiary);
  padding: 1rem;
  text-align: left;
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.table td {
  padding: 1rem;
  border-bottom: 1px solid var(--border);
  transition: background-color 0.2s ease;
}

.table tbody tr {
  cursor: pointer;
  transition: all 0.2s ease;
}

.table tbody tr:hover {
  background: var(--bg-tertiary);
  transform: scale(1.01);
}

.status {
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.status.Completed {
  background: rgb(16 185 129 / 0.2);
  color: var(--success);
  border: 1px solid var(--success);
}

.status.Interrupted {
  background: rgb(245 158 11 / 0.2);
  color: var(--warning);
  border: 1px solid var(--warning);
}

.status.Failed {
  background: rgb(239 68 68 / 0.2);
  color: var(--danger);
  border: 1px solid var(--danger);
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  z-index: 1000;
}

.modal.show {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--bg-secondary);
  border-radius: 1rem;
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

.modal-header {
  padding: 1.5rem 2rem;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-header h3 {
  font-size: 1.25rem;
  font-weight: 600;
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 0.5rem;
  transition: all 0.2s ease;
}

.close-btn:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.modal-body {
  padding: 2rem;
  overflow-y: auto;
  max-height: calc(90vh - 120px);
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.info-item {
  background: var(--bg-tertiary);
  padding: 1rem;
  border-radius: 0.75rem;
}

.info-label {
  color: var(--text-muted);
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
}

.info-value {
  font-weight: 600;
  font-size: 1rem;
}

.transcript {
  margin-top: 2rem;
}

.transcript h4 {
  margin-bottom: 1rem;
  color: var(--text-secondary);
}

.turn {
  margin-bottom: 1rem;
  padding: 1rem;
  border-radius: 0.75rem;
  position: relative;
  animation: slideIn 0.3s ease;
}

.turn.user {
  background: linear-gradient(135deg, var(--primary), #8b5cf6);
  color: white;
  margin-left: 2rem;
  border-bottom-right-radius: 0.25rem;
}

.turn.bot {
  background: var(--bg-tertiary);
  margin-right: 2rem;
  border-bottom-left-radius: 0.25rem;
}

.turn.system {
  background: var(--bg-primary);
  border: 1px solid var(--border);
  font-style: italic;
  text-align: center;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.loading {
  display: flex;
  justify-content: center;
  padding: 3rem;
}

.spinner {
  width: 3rem;
  height: 3rem;
  border: 3px solid var(--border);
  border-top: 3px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error {
  background: rgb(239 68 68 / 0.1);
  border: 1px solid var(--danger);
  color: var(--danger);
  padding: 1rem;
  border-radius: 0.75rem;
  margin-bottom: 2rem;
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--text-muted);
}

.empty-state svg {
  width: 4rem;
  height: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }

  .header {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }

  .controls {
    flex-direction: column;
  }

  .search-container {
    min-width: unset;
  }

  .table-container {
    overflow-x: auto;
  }

  .turn.user {
    margin-left: 0;
  }

  .turn.bot {
    margin-right: 0;
  }

  .info-grid {
    grid-template-columns: 1fr;
  }
}

/* --- –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ --- */
.prompt-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.prompt-form label {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.prompt-form textarea {
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    padding: 0.75rem;
    color: var(--text-primary);
    font-family: 'SF Mono', Monaco, Consolas, 'Courier New', monospace;
    font-size: 0.875rem;
    resize: vertical;
    transition: all 0.2s;
}

.prompt-form textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgb(99 102 241 / 0.2);
}

.status-message {
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    text-align: center;
}

```

---

**User**

–ø—Ä–æ–¥–æ–ª–∂–∏

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ, —Å—Ç–∏–ª–∏ –Ω–∞ –º–µ—Å—Ç–µ.

–¢–µ–ø–µ—Ä—å —è –ø—Ä–∏—Å—Ç—É–ø–∞—é –∫ —Å–∞–º–æ–π –≤–∞–∂–Ω–æ–π —á–∞—Å—Ç–∏: **–ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ JavaScript-–∫–æ–¥–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞** –≤ —Ñ–∞–π–ª–µ `logs-ui/index.js`.

–Ø –∑–∞–º–µ–Ω—é –Ω–∞—à —Å—Ç–∞—Ä—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π `PromptsModal` –Ω–∞ –Ω–æ–≤—ã–π, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ç–µ –∫–ª–∞—Å—Å—ã, —á—Ç–æ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏. –û–Ω –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≤ —Å–µ–±—è:
*   –ù–æ–≤—É—é HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –≤–∫–ª–∞–¥–∫–∞–º–∏.
*   –õ–æ–≥–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏.
*   –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–ª–æ–≤.
*   –û–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö.

–≠—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–µ–æ–±—Ä–∞–∑–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

const debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      func.apply(this, args);
    }, delay);
  };
};

const formatDuration = (start, end) => {
  if (!start || !end) return "‚Äî";
  const duration = (new Date(end) - new Date(start)) / 1000;
  const minutes = Math.floor(duration / 60);
  const seconds = Math.floor(duration % 60);
  return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
  if (!dateString) return "‚Äî";
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const SearchIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", className: "search-icon" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" }));
const DownloadIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" }));
const BookIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));
const TrashIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" }));
const CloseIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "20", height: "20" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }));
const EmptyIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" }));

const StatsCard = ({ number, label, color = "var(--primary)" }) =>
    React.createElement("div", { className: "stat-card" },
        React.createElement("div", { className: "stat-number", style: { color } }, number),
        React.createElement("div", { className: "stat-label" }, label)
    );

const LogTable = ({ logs, onRowClick }) => {
    if (logs.length === 0) {
        return React.createElement("div", { className: "empty-state" },
            React.createElement(EmptyIcon),
            React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
            React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
        );
    }
    return React.createElement("div", { className: "table-container" },
        React.createElement("table", { className: "table" },
            React.createElement("thead", null, React.createElement("tr", null, ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map(header => React.createElement("th", { key: header }, header)))),
            React.createElement("tbody", null, logs.map(log =>
                React.createElement("tr", { key: log.id, onClick: () => onRowClick(log) },
                    React.createElement("td", null, React.createElement("code", null, log.id.slice(0, 8) + "...")),
                    React.createElement("td", null, log.callerId || "‚Äî"),
                    React.createElement("td", null, formatDate(log.startTime)),
                    React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
                    React.createElement("td", null, React.createElement("span", { className: `status ${log.status}` }, log.status))
                )
            ))
        )
    );
};

const Modal = ({ log, onClose }) => {
    if (!log) return null;
    let transcript = [];
    try {
        transcript = JSON.parse(log.transcript_json);
    } catch (e) {
        transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
    }
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "info-grid" },
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "ID –∑–≤–æ–Ω–∫–∞"), React.createElement("div", { className: "info-value" }, React.createElement("code", null, log.id))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"), React.createElement("div", { className: "info-value" }, log.callerId || "–ù–µ —É–∫–∞–∑–∞–Ω")),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"), React.createElement("div", { className: "info-value" }, formatDate(log.startTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è"), React.createElement("div", { className: "info-value" }, formatDate(log.endTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"), React.createElement("div", { className: "info-value" }, formatDuration(log.startTime, log.endTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–°—Ç–∞—Ç—É—Å"), React.createElement("div", { className: "info-value" }, React.createElement("span", { className: `status ${log.status}` }, log.status)))
                ),
                React.createElement("div", { className: "transcript" },
                    React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
                    transcript.map((turn, index) =>
                        React.createElement("div", { key: index, className: `turn ${turn.speaker}` }, turn.text)
                    )
                )
            )
        )
    );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
    if (!content) return null;
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("pre", { style: { whiteSpace: 'pre-wrap', lineHeight: '1.6', background: 'var(--bg-primary)', padding: '1rem', borderRadius: '0.5rem', border: '1px solid var(--border)' } }, content.text || content.error)
            )
        )
    );
};

const PromptsModal = ({ onClose }) => {
    const [prompts, setPrompts] = useState({ greeting: "", contextualize_q_system_prompt: "", qa_system_prompt: "" });
    const [status, setStatus] = useState("");
    const [activeTab, setActiveTab] = useState('greeting');

    useEffect(() => {
        fetch('/api/prompts')
            .then(res => res.json())
            .then(data => setPrompts(data))
            .catch(() => setStatus("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤"));
    }, []);

    const handleChange = (e) => {
        setPrompts({ ...prompts, [e.target.name]: e.target.value });
    };

    const handleSave = async () => {
        setStatus("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
        try {
            const response = await fetch('/api/prompts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prompts),
            });
            const result = await response.json();
            if (response.ok) {
                setStatus("–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
            } else {
                throw new Error(result.error);
            }
        } catch (err) {
            setStatus(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${err.message}`);
        }
    };

    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", style:{maxWidth: '1200px'}, onClick: (e) => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "tabs" },
                    React.createElement("div", { className: `tab ${activeTab === 'greeting' ? 'active' : ''}`, onClick: () => setActiveTab('greeting') }, "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
                    React.createElement("div", { className: `tab ${activeTab === 'context' ? 'active' : ''}`, onClick: () => setActiveTab('context') }, "–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è"),
                    React.createElement("div", { className: `tab ${activeTab === 'system' ? 'active' : ''}`, onClick: () => setActiveTab('system') }, "–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç")
                ),
                React.createElement("div", { className: `tab-content ${activeTab === 'greeting' ? 'active' : ''}` },
                     React.createElement("textarea", { name: "greeting", className:"prompt-textarea", value: prompts.greeting, onChange: handleChange, rows: 2 })
                ),
                 React.createElement("div", { className: `tab-content ${activeTab === 'context' ? 'active' : ''}` },
                    React.createElement("textarea", { name: "contextualize_q_system_prompt", className:"prompt-textarea", value: prompts.contextualize_q_system_prompt, onChange: handleChange, rows: 10 })
                ),
                React.createElement("div", { className: `tab-content ${activeTab === 'system' ? 'active' : ''}` },
                    React.createElement("textarea", { name: "qa_system_prompt", className:"prompt-textarea", value: prompts.qa_system_prompt, onChange: handleChange, rows: 15 })
                )
            ),
             React.createElement("div", { className: "actions" },
                React.createElement("p", { className: "status-message" }, status),
                React.createElement("button", { className: "btn btn-primary", onClick: handleSave }, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã")
            )
        )
    );
};


const App = () => {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState("");
  const [modalLog, setModalLog] = useState(null);
  const [kbContent, setKbContent] = useState(null);
  const [dateFrom, setDateFrom] = useState("");
  const [dateTo, setDateTo] = useState("");
  const [uploadStatus, setUploadStatus] = useState('');
  const [showPromptsModal, setShowPromptsModal] = useState(false);

  const stats = useMemo(() => {
    const total = logs.length;
    const completed = logs.filter(log => log.status === 'Completed').length;
    const failed = logs.filter(log => log.status === 'Failed').length;
    const interrupted = logs.filter(log => log.status === 'Interrupted').length;
    return { total, completed, failed, interrupted };
  }, [logs]);

  const fetchLogs = async (searchQuery, isInitialLoad = false) => {
    if (isInitialLoad) setLoading(true);
    setError(null);
    try {
      const params = new URLSearchParams();
      if (searchQuery) params.append('q', searchQuery);
      if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
      if (dateTo) params.append('date_to', new Date(dateTo).toISOString());
      const url = `/logs?${params.toString()}`;
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
      }
      const data = await response.json();
      setLogs(data);
    } catch (err) {
      setError(err.message);
    } finally {
      if (isInitialLoad) setLoading(false);
    }
  };
    const showKnowledgeBase = async () => {
    try {
      const response = await fetch("/kb");
      const data = await response.json();
      setKbContent(data);
    } catch (err) {
      setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
    }
  };
    const clearAllLogs = async () => {
    if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
      setError(null);
      try {
        const response = await fetch("/logs", { method: 'DELETE' });
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
        }
        fetchLogs(query, true);
      } catch (err) {
        setError(err.message);
      }
    }
  };
    const handleKbUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;
    if (!file.name.endsWith('.txt')) {
        setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
        return;
    }
    const formData = new FormData();
    formData.append('file', file);
    setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
    setError(null);
    try {
        const response = await fetch('/kb/upload', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();
        if (response.ok) {
            setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
        } else {
            throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
        }
    } catch (err) {
        setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
        setError(err.message);
    }
  };
  
  useEffect(() => {
    fetchLogs(query, true);
    const intervalId = setInterval(() => {
      if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
        fetchLogs(query);
      }
    }, 5000);
    return () => clearInterval(intervalId);
  }, [query, dateFrom, dateTo]);

  return React.createElement("div", { className: "container" },
    React.createElement("div", { className: "header" },
        React.createElement("h1", null, "Admin Panel"),
        React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
        )
    ),
    React.createElement("div", { className: "stats-grid" },
        React.createElement(StatsCard, { number: stats.total, label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤", color: "var(--primary)" }),
        React.createElement(StatsCard, { number: stats.completed, label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö", color: "var(--success)" }),
        React.createElement(StatsCard, { number: stats.interrupted, label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö", color: "var(--warning)" }),
        React.createElement(StatsCard, { number: stats.failed, label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö", color: "var(--danger)" })
    ),
    React.createElement("div", { className: "controls" },
        React.createElement("div", { className: "search-container" },
            React.createElement(SearchIcon),
            React.createElement("input", { type: "text", className: "search-input", placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...", value: query, onChange: (e) => setQuery(e.target.value) })
        ),
        React.createElement("input", { type: "date", className: "search-input", value: dateFrom, onChange: (e) => setDateFrom(e.target.value) }),
        React.createElement("input", { type: "date", className: "search-input", value: dateTo, onChange: (e) => setDateTo(e.target.value) }),
        React.createElement("a", { href: "/logs/csv", className: "btn btn-success", style: { pointerEvents: !logs.length ? "none" : "auto", opacity: !logs.length ? 0.5 : 1 } }, React.createElement(DownloadIcon), "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"),
        React.createElement("button", { className: "btn btn-primary", onClick: showKnowledgeBase }, React.createElement(BookIcon), "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
        React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" }, "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π", React.createElement("input", { id: "kb-upload", type: "file", accept: ".txt", style: { display: "none" }, onChange: handleKbUpload })),
        React.createElement("button", { className: "btn btn-primary", onClick: () => setShowPromptsModal(true) }, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
        React.createElement("button", { className: "btn btn-danger", onClick: clearAllLogs, disabled: !logs.length }, React.createElement(TrashIcon), "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏")
    ),
    uploadStatus && React.createElement("div", { className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message", style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'} }, uploadStatus),
    error && React.createElement("div", { className: "error" }, `‚ö†Ô∏è ${error}`),
    loading ? React.createElement("div", { className: "loading" }, React.createElement("div", { className: "spinner" })) : React.createElement(LogTable, { logs: logs, onRowClick: setModalLog }),
    React.createElement(Modal, { log: modalLog, onClose: () => setModalLog(null) }),
    React.createElement(KnowledgeBaseModal, { content: kbContent, onClose: () => setKbContent(null) }),
    showPromptsModal && React.createElement(PromptsModal, { onClose: () => setShowPromptsModal(false) })
  );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ! –Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤ `logs-ui/index.js`, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à —É–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω.

–ü–æ—Å–∫–æ–ª—å–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Å–Ω—É–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–Ω–æ**.

–ü—Ä–æ—Å—Ç–æ **–æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (`Ctrl+Shift+R`). –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏" –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–π, –∫—Ä–∞—Å–∏–≤—ã–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

**User**

–£–∂–∞—Å–Ω–æ! –ü–æ–∫–∞ –Ω–µ –º–µ–Ω—è–π –Ω–∏—á–µ–≥–æ —Å–µ–π—á–∞—Å —è —Ç–µ–±–µ –æ—Ç–ø—Ä–∞–≤–ª—é –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å!

---

**Cursor**

–ü–æ–Ω—è–ª –≤–∞—Å. –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–∂–∞—Å–Ω—ã–π, –≤—ã –ø—Ä–∞–≤—ã. –ü—Ä–æ—à—É –ø—Ä–æ—â–µ–Ω–∏—è, —è –¥–æ–ø—É—Å—Ç–∏–ª –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏–∫–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –≤ React.

–•–æ—Ä–æ—à–æ, —è –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è—é –∏ –±—É–¥—É –∂–¥–∞—Ç—å –æ—Ç –≤–∞—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –°–ø–∞—Å–∏–±–æ!

---

**User**

–≤–æ—Ç –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!

---

**Cursor**

–°–ø–∞—Å–∏–±–æ! –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –µ—Å—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑–µ—Ü. –í–æ—Ç —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ.

–Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–Ω—è–ª —Å–≤–æ—é –æ—à–∏–±–∫—É: —è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –ª–æ–≥–∏–∫—É –≤–∫–ª–∞–¥–æ–∫, –∏–∑-–∑–∞ —á–µ–≥–æ –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–°–µ–π—á–∞—Å —è –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª—é. –Ø –ø–µ—Ä–µ–ø–∏—à—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `PromptsModal` –≤ `logs-ui/index.js` —Å –Ω—É–ª—è, —Ç–æ—á–Ω–æ —Å–ª–µ–¥—É—è –≤–∞—à–µ–º—É –¥–∏–∑–∞–π–Ω—É.

–Ø –Ω–∞—á–Ω—É —Å —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–Ø –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª—é.

```javascript
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

const debounce = (func, delay) => {
    let timeoutId;
    return (...args) => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
};

const formatDuration = (start, end) => {
    if (!start || !end) return "‚Äî";
    const duration = (new Date(end) - new Date(start)) / 1000;
    const minutes = Math.floor(duration / 60);
    const seconds = Math.floor(duration % 60);
    return minutes > 0 ? `${minutes}–º ${seconds}—Å` : `${seconds}—Å`;
};

const formatDate = (dateString) => {
    if (!dateString) return "‚Äî";
    return new Date(dateString).toLocaleString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
};

const SearchIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", className: "search-icon" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" }));
const DownloadIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" }));
const BookIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));
const TrashIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "16", height: "16" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" }));
const CloseIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", width: "20", height: "20" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }));
const EmptyIcon = () => React.createElement("svg", { fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" }));


const StatsCard = ({ number, label, color = "var(--primary)" }) =>
    React.createElement("div", { className: "stat-card" },
        React.createElement("div", { className: "stat-number", style: { color } }, number),
        React.createElement("div", { className: "stat-label" }, label)
    );

const LogTable = ({ logs, onRowClick }) => {
    if (logs.length === 0) {
        return React.createElement("div", { className: "empty-state" },
            React.createElement(EmptyIcon),
            React.createElement("h3", null, "–ù–µ—Ç –ª–æ–≥–æ–≤"),
            React.createElement("p", null, "–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å")
        );
    }
    return React.createElement("div", { className: "table-container" },
        React.createElement("table", { className: "table" },
            React.createElement("thead", null, React.createElement("tr", null, ["ID", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å"].map(header => React.createElement("th", { key: header }, header)))),
            React.createElement("tbody", null, logs.map(log =>
                React.createElement("tr", { key: log.id, onClick: () => onRowClick(log) },
                    React.createElement("td", null, React.createElement("code", null, log.id.slice(0, 8) + "...")),
                    React.createElement("td", null, log.callerId || "‚Äî"),
                    React.createElement("td", null, formatDate(log.startTime)),
                    React.createElement("td", null, formatDuration(log.startTime, log.endTime)),
                    React.createElement("td", null, React.createElement("span", { className: `status ${log.status}` }, log.status))
                )
            ))
        )
    );
};

const Modal = ({ log, onClose }) => {
    if (!log) return null;
    let transcript = [];
    try {
        transcript = JSON.parse(log.transcript_json);
    } catch (e) {
        transcript = [{ speaker: 'system', text: '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞' }];
    }
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, `–î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞`),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "info-grid" },
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "ID –∑–≤–æ–Ω–∫–∞"), React.createElement("div", { className: "info-value" }, React.createElement("code", null, log.id))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"), React.createElement("div", { className: "info-value" }, log.callerId || "–ù–µ —É–∫–∞–∑–∞–Ω")),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"), React.createElement("div", { className: "info-value" }, formatDate(log.startTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è"), React.createElement("div", { className: "info-value" }, formatDate(log.endTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"), React.createElement("div", { className: "info-value" }, formatDuration(log.startTime, log.endTime))),
                    React.createElement("div", { className: "info-item" }, React.createElement("div", { className: "info-label" }, "–°—Ç–∞—Ç—É—Å"), React.createElement("div", { className: "info-value" }, React.createElement("span", { className: `status ${log.status}` }, log.status)))
                ),
                React.createElement("div", { className: "transcript" },
                    React.createElement("h4", null, "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"),
                    transcript.map((turn, index) =>
                        React.createElement("div", { key: index, className: `turn ${turn.speaker}` }, turn.text)
                    )
                )
            )
        )
    );
};

const KnowledgeBaseModal = ({ content, onClose }) => {
    if (!content) return null;
    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("pre", { style: { whiteSpace: 'pre-wrap', lineHeight: '1.6', background: 'var(--bg-primary)', padding: '1rem', borderRadius: '0.5rem', border: '1px solid var(--border)' } }, content.text || content.error)
            )
        )
    );
};

const PromptsModal = ({ onClose }) => {
    const [prompts, setPrompts] = useState(null);
    const [originalPrompts, setOriginalPrompts] = useState(null);
    const [status, setStatus] = useState("");
    const [activeTab, setActiveTab] = useState('greeting');

    useEffect(() => {
        setStatus("–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤...");
        fetch('/api/prompts')
            .then(res => {
                if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
                return res.json();
            })
            .then(data => {
                setPrompts(data);
                setOriginalPrompts(data);
                setStatus("");
            })
            .catch(() => setStatus("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤"));
    }, []);

    const handleChange = (e) => {
        setPrompts({ ...prompts, [e.target.name]: e.target.value });
    };
    
    const handleReset = () => {
        if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è?")) {
            setPrompts(originalPrompts);
            setStatus("–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã");
             setTimeout(() => setStatus(""), 3000);
        }
    };

    const handleSave = async () => {
        setStatus("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
        try {
            const response = await fetch('/api/prompts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prompts),
            });
            const result = await response.json();
            if (response.ok) {
                setStatus("–ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
                setOriginalPrompts(prompts);
            } else {
                throw new Error(result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
            }
        } catch (err) {
            setStatus(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${err.message}`);
        }
        setTimeout(() => setStatus(""), 5000);
    };

    const renderTabContent = () => {
        if (!prompts) return React.createElement("p", null, "–ó–∞–≥—Ä—É–∑–∫–∞...");

        const tabs = {
            greeting: { title: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", desc: "–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–æ—Ç –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–≤–æ–Ω–∫–∞", name: "greeting", rows: 3 },
            context: { title: "–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤", desc: "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ –æ —Ç–æ–º, –∫–∞–∫ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ—Å–µ–¥—ã", name: "contextualize_q_system_prompt", rows: 8 },
            system: { title: "–û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç", desc: "–ì–ª–∞–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–∏, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞", name: "qa_system_prompt", rows: 12 }
        };

        const currentTabData = tabs[activeTab];

        return React.createElement("div", { className: `tab-content active`},
            React.createElement("div", {className: "prompt-group"},
                React.createElement("div", {className: "prompt-label"}, currentTabData.title),
                React.createElement("div", {className: "prompt-description"}, currentTabData.desc),
                React.createElement("textarea", { 
                    name: currentTabData.name, 
                    className: "prompt-textarea", 
                    value: prompts[currentTabData.name], 
                    onChange: handleChange, 
                    rows: currentTabData.rows
                })
            )
        );
    };

    return React.createElement("div", { className: "modal show", onClick: onClose },
        React.createElement("div", { className: "modal-content", style: { maxWidth: '1000px' }, onClick: e => e.stopPropagation() },
            React.createElement("div", { className: "modal-header" },
                React.createElement("h3", null, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
                React.createElement("button", { className: "close-btn", onClick: onClose }, React.createElement(CloseIcon))
            ),
            React.createElement("div", { className: "modal-body" },
                React.createElement("div", { className: "tabs" },
                    React.createElement("div", { className: `tab ${activeTab === 'greeting' ? 'active' : ''}`, onClick: () => setActiveTab('greeting') }, "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
                    React.createElement("div", { className: `tab ${activeTab === 'context' ? 'active' : ''}`, onClick: () => setActiveTab('context') }, "–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è"),
                    React.createElement("div", { className: `tab ${activeTab === 'system' ? 'active' : ''}`, onClick: () => setActiveTab('system') }, "–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç")
                ),
                renderTabContent()
            ),
            React.createElement("div", { className: "actions" },
                 React.createElement("button", { className: "btn btn-secondary", onClick: handleReset }, "–°–±—Ä–æ—Å–∏—Ç—å"),
                 status && React.createElement("p", { className: "status-message" }, status),
                 React.createElement("button", { className: "btn btn-primary", onClick: handleSave }, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã")
            )
        )
    );
};


const App = () => {
    const [logs, setLogs] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const [query, setQuery] = useState("");
    const [modalLog, setModalLog] = useState(null);
    const [kbContent, setKbContent] = useState(null);
    const [dateFrom, setDateFrom] = useState("");
    const [dateTo, setDateTo] = useState("");
    const [uploadStatus, setUploadStatus] = useState('');
    const [showPromptsModal, setShowPromptsModal] = useState(false);

    const stats = useMemo(() => {
        const total = logs.length;
        const completed = logs.filter(log => log.status === 'Completed').length;
        const failed = logs.filter(log => log.status === 'Failed').length;
        const interrupted = logs.filter(log => log.status === 'Interrupted').length;
        return { total, completed, failed, interrupted };
    }, [logs]);

    const fetchLogs = async (searchQuery, isInitialLoad = false) => {
        if (isInitialLoad) setLoading(true);
        setError(null);
        try {
            const params = new URLSearchParams();
            if (searchQuery) params.append('q', searchQuery);
            if (dateFrom) params.append('date_from', new Date(dateFrom).toISOString());
            if (dateTo) params.append('date_to', new Date(dateTo).toISOString());
            const url = `/logs?${params.toString()}`;
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
            }
            const data = await response.json();
            setLogs(data);
        } catch (err) {
            setError(err.message);
        } finally {
            if (isInitialLoad) setLoading(false);
        }
    };

    const showKnowledgeBase = async () => {
        try {
            const response = await fetch("/kb");
            const data = await response.json();
            setKbContent(data);
        } catch (err) {
            setKbContent({ error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π" });
        }
    };

    const clearAllLogs = async () => {
        if (window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
            setError(null);
            try {
                const response = await fetch("/logs", { method: 'DELETE' });
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
                }
                fetchLogs(query, true);
            } catch (err) {
                setError(err.message);
            }
        }
    };

    const handleKbUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        if (!file.name.endsWith('.txt')) {
            setUploadStatus('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª.');
            return;
        }
        const formData = new FormData();
        formData.append('file', file);
        setUploadStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã...');
        setError(null);
        try {
            const response = await fetch('/kb/upload', {
                method: 'POST',
                body: formData,
            });
            const result = await response.json();
            if (response.ok) {
                setUploadStatus(`–£—Å–ø–µ—à–Ω–æ: ${result.message}`);
            } else {
                throw new Error(result.message || `–û—à–∏–±–∫–∞ ${response.status}`);
            }
        } catch (err) {
            setUploadStatus(`–û—à–∏–±–∫–∞: ${err.message}`);
            setError(err.message);
        }
    };

    useEffect(() => {
        fetchLogs(query, true);
        const intervalId = setInterval(() => {
            if (document.activeElement.tagName !== 'INPUT' && document.activeElement.type !== 'date') {
                fetchLogs(query);
            }
        }, 5000);
        return () => clearInterval(intervalId);
    }, [query, dateFrom, dateTo]);

    return React.createElement("div", { className: "container" },
        React.createElement("div", { className: "header" },
            React.createElement("h1", null, "Admin Panel"),
            React.createElement("div", { style: { color: 'var(--text-secondary)', fontSize: '0.875rem' } },
                "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏ —á–∞—Ç-–±–æ—Ç–∞"
            )
        ),
        React.createElement("div", { className: "stats-grid" },
            React.createElement(StatsCard, { number: stats.total, label: "–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤", color: "var(--primary)" }),
            React.createElement(StatsCard, { number: stats.completed, label: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö", color: "var(--success)" }),
            React.createElement(StatsCard, { number: stats.interrupted, label: "–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö", color: "var(--warning)" }),
            React.createElement(StatsCard, { number: stats.failed, label: "–ù–µ—É–¥–∞—á–Ω—ã—Ö", color: "var(--danger)" })
        ),
        React.createElement("div", { className: "controls" },
            React.createElement("div", { className: "search-container" },
                React.createElement(SearchIcon),
                React.createElement("input", { type: "text", className: "search-input", placeholder: "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –¥–∏–∞–ª–æ–≥—É...", value: query, onChange: (e) => setQuery(e.target.value) })
            ),
            React.createElement("input", { type: "date", className: "search-input", value: dateFrom, onChange: (e) => setDateFrom(e.target.value) }),
            React.createElement("input", { type: "date", className: "search-input", value: dateTo, onChange: (e) => setDateTo(e.target.value) }),
            React.createElement("a", { href: "/logs/csv", className: "btn btn-success", style: { pointerEvents: !logs.length ? "none" : "auto", opacity: !logs.length ? 0.5 : 1 } }, React.createElement(DownloadIcon), "–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ CSV"),
            React.createElement("button", { className: "btn btn-primary", onClick: showKnowledgeBase }, React.createElement(BookIcon), "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"),
            React.createElement("label", { htmlFor: "kb-upload", className: "btn btn-primary" }, "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π", React.createElement("input", { id: "kb-upload", type: "file", accept: ".txt", style: { display: "none" }, onChange: handleKbUpload })),
            React.createElement("button", { className: "btn btn-primary", onClick: () => setShowPromptsModal(true) }, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏"),
            React.createElement("button", { className: "btn btn-danger", onClick: clearAllLogs, disabled: !logs.length }, React.createElement(TrashIcon), "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏")
        ),
        uploadStatus && React.createElement("div", { className: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? "error" : "success-message", style: { marginBottom: '1rem', padding: '1rem', borderRadius: '0.75rem', border: '1px solid', borderColor: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'var(--danger)' : 'var(--success)', background: uploadStatus.startsWith('–û—à–∏–±–∫–∞') ? 'rgb(239 68 68 / 0.1)' : 'rgb(16 185 129 / 0.1)'} }, uploadStatus),
        error && React.createElement("div", { className: "error" }, `‚ö†Ô∏è ${error}`),
        loading ? React.createElement("div", { className: "loading" }, React.createElement("div", { className: "spinner" })) : React.createElement(LogTable, { logs: logs, onRowClick: setModalLog }),
        React.createElement(Modal, { log: modalLog, onClose: () => setModalLog(null) }),
        React.createElement(KnowledgeBaseModal, { content: kbContent, onClose: () => setKbContent(null) }),
        showPromptsModal && React.createElement(PromptsModal, { onClose: () => setShowPromptsModal(false) })
    );
};

createRoot(document.getElementById("root")).render(React.createElement(App));

```

–ì–æ—Ç–æ–≤–æ! –Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `PromptsModal` –≤ `logs-ui/index.js`, —Ç–æ—á–Ω–æ —Å–ª–µ–¥—É—è –≤–∞—à–µ–º—É –¥–∏–∑–∞–π–Ω—É –∏ –¥–æ–±–∞–≤–∏–≤ –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ª–æ–≥–∏–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∫–ª–∞–¥–∫–∞–º–∏.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –º–µ–Ω—è–ª–∏ —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–¥, **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–Ω–æ**.

–ü—Ä–æ—Å—Ç–æ **–æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (`Ctrl+Shift+R`).

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–π, –∫—Ä–∞—Å–∏–≤—ã–π –∏ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ.

---

**User**

—Å–Ω–æ–≤–∞ –≤—ã—à–ª–æ—Ç–Ω–µ –æ—á–µ–Ω—å —Ç–æ
–ø–æ—Å–º–æ—Ç—Ä–∏ –∫–∞–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–ª–∞ –¥—Ä—É–≥–∞—è –Ω–µ–π—Ä–æ–Ω–∫–∞

