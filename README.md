# üìû –ì–æ–ª–æ—Å–æ–≤–æ–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç"

> üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞ 2025-01-27  
> üöÄ **–ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê**: Voximplant ‚Üí Asterisk ARI  
> ‚úÖ **–ó–í–£–ö –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù**: HTTP TTS —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–≤–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ **Asterisk ARI** (–º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å Voximplant)
- –ü–æ–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ—Å –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é **Yandex SpeechKit ASR** (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)
- –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ **AI-–∞–≥–µ–Ω—Ç–∞ —Å LangChain** (–Ω–∞ Python)
- –û—Ç–≤–µ—á–∞–µ—Ç –≤—Å–ª—É—Ö, –∏—Å–ø–æ–ª—å–∑—É—è **Yandex TTS** (gRPC + HTTP fallback)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π barge-in** ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –±–æ—Ç–∞ –ø—Ä–∏ —Ä–µ—á–∏ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üñ•Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π, –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–æ –∞–¥—Ä–µ—Å—É `/logs-ui/`.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∑–≤–æ–Ω–∫–æ–≤:** –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –æ–±—â–µ–Ω–∏—è —Å –±–æ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã —Å **—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π** –ø–æ –¥–∞—Ç–µ –∏ —Å—Ç–∞—Ç—É—Å—É.
- **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞:** –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ª—é–±–æ–π –∑–≤–æ–Ω–æ–∫ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –¥–∏–∞–ª–æ–≥–∞.
- **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
    - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ª–æ–≥–∞–º.
    - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É (`Completed`, `Failed` –∏ —Ç.–¥.) —Å –ø–æ–º–æ—â—å—é —É–¥–æ–±–Ω—ã—Ö —á–∏–ø–æ–≤.
    - –ì–∏–±–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Å –±—ã—Å—Ç—Ä—ã–º–∏ –ø—Ä–µ—Å–µ—Ç–∞–º–∏ ("–°–µ–≥–æ–¥–Ω—è", "–í—á–µ—Ä–∞" –∏ —Ç.–¥.).
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** Toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–æ–º–ø—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã").
- **–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV:** –í—Å–µ –ª–æ–≥–∏ –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –≤ `CSV` —Ñ–∞–π–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
- **–î–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–∏:**
  - –ü—Ä–æ—Å–º–æ—Ç—Ä `.md` —Ñ–∞–π–ª–æ–≤: –∫–Ω–æ–ø–∫–∏ ¬´–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (general)¬ª –∏ ¬´–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (tech)¬ª.
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ¬´–û–±–Ω–æ–≤–∏—Ç—å –ë–ó (general)¬ª –∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å –ë–ó (tech)¬ª. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ **–∑–∞–≥–æ–ª–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è**, —Å–æ–∑–¥–∞—ë—Ç—Å—è –±—ç–∫–∞–ø –∏ —Ñ–æ–Ω–æ–º –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
  - –í —Ç–∞–±–ª–∏—Ü–µ –ª–æ–≥–æ–≤ —É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ—Ç–≤–µ—Ç–∞: `[general]` –∏–ª–∏ `[tech]`. –í –º–æ–¥–∞–ª–∫–µ –¥–∏–∞–ª–æ–≥–∞ –º–µ—Ç–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —É –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏ –±–æ—Ç–∞.
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏:**
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–∏–∑–∞—Ç–æ—Ä) –ø—Ä—è–º–æ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
  - –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è "–Ω–∞ –ª–µ—Ç—É" –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞:** –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞¬ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å `KB_TOP_K` (—Å–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑–≤–ª–µ–∫–∞–µ–º) –∏ `KB_FALLBACK_THRESHOLD` (–ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è fallback –Ω–∞ –≤—Ç–æ—Ä—É—é –ë–ó) –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `.env`.
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –ö–Ω–æ–ø–∫–∞ ¬´–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ¬ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `logs-ui/instruction.md`.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –î–æ—Å—Ç—É–ø –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (—É–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –ë–ó) –∑–∞—â–∏—â–µ–Ω **API-–∫–ª—é—á–æ–º**, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ.

---

## üéâ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: YANDEX ASR –£–°–ü–ï–®–ù–û –†–ê–ë–û–¢–ê–ï–¢ (2025-01-17)

### üîç –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2025-01-17):
- **–ü—Ä–æ–±–ª–µ–º–∞**: ASR –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª OpenAI Whisper –≤–º–µ—Å—Ç–æ Yandex, –≤–æ–∑–≤—Ä–∞—â–∞–ª —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
- **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ASR —Å–µ—Ä–≤–∏—Å–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Yandex SpeechKit ASR —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ ASR –†–ê–ë–û–¢–ê–ï–¢ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ä—É—Å—Å–∫—É—é —Ä–µ—á—å

### ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:
- **ASR —Å–µ—Ä–≤–∏—Å**: `yandex_asr_service.py` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º IAM —Ç–æ–∫–µ–Ω–æ–≤
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: IAM —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ ASR –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ**: `'–£ –≤–∞—Å –µ—Å—Ç—å —Ç—Ä–µ—Å—ã –∏—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–µ'` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
- **‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑**: –£–±—Ä–∞–Ω—ã "–†–µ–¥–∞–∫—Ç–æ—Ä —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –ê.–°–µ–º–∫–∏–Ω"
- **‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞**: 24/7 –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **‚úÖ –ü–æ–ª–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ Yandex**: ASR + TTS —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–¥–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

---

## üéâ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù –ó–í–£–ö –ë–û–¢–ê (2025-01-27)

### üîç –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2025-01-27):
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Ç–µ—Ä—è –∑–≤—É–∫–∞ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ gRPC TTS
- **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ "–û–î–ù–û –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–ê –†–ê–ó" –ø—Ä–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- **–†–µ—à–µ–Ω–∏–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ HTTP TTS –∏–∑ –±–µ–∫–∞–ø–∞ `ETAP1_COMPLETE`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–í–£–ö –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù - HTTP TTS —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

### üîç –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2025-09-06):
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ë–æ—Ç –Ω–µ –±—ã–ª —Å–ª—ã—à–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (PlaybackStarted –∏ PlaybackFinished –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –∑–≤—É–∫–∞–º –∏ –º–µ—Ç–æ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞—É–¥–∏–æ
- **–†–µ—à–µ–Ω–∏–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞—Ä—Ö–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### ‚úÖ –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **–ü—É—Ç—å –∫ –∑–≤—É–∫–∞–º**: `/var/lib/asterisk/sounds` ‚Üí `/usr/share/asterisk/sounds/ru`
2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: Pydub ‚Üí sox (raw LPCM ‚Üí WAV 8kHz mono)
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è 0-4ms ‚Üí 4.4 —Å–µ–∫—É–Ω–¥—ã (–ù–û–†–ú–ê–õ–¨–ù–û!)

### üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (2025-01-27):
- **–°–ª—ã—à–∏–º–æ—Å—Ç—å –±–æ—Ç–∞**: ‚úÖ –î–∞ (HTTP TTS)
- **–í—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è**: 4.4 —Å–µ–∫—É–Ω–¥—ã (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ - –≥–æ—Ç–æ–≤ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–æ–µ–∫—Ç**: ‚úÖ –û—á–∏—â–µ–Ω –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –±—ç–∫–∞–ø–æ–≤
- **Git**: ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã

### üìä –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∞—Ç—É—Å (2025-09-06):
- **–°–ª—ã—à–∏–º–æ—Å—Ç—å –±–æ—Ç–∞**: ‚ùå –ù–µ—Ç ‚Üí ‚úÖ –î–∞
- **–í—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è**: 0-4ms ‚Üí 4.4 —Å–µ–∫—É–Ω–¥—ã
- **–°—Ç–∞—Ç—É—Å**: üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

---

## üéØ –ü–õ–ê–ù–´ –î–ê–õ–¨–ù–ï–ô–®–ï–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò (2025-01-27)

### üìã –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã:
1. **–≠—Ç–∞–ø 2.2**: –ê–∫—Ç–∏–≤–∞—Ü–∏—è gRPC TTS (—Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–∞–≤–∏–ª—É "–û–î–ù–û –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–ê –†–ê–ó")
2. **–≠—Ç–∞–ø 2.3**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ TTS
3. **–≠—Ç–∞–ø 3**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è AI –æ—Ç–≤–µ—Ç–æ–≤
4. **–¶–µ–ª—å**: –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç ASR –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∑–≤—É–∫–∞ **1.1 —Å–µ–∫—É–Ω–¥—ã**

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
- **–û–î–ù–û –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–ê –†–ê–ó** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ó–í–£–ö–ê** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- **–°–û–ó–î–ê–ù–ò–ï –ë–≠–ö–ê–ü–û–í** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –≤–µ—Ä—Å–∏–π
- **–ü–û–≠–¢–ê–ü–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò (2025-09-05)

### ‚ö° –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **AI Streaming**: 8.7—Å ‚Üí **2.4—Å** (3.6x –±—ã—Å—Ç—Ä–µ–µ!)
- **gRPC TTS**: 0.5—Å ‚Üí **0.16—Å** (3x –±—ã—Å—Ç—Ä–µ–µ!)
- **–û–±—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: **3.4x —É–ª—É—á—à–µ–Ω–∏–µ**

### üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

#### 1. **–£–ø—Ä–æ—â–µ–Ω–∏–µ RAG Pipeline**
- ‚ùå –£–±—Ä–∞–ª–∏ `create_history_aware_retriever` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π LLM –∑–∞–ø—Ä–æ—Å)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—ã–µ retriever'—ã –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å

#### 2. **Redis –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Embeddings**
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ `CachedOpenAIEmbeddings` —Å Redis
- ‚úÖ –ö–µ—à –Ω–∞ 7 –¥–Ω–µ–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è**: 80%+ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ embedding'–∏

#### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è OpenAI Timeouts**
- ‚úÖ `request_timeout=15` (–±—ã–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60—Å+)
- ‚úÖ `max_retries=1` (–±—ã–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- **–≠–∫–æ–Ω–æ–º–∏—è**: –ë—ã—Å—Ç—Ä—ã–π failover –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é

#### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ gRPC TTS**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –∏–º–ø–æ—Ä—Ç—ã proto —Ñ–∞–π–ª–æ–≤
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ `x-folder-id` –≤ metadata
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ enum –∑–Ω–∞—á–µ–Ω–∏—è (`ContainerAudioType.WAV`)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∑–∞ 0.16—Å

#### 5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ChromaDB**
- ‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ —Å `langchain-community` –Ω–∞ `langchain-chroma 0.2.5`
- ‚úÖ –£–±—Ä–∞–ª–∏ deprecated warnings

### üìä –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```
–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫ AI: 7.98—Å
- –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç AI: 9.23—Å  
- gRPC TTS: –ø–∞–¥–∞–ª –Ω–∞ HTTP (0.5—Å)

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫ AI: 1.28—Å ‚ö°
- –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç AI: 2.74—Å ‚ö°
- gRPC TTS: 0.16—Å ‚ö°
```

### üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **–º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ OpenAI API**:
- SSL handshake: 0.73—Å
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ timeout'–æ–≤
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ LLM –∑–∞–ø—Ä–æ—Å—ã –≤ RAG pipeline

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–í–£–ö–ê

### üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ **–ù–ï –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö** (Redis, gRPC), –∞ –≤ –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
1. **–ü—É—Ç–∏ –∫ –∑–≤—É–∫–æ–≤—ã–º —Ñ–∞–π–ª–∞–º** - Asterisk –∏—Å–∫–∞–ª —Ñ–∞–π–ª—ã –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. **–ú–µ—Ç–æ–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞—É–¥–∏–æ** - Pydub —Å–æ–∑–¥–∞–≤–∞–ª –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å Asterisk —Ñ–∞–π–ª—ã

### üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

#### 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –∑–≤—É–∫–∞–º:
```python
# –ë—ã–ª–æ:
self.asterisk_sounds_dir = "/var/lib/asterisk/sounds"

# –°—Ç–∞–ª–æ:
self.asterisk_sounds_dir = "/usr/share/asterisk/sounds/ru"
```

#### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ sox –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:
```python
# –ë—ã–ª–æ (Pydub):
from pydub import AudioSegment
audio_segment = AudioSegment.from_file(raw_path, format="raw", ...)
audio_segment.export(wav_path, format="wav")

# –°—Ç–∞–ª–æ (sox):
sox_cmd = [
    "sox", "-t", "raw", "-r", "8000", "-e", "signed-integer", "-b", "16", "-c", "1",
    raw_path, "-t", "wav", wav_path
]
subprocess.run(sox_cmd, check=True, capture_output=True)
```

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```bash
mkdir -p /usr/share/asterisk/sounds/ru
chown asterisk:asterisk /usr/share/asterisk/sounds/ru
chmod 755 /usr/share/asterisk/sounds/ru
```

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **–í—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è**: 0-4ms ‚Üí 4.4 —Å–µ–∫—É–Ω–¥—ã (–ù–û–†–ú–ê–õ–¨–ù–û!)
- **–°–ª—ã—à–∏–º–æ—Å—Ç—å –±–æ—Ç–∞**: ‚ùå –ù–µ—Ç ‚Üí ‚úÖ –î–∞
- **–°—Ç–∞—Ç—É—Å**: üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `app/backend/asterisk/stasis_handler.py` | **–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** Asterisk ARI WebSocket |
| `app/backend/asterisk/ari_client.py` | –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Asterisk ARI API |
| `app/backend/rag/agent.py` | LangChain-–∞–≥–µ–Ω—Ç: RAG, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è general/tech |
| `app/backend/services/yandex_tts_service.py` | Yandex TTS (gRPC + HTTP fallback) |
| `app/backend/services/asr_service.py` | ‚úÖ Yandex SpeechKit ASR (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤) |
| `scripts/create_embeddings.py` | –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –≤–µ–∫—Ç–æ—Ä–æ–≤ |
| `app/frontend/logs-ui/` | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è |
| `.env` | –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (API –∫–ª—é—á–∏, –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º) |

### üîÑ **–£–°–¢–ê–†–ï–í–®–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏):**
- ‚ùå `app/backend/main.py` - —Å—Ç–∞—Ä—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è Voximplant
- ‚ùå `app/voximplant/scenario_barge-in_2.js` - Voximplant —Å—Ü–µ–Ω–∞—Ä–∏–π


---

## üîÅ –°—Ü–µ–Ω–∞—Ä–∏–π –∑–≤–æ–Ω–∫–∞ (Asterisk ARI)

1. **–ö–ª–∏–µ–Ω—Ç –∑–≤–æ–Ω–∏—Ç** ‚Üí –∑–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è Asterisk –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Stasis –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `asterisk-bot`
2. **Asterisk ARI** –∑–∞–ø—É—Å–∫–∞–µ—Ç `stasis_handler.py` —á–µ—Ä–µ–∑ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. `stasis_handler.py` —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –∑–≤–æ–Ω–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç AI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ**: TTS –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–ó–∞–ø–∏—Å—å —Ä–µ—á–∏**: Asterisk –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. **ASR**: Yandex SpeechKit —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ä–µ—á—å –≤ —Ç–µ–∫—Å—Ç (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)
7. **AI –æ–±—Ä–∞–±–æ—Ç–∫–∞**: 
   - –ê–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **RAG** –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
   - **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –û—Ç–≤–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `gpt-4o-mini` —Å streaming
8. **TTS**: Yandex TTS —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å (gRPC —Å HTTP fallback)
9. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ**: Asterisk –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ ARI
10. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SQLite –±–∞–∑—É

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **Asterisk** —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º ARI
- **Redis** —Å–µ—Ä–≤–µ—Ä
- **Python 3.12+** —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
- **API –∫–ª—é—á–∏**: OpenAI, Yandex Cloud

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞:
```bash
# 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd /root/Asterisk_bot/asterisk-vox-bot
source venv/bin/activate

# 2. –ó–∞–ø—É—Å–∫ AI –±–æ—Ç–∞ (systemd)
sudo systemctl start metrotech-bot

# 3. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∑–≤–æ–Ω–∫–æ–≤
python app/backend/asterisk/stasis_handler.py

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status metrotech-bot
ps aux | grep stasis_handler
```

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**: http://localhost:9000/logs-ui/
- **API**: http://localhost:9000/

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
sudo apt-get install redis-server

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install langchain-chroma  # –≤–º–µ—Å—Ç–æ langchain-community

# 3. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å proto —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python -m grpc_tools.protoc --python_out=. *.proto
```

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´:**
1. **gRPC TTS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**: 
   - **–û—à–∏–±–∫–∞**: `You have to specify folder ID for user account`
   - **–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π Yandex Cloud
   - **Fallback**: HTTP TTS (–ø–æ—Ç–µ—Ä—è 0.4—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å)
   - **–°—Ç–∞—Ç—É—Å**: gRPC –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –Ω—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

2. **–£—Å—Ç–∞—Ä–µ–≤—à–∞—è ChromaDB**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è deprecated `langchain-community.vectorstores.Chroma`
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ `langchain-chroma`
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –æ deprecation

### ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:**
- ‚úÖ **üéâ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∑–≤—É–∫ –±–æ—Ç–∞** - –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è Voximplant ‚Üí Asterisk ARI** - –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ARI WebSocket
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_max_relevance()`** - —ç–∫–æ–Ω–æ–º–∏—è 6.4+ —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö embedding –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **gRPC –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - `UtteranceSynthesisRequest` –≤ `tts_pb2`
- ‚úÖ **AI Streaming –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω** - 8.7—Å ‚Üí 2.4—Å (3.6x –±—ã—Å—Ç—Ä–µ–µ!)
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ Asterisk

### üìä **–¢–ï–ö–£–©–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:**
- **ASR (Yandex)**: 2.5—Å ‚úÖ (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)
- **AI Streaming**: 2.74—Å ‚úÖ (–±—ã–ª–æ: 8.7—Å)
- **TTS (HTTP)**: 0.7—Å ‚úÖ
- **TTS (gRPC)**: 0.16—Å ‚úÖ (–±—ã–ª–æ: fallback –Ω–∞ HTTP)

### üéØ **–ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:**

#### **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—ç–∫–æ–Ω–æ–º–∏—è 7 —Å–µ–∫):**
- ‚úÖ **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ OpenAI API
- üîÑ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RAG pipeline** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö LLM –∑–∞–ø—Ä–æ—Å–æ–≤

#### **–í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—ç–∫–æ–Ω–æ–º–∏—è 2.4 —Å–µ–∫):**
- üîÑ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ gRPC TTS** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏
- üîÑ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏** - —É–ø—Ä–æ—â–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### **–°—Ä–µ–¥–Ω–µ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (—ç–∫–æ–Ω–æ–º–∏—è 0.7 —Å–µ–∫):**
- üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ChromaDB** –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üéâ **–ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò (2025-09-05):**
**–û–±—â–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–æ —Å 9.5—Å –¥–æ 2.9—Å (3.4x —É–ª—É—á—à–µ–Ω–∏–µ!)**

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!** ‚úÖ

### üéØ **–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:**
- **–û–±—â–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: —Å 9.5 —Å–µ–∫ –¥–æ 2-3 —Å–µ–∫ (3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- **AI Streaming**: —Å 9.5 —Å–µ–∫ –¥–æ 2 —Å–µ–∫
- **TTS**: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ gRPC (0.1 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 0.5 —Å–µ–∫)
- **–ö–µ—à-–ø–æ–ø–∞–¥–∞–Ω–∏—è**: 80%+ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üéôÔ∏è Asterisk: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ –∏ barge-in

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Asterisk ARI** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ barge-in:

- **–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è**: AI –∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–º `|` –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞—É–∑
- **Streaming TTS**: Yandex TTS —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å –ø–æ —á–∞—Å—Ç—è–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
- **Barge-in**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –±–æ—Ç–∞ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- **–ó–∞–ø–∏—Å—å —Ä–µ—á–∏**: Asterisk –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è ASR –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **stasis_handler.py**: –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ARI WebSocket —Å–æ–±—ã—Ç–∏–π
- **ari_client.py**: –ö–ª–∏–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞–º–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
- **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—Ä–µ–º—è ASR, AI, TTS –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üß≠ –î–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (general/tech)

- –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–±—â–µ–µ (–æ–¥–Ω–∞ Chroma), –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ `kb=general` –∏ `kb=tech`.
- –ê–≥–µ–Ω—Ç —Å—Ç—Ä–æ–∏—Ç –¥–≤–∞ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (—Ä–æ—É—Ç–∏–Ω–≥).
- –ï—Å–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∏–∂–µ `KB_FALLBACK_THRESHOLD`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫–æ –≤—Ç–æ—Ä–æ–π –ë–ó; –±–µ—Ä—ë—Ç—Å—è –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ: `KB_TOP_K`, `KB_FALLBACK_THRESHOLD`.
- –í –ª–æ–≥–∞—Ö –∏ –≤ UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–≤–µ—Ç–∞: `[general]` –∏–ª–∏ `[tech]`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è)

```bash
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asterisk/            # üéØ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ ASTERISK
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stasis_handler_optimized.py  # üöÄ –ì–õ–ê–í–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö ARI WebSocket
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ari_client.py    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Asterisk ARI API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stasis_handler.py  # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (backup)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ agent.py         # AI-–∞–≥–µ–Ω—Ç (LangChain + RAG + Chroma)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/            # üîß –°–ï–†–í–ò–°–´ –û–ë–†–ê–ë–û–¢–ö–ò
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asr_service.py   # ‚úÖ Yandex SpeechKit ASR (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yandex_asr_service.py  # ASR —Å–µ—Ä–≤–∏—Å —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º IAM —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yandex_tts_service.py  # Yandex TTS (HTTP + gRPC fallback)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yandex_grpc_tts.py     # gRPC TTS —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tts_adapter.py   # –ê–¥–∞–ø—Ç–µ—Ä TTS —Å fallback –ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parallel_tts.py  # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ TTS —á–∞–Ω–∫–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filler_tts.py    # Instant filler TTS –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ log_storage.py   # –•—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ text_normalizer.py  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py              # FastAPI —Å–µ—Ä–≤–µ—Ä (HTTP/WS, —Å—Ç–∞—Ç–∏–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ frontend/logs-ui/        # üåê –í–ï–ë-–ê–î–ú–ò–ù–ö–ê
‚îÇ       ‚îú‚îÄ‚îÄ index.html           # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ       ‚îú‚îÄ‚îÄ script.js            # JavaScript –ª–æ–≥–∏–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ style.css            # –°—Ç–∏–ª–∏
‚îÇ       ‚îî‚îÄ‚îÄ instruction.md       # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ create_embeddings.py     # –°–æ–∑–¥–∞–Ω–∏–µ/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –≤–µ–∫—Ç–æ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test_agent.py            # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ prompts.json             # –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ kb/                          # üìö –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô
‚îÇ   ‚îú‚îÄ‚îÄ general.md               # –û–±—â–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ tech.md                  # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ data/                        # üíæ –î–ê–ù–ù–´–ï
‚îÇ   ‚îú‚îÄ‚îÄ chroma/                  # –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Chroma
‚îÇ   ‚îú‚îÄ‚îÄ db/log_db.sqlite         # SQLite –ª–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ logs/app.log             # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ memory-bank/                 # üß† MEMORY BANK (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ tasks.md                 # –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ activeContext.md         # –ê–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ progress.md              # –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ projectbrief.md          # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ productContext.md        # –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ systemPatterns.md        # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ techContext.md           # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ style-guide.md           # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å—Ç–∏–ª—é
‚îÇ   ‚îú‚îÄ‚îÄ creative/                # –î–æ–∫—É–º–µ–Ω—Ç—ã —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Ñ–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ reflection/              # –†–µ—Ñ–ª–µ–∫—Å–∏–∏ –ø–æ –∑–∞–¥–∞—á–∞–º
‚îÇ   ‚îî‚îÄ‚îÄ archive/                 # –ê—Ä—Ö–∏–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ .env                         # üîë –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
‚îú‚îÄ‚îÄ requirements.txt             # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ –¢–µ–∫—É—â–µ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ_–ø—Ä–æ–µ–∫—Ç–∞.md # üìä –û—Ç—á–µ—Ç –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
```

### üéØ **–ö–õ–Æ–ß–ï–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:**

**üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `stasis_handler_optimized.py` - **–ì–õ–ê–í–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö** ARI WebSocket
- `yandex_asr_service.py` - **ASR —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤**
- `yandex_tts_service.py` - **TTS —Å gRPC + HTTP fallback**
- `agent.py` - **AI –∞–≥–µ–Ω—Ç —Å RAG**

**üîß –°–µ—Ä–≤–∏—Å—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- `parallel_tts.py` - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ TTS
- `filler_tts.py` - Instant filler –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
- `tts_adapter.py` - –ê–¥–∞–ø—Ç–µ—Ä —Å fallback –ª–æ–≥–∏–∫–æ–π

**üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `memory-bank/` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `–¢–µ–∫—É—â–µ–µ_—Å–æ—Å—Ç–æ—è–Ω–∏–µ_–ø—Ä–æ–µ–∫—Ç–∞.md` - –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
1.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.**
2.  **–°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
    ```env
    OPENAI_API_KEY="sk-..."
    API_SECRET_KEY="–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á_–¥–ª—è_–¥–æ—Å—Ç—É–ø–∞_–∫_api"
    PROMPTS_FILE_PATH="config/prompts.json"
    KNOWLEDGE_BASE_PATH="kb/general.md"
    KNOWLEDGE_BASE2_PATH="kb/tech.md"
    PERSIST_DIRECTORY="data/chroma"
    DB_PATH="data/db/log_db.sqlite"
    KB_TOP_K="3"
    KB_FALLBACK_THRESHOLD="0.2"
    ```
5.  **–ù–∞–ø–æ–ª–Ω–∏—Ç–µ `knowledge_base.md`** –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
–¢–µ–ø–µ—Ä—å —Å–∫—Ä–∏–ø—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –û–î–ù–£ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é Chroma —Å –¥–≤—É–º—è –Ω–∞–±–æ—Ä–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
- `kb=general` –∏–∑ `knowledge_base.md`
- `kb=tech` –∏–∑ `knowledge_base_2.md`

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª—é–±–æ–π –∏–∑ –ë–ó —Å–æ–∑–¥–∞–π—Ç–µ –≤–µ–∫—Ç–æ—Ä—ã:
```bash
python3 scripts/create_embeddings.py
```

### –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–ó (RAG)

1) –û–±–æ–≥–∞—â–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

- –ü–µ—Ä–µ–¥ —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ —Å–∫—Ä–∏–ø—Ç –¥—É–±–ª–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π Markdown‚Äë–∑–∞–≥–æ–ª–æ–≤–æ–∫ (h1‚Äìh6): —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ `# –†–∞–∑–¥–µ–ª` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ `#` ‚Äî `–†–∞–∑–¥–µ–ª`. –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ –∏ —É–ª—É—á—à–∞–µ—Ç –ø–æ–∏—Å–∫.

2) –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏

- –¢–µ–∫—Å—Ç –¥–µ–ª–∏—Ç—Å—è –ø–æ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é ¬´<<->>¬ª.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `chunk_size=4000`, `chunk_overlap=200`, `add_start_index=True`.
- –ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –º–∞–ª–æ ¬´<<->>¬ª, —á–∞–Ω–∫–æ–≤ –±—É–¥–µ—Ç –º–∞–ª–æ –∏ –æ–Ω–∏ –±—É–¥—É—Ç –∫—Ä—É–ø–Ω—ã–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ç–∞–≤–∏—Ç—å ¬´<<->>¬ª –º–µ–∂–¥—É –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏.

3) –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `OpenAIEmbeddings` (–∫–ª—é—á –±–µ—Ä—ë—Ç—Å—è –∏–∑ `OPENAI_API_KEY`).
- –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ‚Äî `Chroma` —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ `PERSIST_DIRECTORY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `chroma_db_metrotech/`).
- –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –±–∞–∑—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ.
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ: –Ω–æ–≤–∞—è –ë–î —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `chroma_db_metrotech_tmp` –∏ –∑–∞—Ç–µ–º –∑–∞–º–µ–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é; —Å—Ç–∞—Ä—ã–π –∫–∞—Ç–∞–ª–æ–≥ —É–¥–∞–ª—è–µ—Ç—Å—è. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Ñ–∞–π–ª—ã –ë–ó –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–∑ –∞–¥–º–∏–Ω–∫–∏; —Å–µ—Ä–≤–µ—Ä —Å–∞–º –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–¥–µ–ª–∞–µ—Ç –±—ç–∫–∞–ø –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ —Ñ–æ–Ω–µ.

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ü–æ—Å–ª–µ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `knowledge_base.md` –∏–ª–∏ `prompts.json` –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–≤–µ—Ç–æ–≤:
```bash
python3 test_agent.py
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞):
```bash
uvicorn app.backend.main:app --host 0.0.0.0 --port 9000 --reload
```

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Ä–µ–∂–∏–º–∞:
```bash
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:9000 app.backend.main:app &
```

---

## ‚ÑπÔ∏è –ü–æ–ª–µ–∑–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `.env`:
  - `OPENAI_API_KEY` ‚Äî –∫–ª—é—á OpenAI.
  - `API_SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –∞–¥–º–∏–Ω–∫–µ (–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-API-Key`).
  - `PROMPTS_FILE_PATH` ‚Äî –ø—É—Ç—å –∫ `prompts.json`.
  - `KNOWLEDGE_BASE_PATH` ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ë–ó (`knowledge_base.md` –∏–ª–∏ –¥—Ä.).
  - `PERSIST_DIRECTORY` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Chroma (–Ω–∞–ø—Ä–∏–º–µ—Ä, `chroma_db_metrotech`).

- –≠–Ω–¥–ø–æ–π–Ω—Ç—ã:
  - `GET /` ‚Äî –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞.
  - `GET /logs` ‚Äî –ª–æ–≥–∏ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `q`, `date_from`, `date_to`, `status`).
  - `GET /logs/csv` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç CSV.
  - `DELETE /logs` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `GET /kb` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ë–ó.
  - `POST /kb/upload` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –ë–ó; —Å–µ—Ä–≤–µ—Ä —Å–∞–º –¥—É–±–ª–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, –¥–µ–ª–∞–µ—Ç –±—ç–∫–∞–ø –∏ –≤ —Ñ–æ–Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `GET /kb2` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ë–ó.
  - `POST /kb2/upload` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ë–ó (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `GET /api/prompts` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã.
  - `POST /api/prompts` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ ¬´–≥–æ—Ä—è—á–æ¬ª –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `GET /api/settings` ‚Äî —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è `KB_TOP_K`, `KB_FALLBACK_THRESHOLD`, –∞ —Ç–∞–∫–∂–µ `llm_model_primary`, `llm_model_fallback`, `llm_temperature`.
  - `POST /api/settings` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `POST /api/model-settings` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM (–Ω—É–∂–µ–Ω `X-API-Key`).
  - `POST /api/normalize` ‚Äî —Ç–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ (—Å–º. —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ).
  - `WS /ws?callerId=...` ‚Äî —Å—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ –∞–≥–µ–Ω—Ç–∞ (–Ω–∞—Ä—É–∂—É –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –ø–æ—Ç–æ–∫ –ø–æ WebSocket).

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏ (LLM)

- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  - `LLM_MODEL_PRIMARY` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gpt-4o-mini`).
  - `LLM_MODEL_FALLBACK` ‚Äî –∑–∞–ø–∞—Å–Ω–∞—è –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
  - `LLM_TEMPERATURE` ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (0..1, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.2).
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ UI: –≤ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞¬ª –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π/–∑–∞–ø–∞—Å–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç `.env` –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ ¬´–Ω–∞ –ª–µ—Ç—É¬ª.

### –°—Ç—Ä–∏–º –º–æ–¥–µ–ª–∏ –∏ —Ñ–æ–ª–±—ç–∫

- –°–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞—Ä—É–∂—É –ø–æ—Ç–æ–∫–æ–º –ø–æ WebSocket.
- –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ LLM –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—Ä–µ—â—ë–Ω —Ä–µ–∂–∏–º stream. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç —Ü–µ–ª–∏–∫–æ–º) –∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–¥–∞—ë—Ç –µ–≥–æ –Ω–∞—Ä—É–∂—É –ø–æ—Ç–æ–∫–æ–º (–ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–∏–º–≤–æ–ª–∞–º `|`, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –ø–æ –ø—Ä–æ–º–ø—Ç—É).
- –ö–æ–≥–¥–∞ stream —É –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∏–º.

- –î–∞–Ω–Ω—ã–µ:
  - SQLite –ª–æ–≥–∏: `data/db/log_db.sqlite`.
  - –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞: `data/chroma/`.

- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–ó:
  - –ß–µ—Ä–µ–∑ UI: –∫–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å –ë–ó¬ª –≤ `/logs-ui/` ‚Üí –≤—ã–±—Ä–∞—Ç—å `.md` ‚Üí –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±—É–¥—É—Ç –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω—ã ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–¥—É—Ç—Å—è ‚Üí –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.
  - –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª ‚Üí `python3 create_embeddings.py`.

- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É RAG:
  - –°—Ç–∞–≤—å—Ç–µ ¬´<<->>¬ª –º–µ–∂–¥—É –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏.
  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ Markdown‚Äë–∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø–æ–ø–∞–¥—É—Ç –≤ —á–∞–Ω–∫.

## üî§ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—á–∏ –∏ –µ–¥–∏–Ω–∏—Ü (ASR + –±—ç–∫–µ–Ω–¥)

- –ß—Ç–æ–±—ã –±–æ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø–æ–Ω–∏–º–∞–ª –ø—Ä–æ–∏–∑–Ω–µ—Å—ë–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (¬´–∫–∞-—ç–Ω¬ª, ¬´–∫–Ω¬ª, ¬´–∫–∏–ª–æ–Ω—å—é—Ç–æ–Ω¬ª, ¬´–º—ç‚Äë–ø—ç‚Äë–∞¬ª, ¬´–≥–µ—Ä—Ü/–≥—Ü¬ª, ¬´–º–∏–ª–ª–∏–º–µ—Ç—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É¬ª –∏ —Ç.–¥.), –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ —Å–ª–æ—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
  - –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ Voximplant (`scenario_barge-in_2.js`): –ø–æ–¥—Å–∫–∞–∑–∫–∏ `phraseHints` –∏ —Ñ—É–Ω–∫—Ü–∏—è `normalizeUtterance(...)` –ø—Ä–∏–≤–æ–¥—è—Ç —Ä–µ—á—å –∫ –∫–∞–Ω–æ–Ω—É –µ—â—ë –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
  - –ù–∞ –±—ç–∫–µ–Ω–¥–µ (`text_normalizer.py`): —Ñ—É–Ω–∫—Ü–∏—è `normalize(text)` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ –∂–µ –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –∞–≥–µ–Ω—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤, –∞ —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ `POST /api/normalize`.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -sS -X POST http://<HOST>:9000/api/normalize \
  -H 'Content-Type: application/json' \
  -d '{"text":"–ï—Å—Ç—å –†–≠–ú –Ω–∞ —Ç—ã—Å—è—á—É –∫–∏–ª–æ–Ω—å—é—Ç–æ–Ω, —Å–∫–æ—Ä–æ—Å—Ç—å 5 –º–∏–ª–ª–∏–º–µ—Ç—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ 220 –≤–æ–ª—å—Ç"}'
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{ "raw": "–ï—Å—Ç—å –†–≠–ú –Ω–∞ —Ç—ã—Å—è—á—É –∫–∏–ª–æ–Ω—å—é—Ç–æ–Ω, —Å–∫–æ—Ä–æ—Å—Ç—å 5 –º–∏–ª–ª–∏–º–µ—Ç—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ 220 –≤–æ–ª—å—Ç",
  "normalized": "–ï—Å—Ç—å –†–≠–ú –Ω–∞ —Ç—ã—Å—è—á—É –∫–ù, —Å–∫–æ—Ä–æ—Å—Ç—å 5 –º–º/—Å –ø—Ä–∏ 220 –í" }
```

---

## üí° –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫

- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤–æ–Ω–∫–∞).
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ë–ó:** –ù–∞—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å `.pdf` –∏ `.docx` —Ñ–∞–π–ª–∞–º–∏.
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ CRM:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—â–µ–Ω–∏—è.
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è:** –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –∏ –∑–Ω–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–∞.

---

## üì° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

–ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:

```bash
curl -sS "http://<HOST>:9000/logs?q=7961&date_from=2025-08-01T00:00:00Z&date_to=2025-08-31T23:59:59Z"
```

–≠–∫—Å–ø–æ—Ä—Ç CSV:

```bash
curl -L "http://<HOST>:9000/logs/csv" -o call_logs.csv
```

–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏ (–∑–∞—â–∏—â–µ–Ω–æ API‚Äë–∫–ª—é—á–æ–º):

```bash
curl -X DELETE "http://<HOST>:9000/logs" -H "X-API-Key: $API_SECRET_KEY"
```

–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–º–ø—Ç—ã:

```bash
curl -sS "http://<HOST>:9000/api/prompts"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≥–µ–Ω—Ç–∞:

```bash
curl -X POST "http://<HOST>:9000/api/prompts" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: $API_SECRET_KEY" \
  -d @prompts.json
```

–ü–æ–ª—É—á–∏—Ç—å –ë–ó / –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é –ë–ó:

```bash
curl -sS "http://<HOST>:9000/kb"

curl -X POST "http://<HOST>:9000/kb/upload" \
  -H "X-API-Key: $API_SECRET_KEY" \
  -F file=@knowledge_base.md
```

## üóÑÔ∏è –°—Ö–µ–º–∞ –ë–î –ª–æ–≥–æ–≤

SQLite —Ñ–∞–π–ª: `data/log_db.sqlite`.

```sql
CREATE TABLE IF NOT EXISTS logs (
  id TEXT PRIMARY KEY,
  callerId TEXT,
  startTime TEXT,
  endTime   TEXT,
  status    TEXT,
  transcript_json TEXT
);
```

–ó–∞–º–µ—á–∞–Ω–∏—è:
- `transcript_json` ‚Äî JSON‚Äë–º–∞—Å—Å–∏–≤ —Ä–µ–ø–ª–∏–∫; –≤ UI –ø–∞—Ä—Å–∏—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥.
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `startTime` –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ –∫–æ–¥–µ.

## üß™ –ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket

–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏:

```javascript
const ws = new WebSocket("ws://<HOST>:9000/ws?callerId=TEST");
ws.onmessage = (e) => console.log("BOT:", e.data);
ws.onopen = () => ws.send("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!");
```

## üö¢ –ß–µ–∫‚Äë–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

- [ ] Python 3.12+, `python3 -m venv venv && source venv/bin/activate`.
- [ ] `pip install -r requirements.txt`.
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å `.env` (—Å–º. —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã—à–µ).
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ë–ó: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `knowledge_base.md`, —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å ¬´<<->>¬ª –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏.
- [ ] `python3 create_embeddings.py` (–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç `chroma_db_metrotech/`).
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (dev) `uvicorn main:app --host 0.0.0.0 --port 9000 --reload` –∏–ª–∏ (prod) gunicorn.
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `GET /`, `GET /logs-ui/`.

## üß© –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd (–ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞)

–ù–∏–∂–µ ‚Äî —á—Ç–æ —Ç–∞–∫–æ–µ systemd, –≥–¥–µ –ª–µ–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–∞–∫ –≤—Å–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å.

### –ß—Ç–æ —Ç–∞–∫–æ–µ systemd

- –≠—Ç–æ ¬´–º–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤¬ª –≤ Linux. –û–Ω:
  - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–∞—à –±–æ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞;
  - —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–ª (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏);
  - –¥–∞—ë—Ç –µ–¥–∏–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `start/stop/restart/status`;
  - —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª.

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ unit‚Äë—Ñ–∞–π–ª: `/etc/systemd/system/metrotech-bot.service`.
- –í–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ —É–∫–∞–∑–∞–Ω—ã:
  - `WorkingDirectory` ‚Äî –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞: `/root/Asterisk_bot/asterisk-vox-bot`;
  - `Environment` ‚Äî –∫–∞–∫–æ–π `PATH` (–Ω–∞—à `venv`): `/root/Asterisk_bot/asterisk-vox-bot/venv/bin`;
  - `ExecStart` ‚Äî –∫–æ–º–∞–Ω–¥–∞ —Å—Ç–∞—Ä—Ç–∞ (gunicorn –Ω–∞ –ø–æ—Ä—Ç—É 9000):
    - `/root/Asterisk_bot/asterisk-vox-bot/venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:9000 app.backend.main:app`
  - `Restart=always` ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö.

–í–∞–∂–Ω–æ: unit‚Äë—Ñ–∞–π–ª –ª–µ–∂–∏—Ç –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–≤ `/etc/systemd/system/`). –°–∞–º –∫–æ–¥ –∏ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (.env, –ë–ó, —Å—Ç–∞—Ç–∏–∫–∞) ‚Äî –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ `/root/Asterisk_bot/asterisk-vox-bot`.

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å (–æ–¥–∏–Ω —Ä–∞–∑)

```bash
sudo tee /etc/systemd/system/metrotech-bot.service >/dev/null << 'EOF'
[Unit]
Description=Metrotech Voice Bot (FastAPI on 9000)
After=network-online.target

[Service]
User=root
WorkingDirectory=/root/Asterisk_bot/asterisk-vox-bot
Environment="PATH=/root/Asterisk_bot/asterisk-vox-bot/venv/bin"
ExecStart=/root/Asterisk_bot/asterisk-vox-bot/venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:9000 main:app
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable --now metrotech-bot
sudo systemctl status metrotech-bot --no-pager
```

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
sudo systemctl status metrotech-bot     # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
sudo systemctl restart metrotech-bot    # –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ .env/–∫–æ–¥–∞)
sudo systemctl stop metrotech-bot       # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo systemctl start metrotech-bot      # –∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl disable metrotech-bot    # —É–±—Ä–∞—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
sudo systemctl enable metrotech-bot     # –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
```

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞

```bash
journalctl -u metrotech-bot -n 100 --no-pager   # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
journalctl -u metrotech-bot -f                  # ¬´—Ö–≤–æ—Å—Ç¬ª –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∞–∫–∂–µ –ø–∏—à—É—Ç—Å—è –≤ `data/logs/app.log` –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## üìã –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### üöÄ **–ú–ò–ì–†–ê–¶–ò–Ø VOXIMPLANT ‚Üí ASTERISK (2025-09-05)**

**–ü—Ä–∏—á–∏–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏:**
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–≤–æ–Ω–∫–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Asterisk –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚úÖ **–ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**: `stasis_handler.py` –≤–º–µ—Å—Ç–æ `main.py`
- ‚úÖ **ARI WebSocket**: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Asterisk ARI
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **gRPC TTS**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±—ã—Å—Ç—Ä–æ–º—É —Å–∏–Ω—Ç–µ–∑—É —Ä–µ—á–∏

**–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚ùå `app/backend/main.py` - —Å—Ç–∞—Ä—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä
- ‚ùå `app/voximplant/scenario_barge-in_2.js` - Voximplant —Å—Ü–µ–Ω–∞—Ä–∏–π


**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –ó–≤—É–∫ –±–æ—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ AI streaming –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (8.7—Å ‚Üí 2.4—Å)
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ gRPC TTS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ö–∞–∫ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö

1) –ú–µ–Ω—è–µ—Ç–µ `.env` –∏–ª–∏ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞.
2) –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl restart metrotech-bot
```

–ï—Å–ª–∏ –≤—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å–∞–º unit‚Äë—Ñ–∞–π–ª (`/etc/systemd/system/metrotech-bot.service`), —Ç–æ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∞–π—Ç–µ:

```bash
sudo systemctl daemon-reload
sudo systemctl restart metrotech-bot
```

### (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —Å–µ—Ä–≤–∏—Å–∞

–ß—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ –ø–æ–¥—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `ExecStartPre` –≤ unit‚Äë—Ñ–∞–π–ª:

```ini
[Service]
WorkingDirectory=/root/Asterisk_bot/asterisk-vox-bot
Environment="PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/Asterisk_bot/asterisk-vox-bot/venv/bin"
ExecStartPre=/bin/bash -lc 'cd /root/Asterisk_bot/asterisk-vox-bot && /bin/rm -rf data/chroma_tmp data/chroma_old && [ -d data/chroma ] || /root/Asterisk_bot/asterisk-vox-bot/venv/bin/python3 scripts/create_embeddings.py'
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- ¬´Address already in use¬ª: –ø–æ—Ä—Ç 9000 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, dev‚Äëuvicorn). –ù–∞–π—Ç–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```bash
pgrep -af uvicorn
kill <PID_dev_uvicorn>
sudo systemctl restart metrotech-bot
```

- –°–µ—Ä–≤–∏—Å –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–µ–π –≤ `WorkingDirectory`, `ExecStart`, –Ω–∞–ª–∏—á–∏–µ `venv` –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π; —Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `journalctl -u metrotech-bot -n 200`.

## üõ†Ô∏è Troubleshooting

- –ü—É—Å—Ç–∞—è –∞–¥–º–∏–Ω–∫–∞ / –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ React:
  - –í `logs-ui/index.html` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è importmap —Å CDN `jsdelivr` –¥–ª—è ESM. –ï—Å–ª–∏ —Å–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞, —Å–æ–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏‚Äë–±–∞–Ω–¥–ª –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –¥–æ—Å—Ç—É–ø–Ω—ã–π CDN.
- `Address already in use` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
  - –û—Å–≤–æ–±–æ–¥–∏—Ç–µ –ø–æ—Ä—Ç: `lsof -ti :9000 | xargs -r kill -9` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞.
- `OPENAI_API_KEY` –Ω–µ –∑–∞–¥–∞–Ω:
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –≤ `.env`, –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å.
- –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–π –ë–ó –æ—Ç–≤–µ—Ç—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è:
  - –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤; –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç ¬´–≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã¬ª –∏ ¬´–ê–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω¬ª.
- –û—à–∏–±–∫–∞ –ø—Ä–∏ `DELETE /logs` –∏–ª–∏ `POST /api/prompts`:
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key` –∏ –∑–Ω–∞—á–µ–Ω–∏–µ `API_SECRET_KEY`.

### –û —Å–ª—É–∂–µ–±–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö `__init__.py` –∏ –∫—ç—à–µ `__pycache__`

- `__init__.py` –ø–æ–º–µ—á–∞–µ—Ç –ø–∞–ø–∫—É –∫–∞–∫ Python‚Äë–ø–∞–∫–µ—Ç, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–º–ø–æ—Ä—Ç—ã –≤–∏–¥–∞ `app.backend.*`. –§–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞.
- `__pycache__/*.pyc` ‚Äî –∫—ç—à‚Äë–±–∞–π—Ç–∫–æ–¥, Python —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏—Ö –Ω–µ –∫–æ–º–º–∏—Ç–∏–º; —á–∏—Å—Ç–∏—Ç—å –º–æ–∂–Ω–æ –±–µ–∑ –≤—Ä–µ–¥–∞: `find . -name __pycache__ -type d -exec rm -rf {} +`.

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–π Voximplant

- –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `app/voximplant/scenario_barge-in_2.js` ‚Äî –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ Voximplant, –∞ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ω–æ–º–µ—Ä—É —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞. –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏: `WS_URL = "ws://31.207.75.71:9000/ws"`.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env`/—Å–µ–∫—Ä–µ—Ç—ã —Å—Ä–µ–¥—ã.
- –û–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞—â–∏—â–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-API-Key` ‚Äî –¥–µ—Ä–∂–∏—Ç–µ –∫–ª—é—á –≤ —Å–µ–∫—Ä–µ—Ç–µ.
- –õ–æ–≥–∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ `logs-ui/` –∏ –ë–î.
