# üìû –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–ú–µ—Ç—Ä–æ—Ç—ç—Å—Ç"

> üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞ 2025-07-30

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–≤–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É **Voximplant**
- –ü–æ–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ—Å –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é ASR
- –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ **AI-–∞–≥–µ–Ω—Ç–∞ —Å LangChain** (–Ω–∞ Python)
- –û—Ç–≤–µ—á–∞–µ—Ç –≤—Å–ª—É—Ö, –∏—Å–ø–æ–ª—å–∑—É—è TTS
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç barge-in ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –±–æ—Ç–∞ –ø—Ä–∏ —Ä–µ—á–∏ –∫–ª–∏–µ–Ω—Ç–∞

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
|----------------|--------------------------------------------------|
| `scenario_barge-in_2.js` | Voximplant-—Å—Ü–µ–Ω–∞—Ä–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–∞ –∏ —Ä–µ—á–∏ |
| `main.py`      | FastAPI WebSocket-—Å–µ—Ä–≤–µ—Ä                         |
| `Agent.py`     | LangChain-–∞–≥–µ–Ω—Ç: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏ –æ—Ç–≤–µ—Ç—ã      |
| `create_embeddings.py` | –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π      |

---

## üîÅ –°—Ü–µ–Ω–∞—Ä–∏–π –∑–≤–æ–Ω–∫–∞

1. **–ö–ª–∏–µ–Ω—Ç –∑–≤–æ–Ω–∏—Ç** ‚Üí –∑–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è `scenario_barge-in_2.js`
2. –°—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å `main.py`
3. `main.py` –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –≤ `Agent.py`
4. –ê–≥–µ–Ω—Ç:
   - –ò—â–µ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (`–ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt`)
   - –°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –∏ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `ChatOpenAI`
5. –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ —á–∞—Å—Ç—è–º (stream) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ WebSocket
6. `scenario.js` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É (TTS)
7. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–±–∏—Ç—å ‚Äî —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç barge-in (`ASREvents.CaptureStarted`)

---

## üóÇÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Barge-in

–°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

- `createTTSPlayer(..., { language: ..., progressivePlayback: true })` ‚Äî –æ—Ç–≤–µ—Ç –∑–≤—É—á–∏—Ç –µ—â—ë –¥–æ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `ASR` —Å `interimResults: true`
- –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –ø—Ä–∏:
  - `ASREvents.CaptureStarted`
  - `ASREvents.InterimResult`

---

## üßæ –§–æ—Ä–º–∞—Ç –æ–±—â–µ–Ω–∏—è —Å WebSocket

| –ò—Å—Ö–æ–¥—è—â–∏–π (Voximplant ‚Üí Backend) | –¢–µ–∫—Å—Ç –∏–∑ ASR |
|----------------------------------|--------------|
| –í—Ö–æ–¥—è—â–∏–π (Backend ‚Üí Voximplant)  | –ü–æ—Ç–æ–∫ —Ç–µ–∫—Å—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–∏–º–∏–Ω–≥) |

–ú–∞—Ä–∫–µ—Ä `|` –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç –º–æ–¥–µ–ª–∏ –Ω–∏–∫–∞–∫ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è ‚Äî –æ–Ω –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `cleanText(text)`:
```js
return text.replace(/\|/g, ' ').replace(/\*/g, '').trim().replace(/\s+/g, ' ');
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
.
‚îú‚îÄ‚îÄ scenario_barge-in_2.js       # –°–∫—Ä–∏–ø—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ Voximplant
‚îú‚îÄ‚îÄ main.py                      # FastAPI WebSocket-—Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ Agent.py                     # LangChain –∞–≥–µ–Ω—Ç (–ø–æ–∏—Å–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤)
‚îú‚îÄ‚îÄ create_embeddings.py         # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îú‚îÄ‚îÄ –ú–µ—Ç—Ä–æ—Ç–µ—Å—Ç_–°–ê–ô–¢.txt                      # –¢–µ–∫—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env                         # –°–µ–∫—Ä–µ—Ç—ã (–∫–ª—é—á OpenAI, –∏ —Ç.–ø.)
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
python create_embeddings.py

# –ó–∞–ø—É—Å–∫ WebSocket-—Å–µ—Ä–≤–µ—Ä–∞
uvicorn main:app --host 0.0.0.0 --port 8000
```

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:
```bash
nohup venv/bin/gunicorn -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 main:app &
```

---

## üîê .env —Ñ–∞–π–ª

```env
OPENAI_API_KEY=...
```

---

## üìû Voximplant: –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å

1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ [Voximplant](https://manage.voximplant.com/)
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å `scenario_barge-in_2.js`
3. –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –Ω–æ–º–µ—Ä—É
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ —Å `main.py` –¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- –ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤ (–ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ CRM
- –í–≤–µ–¥–µ–Ω–∏–µ ID –∫–ª–∏–µ–Ω—Ç–∞
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (–¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ phraseHints

---
